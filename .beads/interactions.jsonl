{"id":"tau-05f","title":"Add task-delegation skill to task extension","description":"Move /tmp/task-delegation/SKILL.md into extensions/task and copy it into ~/.pi/agent/skills/task-delegation/SKILL.md on startup if missing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:11:28.806891138+01:00","updated_at":"2026-01-17T01:12:11.613053671+01:00","closed_at":"2026-01-17T01:12:11.613053671+01:00","close_reason":"Added task-delegation skill bundle and install-on-missing logic."}
{"id":"tau-0mv","title":"Task tool field renames (type/size/result_schema)","description":"Replace task tool fields with type/size/result_schema, update validation, messages, response payload, and rendering. No backward compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:42:15.685676185+01:00","updated_at":"2026-01-17T00:48:28.595006069+01:00","closed_at":"2026-01-17T00:48:28.595006069+01:00","close_reason":"Replaced task tool fields with type/size/result_schema and updated payloads/messages."}
{"id":"tau-13i","title":"extension: auto-trigger $skill autocomplete while typing","description":"Add editor behavior so typing '$' triggers the autocomplete list immediately, similar to how '/' command suggestions appear without pressing Tab.nnImplementation notes:n- Implement in .pi/extensions/skill-marker/index.ts within SkillMarkerEditor.n- After super.handleInput inserts a char, if we are in $skill token context and autocomplete is not already open, invoke Editor's internal autocomplete trigger (via runtime method access).n- Must not break existing '/' and '@' autocomplete behavior.nnDoD:n- Typing '$' (at start or after whitespace) immediately shows skill suggestions (no Tab).n- Continuing to type updates suggestions.n- '$' not preceded by whitespace does not trigger.n- Manual check: '/mo' and '@' autocomplete still behave exactly as before.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:58:53.078911903+01:00","updated_at":"2026-01-17T16:59:20.625140361+01:00","closed_at":"2026-01-17T16:59:20.625140361+01:00","close_reason":"Implemented auto-trigger for $skill autocomplete on typing '$' (no Tab required)","dependencies":[{"issue_id":"tau-13i","depends_on_id":"tau-2lq","type":"discovered-from","created_at":"2026-01-17T16:58:53.088178418+01:00","created_by":"daemon"}]}
{"id":"tau-1q7","title":"chore: configure git remote for tau and set upstream","description":"This repo currently has no git remotes configured (.git/config has no [remote]). Add origin and set main to track origin/main so git pull --rebase and git push work.","status":"closed","priority":1,"issue_type":"chore","created_at":"2026-01-16T16:32:41.236898376+01:00","updated_at":"2026-01-16T16:34:29.064810293+01:00","closed_at":"2026-01-16T16:34:29.064810293+01:00","close_reason":"Added origin remote (https://github.com/ribelo/tau), pushed main, and verified upstream tracking"}
{"id":"tau-1vq","title":"Add padding line between worked-for separator and prompt","description":"After the worked-for separator widget, add a single empty row of vertical spacing before the editor/prompt renders.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:34:17.456419231+01:00","updated_at":"2026-01-16T00:34:46.135108646+01:00","closed_at":"2026-01-16T00:34:46.135108646+01:00","close_reason":"Closed"}
{"id":"tau-2bl","title":"task tool: return worker output to caller","description":"Fix task tool so the LLM receives actual text content (last assistant message or last tool result) as the tool result. Stop returning content blocks of type 'json' (they are not passed through). Include session_id in returned text for continuation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:44:55.909433488+01:00","updated_at":"2026-01-16T16:47:28.887229686+01:00","closed_at":"2026-01-16T16:47:28.887229686+01:00","close_reason":"task tool now returns text tool result (last assistant or tool output) and includes session_id; stopped returning json blocks","dependencies":[{"issue_id":"tau-2bl","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T16:44:55.918351468+01:00","created_by":"daemon"}]}
{"id":"tau-2lq","title":"pi: $skill marker autocomplete + skill injection extension","description":"Goal: Implement a pi extension that lets users type $skillname with autocomplete and injects the corresponding SKILL.md contents as a separate \u003cskill\u003e...\u003c/skill\u003e message before the agent starts (codex-style: marker + injected instructions, not inline expansion).nnKey code anchors (pi-mono):n- Input hook order: src/core/agent-session.ts (prompt(): input event -\u003e /skill expansion -\u003e before_agent_start)n- Autocomplete provider: src/modes/interactive/interactive-mode.ts (CombinedAutocompleteProvider)n- Custom editor injection: src/modes/interactive/interactive-mode.ts (setCustomEditorComponent)n- Skills discovery: src/core/skills.ts + src/core/sdk.ts (discoverSkills/loadSettings)nnDefinition of Done:n- Project-local extension (./.pi/extensions/*) provides $skill autocomplete and injects skill bodies before LLM turn.n- Works alongside existing / commands and @ file autocomplete.n- Documented usage and manual test steps.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-17T16:11:06.707164144+01:00","updated_at":"2026-01-17T16:42:27.566712635+01:00","closed_at":"2026-01-17T16:42:27.566712635+01:00","close_reason":"Implemented project-local skill-marker extension (autocomplete + before_agent_start injection). Optional upstream API improvement deferred in tau-2lq.7."}
{"id":"tau-2lq.1","title":"spec: define  marker semantics and injected \u003cskill\u003e format","description":"Decisions for $skill marker + injection (codex-style marker + separate injected instructions message).\n\n## Marker detection\n- Syntax: `$` + skill name\n- Name charset: `[a-z0-9][a-z0-9-]*` (lowercase + digits + hyphen).\n- Boundary rules:\n  - Marker must start at beginning of prompt or be preceded by whitespace.\n  - Name ends at the first non `[a-z0-9-]` char (punctuation ok after).\n  - Examples matched: `$beads`, `use $beads, please`, `\n$beads do X`\n  - Examples NOT matched: `$PATH` (uppercase), `foo$beads` (no whitespace boundary), `\\$beads` (escaped)\n\n## Escaping\n- Escape syntax: `\\$name` (a backslash immediately before `$`) disables injection and leaves literal text.\n\n## Multiple skills\n- Multiple markers may appear in one prompt.\n- Dedupe by skill name, keep the order of first occurrence.\n\n## Prompt text handling\n- Do NOT inline-expand the user prompt.\n- Keep the `$skill` markers unchanged in the user prompt text (transparent + harmless).\n\n## Injected payload\n- Inject a separate extension custom message before the LLM call containing one or more blocks:\n\n```\n\u003cskill\u003e\n\u003cname\u003ebeads\u003c/name\u003e\n\u003cpath\u003e/abs/path/to/SKILL.md\u003c/path\u003e\n\u003cinstructions\u003e\n...SKILL.md body (frontmatter stripped)...\n\u003c/instructions\u003e\n\u003c/skill\u003e\n```\n\n- Injected instructions use pi behavior: strip YAML frontmatter (same as `/skill:name` expansion).\n\n## Size limits\n- Apply truncation to injected instructions using pi defaults: max 2000 lines OR 50KB (whichever hits first).\n- If truncated, append a note inside `\u003cinstructions\u003e`: `[Skill content truncated; full content at: \u003cpath\u003e]`.\n\n## Error handling\n- Unknown skill name: do not inject; optionally notify user via UI (if available).\n- Unreadable SKILL.md: do not inject; notify user via UI (if available).\n\nDoD examples\n- `$beads do X` injects beads SKILL.md body as separate message.\n- `\\$beads` does not inject.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.779585404+01:00","updated_at":"2026-01-17T16:35:00.818137983+01:00","closed_at":"2026-01-17T16:35:00.818137983+01:00","close_reason":"Spec decisions captured in description","dependencies":[{"issue_id":"tau-2lq.1","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.779921829+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.2","title":"extension: scaffold project-local skill-marker extension","description":"Create a project-local pi extension skeleton under ./.pi/extensions/skill-marker/ (index.ts + README).\n\nImplementation notes:\n- Must be auto-discovered by pi (project-local).\n- No startup banners / console.log noise.\n- Provide minimal configuration knobs (e.g. enable/disable, marker char) via constants or env vars.\n\nDoD:\n- .pi/extensions/skill-marker/index.ts exists and loads in pi without errors.\n- README describes how to enable globally (copy to ~/.pi/agent/extensions/) if desired.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.800549346+01:00","updated_at":"2026-01-17T16:35:26.740761485+01:00","closed_at":"2026-01-17T16:35:26.740761485+01:00","close_reason":"Scaffolded project-local extension with README","dependencies":[{"issue_id":"tau-2lq.2","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.800876353+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.3","title":"extension: discover skills + build lookup index","description":"Implement skill discovery inside the extension using pi APIs (import from @mariozechner/pi-coding-agent):\n- loadSettings(cwd, agentDir) to respect existing skills settings\n- discoverSkills(cwd, agentDir, settings.skills) to get names/descriptions/paths\n- Build in-memory index: name -\u003e { path, description }\n- Cache SKILL.md contents on first use (strip frontmatter for injected body if we choose)\n\nCode anchors (pi-mono reference):\n- skills discovery logic: packages/coding-agent/src/core/skills.ts\n- sdk helpers: packages/coding-agent/src/core/sdk.ts (discoverSkills, loadSettings)\n\nDoD:\n- Given a known local skill, extension can resolve name -\u003e SKILL.md path reliably.\n- Handles missing/disabled/invalid skills gracefully (notify or ignore per spec).\n- No filesystem scanning on every keystroke (cache or debounce).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.822095914+01:00","updated_at":"2026-01-17T16:36:12.945527135+01:00","closed_at":"2026-01-17T16:36:12.945527135+01:00","close_reason":"Implemented skill discovery + in-memory index and cached body loader","dependencies":[{"issue_id":"tau-2lq.3","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.82239641+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.3","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:29.98080527+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.4","title":"extension:  autocomplete in editor (wrap existing provider)","description":"Add $skill autocomplete while typing in pi interactive editor.\n\nApproach:\n- ctx.ui.setEditorComponent() install CustomEditor subclass that wraps the existing autocomplete provider injected by interactive-mode.\n- Implement AutocompleteProvider wrapper:\n  - If cursor is at token matching (start|whitespace) + \"$\" + partialName =\u003e return skill suggestions (fuzzy match).\n  - applyCompletion inserts \"$\" + skillName only (no expansion).\n  - Otherwise delegate to underlying provider so / commands and @file completion keep working.\n\nCode anchors (pi-mono reference):\n- Autocomplete provider: packages/coding-agent/src/modes/interactive/interactive-mode.ts (CombinedAutocompleteProvider)\n- Editor supports custom autocomplete providers: packages/tui/src/components/editor.ts + packages/tui/src/autocomplete.ts\n\nDoD:\n- Typing \"$be\" + Tab suggests beads (if available) and inserts \"$beads\".\n- Existing / and @ completion still works unchanged.\n- No noticeable lag while typing.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.842937862+01:00","updated_at":"2026-01-17T16:37:45.708017135+01:00","closed_at":"2026-01-17T16:37:45.708017135+01:00","close_reason":"Implemented $skill autocomplete by wrapping existing editor autocomplete provider","dependencies":[{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.843236264+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:29.998136193+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.2","type":"blocks","created_at":"2026-01-17T16:12:30.016243816+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.3","type":"blocks","created_at":"2026-01-17T16:12:30.03395951+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.5","title":"extension: inject skill instructions before agent_start (codex-style)","description":"Implement skill injection at send-time.\n\nApproach:\n- Use before_agent_start event to detect explicit mentions of $skill tokens in the prompt.\n- For each resolved skill, read SKILL.md and inject a separate custom message into the turn context containing one or more \u003cskill\u003e blocks.\n- Do NOT inline-expand the user prompt text; keep marker or strip per spec task.\n\nInjected message format should include name + path + contents (codex-inspired), e.g.:\n\u003cskill\u003e\n\u003cname\u003ebeads\u003c/name\u003e\n\u003cpath\u003e/abs/.../SKILL.md\u003c/path\u003e\n...contents...\n\u003c/skill\u003e\n\nDoD:\n- With $skill mention, a custom message is added before the user message reaches the model.\n- Supports multiple $skills in one prompt (deduped)\n- Unknown skill leaves prompt unchanged + user notified (or silent) per spec.\n- Escaped \\$skill is not injected.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.862085184+01:00","updated_at":"2026-01-17T16:38:35.357668778+01:00","closed_at":"2026-01-17T16:38:35.357668778+01:00","close_reason":"Implemented before_agent_start skill injection as separate \u003cskill\u003e blocks","dependencies":[{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.862380019+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:30.051487502+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.2","type":"blocks","created_at":"2026-01-17T16:12:30.06904926+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.3","type":"blocks","created_at":"2026-01-17T16:12:30.086927194+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.6","title":"docs/qa: usage docs + manual test checklist","description":"Write concise docs and a manual QA checklist for the extension.\n\nDocs must cover:\n- How to install project-locally (./.pi/extensions/skill-marker/)\n- How to install globally (~/.pi/agent/extensions/)\n- Examples: $beads, multiple skills, escaping\n- Known limitations (context size, skill filtering vs --skills, etc.)\n\nQA checklist DoD:\n- Steps to verify autocomplete for $ / existing / commands / @ file refs\n- Steps to verify injected message appears in context (by observing model behavior or logs)\n- Error handling checks (missing skill, unreadable SKILL.md)\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-17T16:12:16.881456894+01:00","updated_at":"2026-01-17T16:42:24.433041158+01:00","closed_at":"2026-01-17T16:42:24.433041158+01:00","close_reason":"Docs and manual QA checklist added to extension README","dependencies":[{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.881784242+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq.4","type":"blocks","created_at":"2026-01-17T16:12:30.104153448+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq.5","type":"blocks","created_at":"2026-01-17T16:12:30.127249369+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.7","title":"optional: pi core API - expose discovered skills to extensions","description":"Optional upstream improvement (pi-mono): expose the discovered skills list (name/description/path) to extensions via ExtensionContext or ExtensionAPI.\n\nRationale:\n- Extension currently must re-run discoverSkills() and may not respect CLI --skills filtering.\n- A first-class API would make $skill autocomplete/injection consistent with pi core.\n\nDoD:\n- Proposed API shape documented in issue (and implemented if we choose to upstream).\n- If implemented: minimal tests + docs update in pi-mono.\n","notes":"Optional upstream pi-mono API improvement; extension works without it.","status":"deferred","priority":4,"issue_type":"task","created_at":"2026-01-17T16:12:16.900610928+01:00","updated_at":"2026-01-17T16:42:24.449241658+01:00","dependencies":[{"issue_id":"tau-2lq.7","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.900933075+01:00","created_by":"daemon"}]}
{"id":"tau-2xo","title":"Rename task_type 'general' to 'custom'","description":"The 'general' task type name is too vague. Rename to 'custom' to better indicate it's a user-configurable task type that accepts skills injection.nnChanges needed:n- Update task_type validationn- Update documentationn- Remove 'general' alias entirely (no backward compatibility)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:18:17.919781343+01:00","updated_at":"2026-01-16T22:21:50.26924761+01:00","closed_at":"2026-01-16T22:21:50.26924761+01:00","close_reason":"Renamed task_type general to custom and removed alias}"}
{"id":"tau-5va","title":"Task tool batch input and concurrent execution","description":"Make task tool accept an array of task items, run them concurrently with Promise.all, return ordered results per item, and aggregate updates.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:42:39.224472647+01:00","updated_at":"2026-01-17T00:08:53.77784996+01:00","closed_at":"2026-01-17T00:08:53.77784996+01:00","close_reason":"Implemented batch task input with concurrent execution and ordered results."}
{"id":"tau-5vw","title":"Demo: render test","description":"Testing beads decorator rendering","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:00:02.9490764+01:00","updated_at":"2026-01-16T00:00:02.9490764+01:00"}
{"id":"tau-5xl","title":"task tui: improve task result rendering","description":"Adjust task tool rendering: hide separate call entry, show description inside result, show per-tool success/failure icons, and move usage line to bottom. Combine tool call+result into single line in the task cell.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:31:03.185562479+01:00","updated_at":"2026-01-16T17:33:37.708020437+01:00","closed_at":"2026-01-16T17:33:37.708020437+01:00","close_reason":"Updated task tool rendering: hide call view, show description in result, add per-tool status icons, move usage to footer","dependencies":[{"issue_id":"tau-5xl","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:31:03.197161976+01:00","created_by":"daemon"}]}
{"id":"tau-6jl","title":"Fix invalid tool names in TaskRegistry builtins","description":"TaskRegistry.builtins() references tools that don't exist: ls, find, grep.\n\nActual available tools: read, write, edit, bash, bd, task, web_search_exa, crawling_exa, get_code_context_exa, git_commit_with_user_approval\n\nCurrent broken config:\n- search: tools: ['read', 'ls', 'find', 'grep']  \n- review: tools: ['read', 'ls', 'find', 'grep', 'bash']\n- planning: tools: ['read', 'ls', 'find', 'grep']\n\nShould be:\n- search: tools: ['read', 'bash'] (or just read if truly read-only)\n- review: tools: ['read', 'bash']\n- planning: tools: ['read', 'bash'] (or just read)\n\nNote: read-only enforcement should be via skill guidance, not fake tool restrictions.\n\nRelated: tau-8oj (silent ignore of non-existent tools)","status":"open","issue_type":"task","created_at":"2026-01-17T02:42:57.887311017+01:00","updated_at":"2026-01-17T02:42:57.887311017+01:00"}
{"id":"tau-8fd","title":"Port commit.ts extension","description":"Port mitsuhiko/agent-stuff pi-extensions/commit.ts into tau extensions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:34:47.738221331+01:00","updated_at":"2026-01-16T01:36:48.185430791+01:00","closed_at":"2026-01-16T01:36:48.185430791+01:00","close_reason":"Implemented /commit command + git_commit_with_user_approval tool"}
{"id":"tau-8od","title":"Epic: Task-based delegation extension for pi","description":"Replace persona-based subagent extension with task-based delegation system.\n\n## Goals\n1. Task types with minimal contracts (policy, not persona)\n2. Difficulty-based model selection (small/medium/large)\n3. Skill injection into workers\n4. Session continuation via session_id\n5. No sandbox policies (for now)\n6. No personas - workers execute WHAT, not WHO they are\n\n## Architecture\n- **Task Type**: Policy (model, tools, thinking) + default skills\n- **Skill**: Injectable knowledge from ~/.pi/agent/skills/ or .pi/skills/\n- **Task Session**: Durable transcript, resumable via session_id\n- **Worker**: Executes task with context prompt (not identity persona)\n\n## Built-in Task Types\n- code: General implementation work\n- search: Find code, definitions, references (read-only tools)\n- review: Code review with review skill\n- planning: Architecture and design decisions\n- general: User-specified skills\n\n## Config (settings.json)\n```json\n{\n  \"tasks\": {\n    \"code\": {\n      \"difficulty\": {\n        \"small\": { \"model\": \"anthropic/claude-haiku-4\" },\n        \"medium\": { \"model\": \"anthropic/claude-sonnet-4\" },\n        \"large\": { \"model\": \"anthropic/claude-sonnet-4\", \"thinking\": \"high\" }\n      }\n    }\n  }\n}\n```\n\n## DoD\n- New extension in tau/extensions/task/\n- Old subagent extension removed from ~/.pi\n- task tool registered and working\n- Skill injection functional\n- Session continuation working\n- Custom TUI rendering for task results","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T16:06:21.183042058+01:00","updated_at":"2026-01-16T16:25:40.080749927+01:00","closed_at":"2026-01-16T16:25:40.080749927+01:00","close_reason":"Implemented task-based delegation extension and removed old subagent"}
{"id":"tau-8od.1","title":"Create extension scaffold: tau/extensions/task/","description":"Create the basic extension structure.\n\n## Files to create\n```\ntau/extensions/task/\n├── package.json          # Extension manifest with pi.extensions\n└── src/\n    ├── index.ts          # Extension entry point\n    └── types.ts          # TypeScript interfaces\n```\n\n## package.json structure\n```json\n{\n  \"name\": \"task\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"pi\": {\n    \"extensions\": [\"./src/index.ts\"]\n  }\n}\n```\n\n## index.ts minimal scaffold\n- Import ExtensionAPI from @mariozechner/pi-coding-agent\n- Export default function that takes pi: ExtensionAPI\n- Log 'task extension loaded' on session_start\n\n## DoD\n- Extension loads without errors when pi starts\n- session_start event fires and logs message","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:37.81537964+01:00","updated_at":"2026-01-16T16:25:37.274466645+01:00","closed_at":"2026-01-16T16:25:37.274466645+01:00","close_reason":"Created extensions/task scaffold","dependencies":[{"issue_id":"tau-8od.1","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:37.81573528+01:00","created_by":"daemon"}]}
{"id":"tau-8od.10","title":"Create review skill from old review agent","description":"Migrate review agent content to a proper skill.\n\n## Source\nCheck ~/.pi/agent/extensions/subagent/agents/ or ~/.pi/agent/agents/ for review.md\n\n## Target\n~/.pi/agent/skills/review/SKILL.md\n\n## Skill format\n```markdown\n---\nname: review\ndescription: Code review guidelines and output format\n---\n\n# Code Review Skill\n\n{extracted guidelines from old review.md}\n\n## Output Format\n{any structured output requirements}\n```\n\n## Key content to preserve\n- Review process guidelines\n- What to look for (bugs, security, style)\n- Output format/structure expectations\n\n## What to remove\n- Identity prompts ('You are a code reviewer...')\n- Persona language\n- Redundant instructions covered by task context\n\n## DoD\n- review skill exists at correct path\n- loadSkill('review', cwd) returns content\n- No persona language in skill content","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-16T16:08:24.985482274+01:00","updated_at":"2026-01-16T16:25:37.415559899+01:00","closed_at":"2026-01-16T16:25:37.415559899+01:00","close_reason":"Migrated review agent into review skill (plus planning/search skills)","dependencies":[{"issue_id":"tau-8od.10","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:24.986576165+01:00","created_by":"daemon"},{"issue_id":"tau-8od.10","depends_on_id":"tau-8od.8","type":"blocks","created_at":"2026-01-16T16:09:19.222513085+01:00","created_by":"daemon"}]}
{"id":"tau-8od.2","title":"Implement TaskRegistry: load built-in + user config","description":"Create TaskRegistry that manages task type definitions.\n\n## File: src/registry.ts\n\n## TaskType interface\n```typescript\ninterface TaskType {\n  name: string;\n  description: string;\n  tools?: string[];          // undefined = all tools\n  defaultModel?: string;     // 'inherit' or canonical ID\n  defaultThinking?: ThinkingLevel;\n  difficulty?: {\n    small?: { model?: string; thinking?: ThinkingLevel };\n    medium?: { model?: string; thinking?: ThinkingLevel };\n    large?: { model?: string; thinking?: ThinkingLevel };\n  };\n  skills?: string[];         // default skills to inject\n}\n```\n\n## Built-in task types\n- code: All tools, inherit model\n- search: read/ls/find/grep only\n- review: read-only + bash, skills: ['review']\n- planning: read-only tools\n- general: All tools, accepts skills param from caller\n\n## Config loading\n- Load from ~/.pi/agent/settings.json under 'tasks' key\n- Load from .pi/settings.json (project-local, higher priority)\n- Merge with built-ins: user config overrides built-in defaults\n\n## API\n- TaskRegistry.get(taskType): TaskType | undefined\n- TaskRegistry.resolve(taskType, difficulty): ResolvedPolicy\n- TaskRegistry.list(): TaskType[]\n\n## DoD\n- Built-in task types available without config\n- User config overrides work\n- Difficulty resolution returns correct model/thinking","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:49.472725849+01:00","updated_at":"2026-01-16T16:25:37.290224987+01:00","closed_at":"2026-01-16T16:25:37.290224987+01:00","close_reason":"Implemented TaskRegistry with config overrides and difficulty resolution","dependencies":[{"issue_id":"tau-8od.2","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:49.473861189+01:00","created_by":"daemon"},{"issue_id":"tau-8od.2","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:37.461313153+01:00","created_by":"daemon"}]}
{"id":"tau-8od.3","title":"Implement SkillLoader: load skills from disk","description":"Create SkillLoader that finds and loads skill content.\n\n## File: src/skills.ts\n\n## LoadedSkill interface\n```typescript\ninterface LoadedSkill {\n  name: string;\n  path: string;\n  contents: string;\n}\n```\n\n## Search paths (in order of priority)\n1. .pi/skills/{name}/SKILL.md (project-local)\n2. .pi/skills/{name}.md\n3. ~/.pi/agent/skills/{name}/SKILL.md (user)\n4. ~/.pi/agent/skills/{name}.md\n\n## API\n- loadSkill(name: string, cwd: string): LoadedSkill | null\n- loadSkills(names: string[], cwd: string): { loaded: LoadedSkill[], missing: string[] }\n\n## DoD\n- Can load beads skill from ~/.pi/agent/skills/beads/SKILL.md\n- Project-local skills take precedence\n- Returns null for missing skills without throwing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:57.0292357+01:00","updated_at":"2026-01-16T16:25:37.306095795+01:00","closed_at":"2026-01-16T16:25:37.306095795+01:00","close_reason":"Implemented SkillLoader with project/user lookup","dependencies":[{"issue_id":"tau-8od.3","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:57.030363726+01:00","created_by":"daemon"},{"issue_id":"tau-8od.3","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:40.817028386+01:00","created_by":"daemon"}]}
{"id":"tau-8od.4","title":"Implement SessionManager: track active task sessions","description":"Create SessionManager for session continuation.\n\n## File: src/sessions.ts\n\n## TaskSession interface\n```typescript\ninterface TaskSession {\n  sessionId: string;\n  taskType: string;\n  difficulty: Difficulty;\n  process: ChildProcess;       // spawned pi process\n  createdAt: number;\n}\n```\n\n## In-memory storage\n- Map\u003csessionId, TaskSession\u003e\n- Sessions live for duration of parent pi process\n\n## API\n- getSession(sessionId): TaskSession | undefined\n- createSession(taskType, difficulty): TaskSession\n- hasSession(sessionId): boolean\n\n## Session ID generation\n- Use crypto.randomUUID() for new sessions\n- Accept existing sessionId for continuation\n\n## DoD\n- Can create new session and retrieve by ID\n- Can detect session_id mismatch (wrong task_type)\n- Sessions survive across multiple task tool calls","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:04.431335224+01:00","updated_at":"2026-01-16T16:25:37.322701746+01:00","closed_at":"2026-01-16T16:25:37.322701746+01:00","close_reason":"Implemented SessionManager for task session tracking","dependencies":[{"issue_id":"tau-8od.4","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:04.432434044+01:00","created_by":"daemon"},{"issue_id":"tau-8od.4","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:43.678883381+01:00","created_by":"daemon"}]}
{"id":"tau-8od.5","title":"Implement TaskRunner: spawn and stream pi processes","description":"Create TaskRunner that spawns worker pi processes.\n\n## File: src/runner.ts\n\n## Core responsibilities\n1. Build worker system prompt (context, not persona)\n2. Spawn pi process with correct flags\n3. Stream JSON events back to parent\n4. Handle completion/error/interruption\n\n## Worker system prompt structure\n```\n# Task Execution Context\nYou are executing a delegated task from parent session: {parentSessionId}\n\n## Guidelines\n- Focus on the requested task\n- Use available tools as needed\n- If specific output format required, follow it exactly\n- Otherwise, summarize what you did and why\n\n{parallel_constraints if parallelCount \u003e 1}\n\n---\n\u003cskill name=\"{name}\" path=\"{path}\"\u003e\n{skill contents}\n\u003c/skill\u003e\n```\n\n## pi spawn arguments\n```bash\npi --mode json -p --no-session \\\n  --model {resolvedModel} \\\n  --thinking {resolvedThinking} \\\n  --tools {toolsList} \\\n  --append-system-prompt {tempPromptFile} \\\n  \"Task: {userPrompt}\"\n```\n\n## Event processing\n- Parse NDJSON from stdout\n- Emit updates via onUpdate callback\n- Accumulate messages for final result\n- Track usage stats (tokens, cost)\n\n## TaskResult\n```typescript\ntype TaskOutput =\n  | { type: 'completed'; message: string }\n  | { type: 'completed_tool'; toolOutput: string }\n  | { type: 'completed_empty' }\n  | { type: 'interrupted'; resumable: true }\n  | { type: 'failed'; reason: string; resumable: boolean };\n\ninterface TaskResult {\n  output: TaskOutput;\n  sessionId: string;\n  usage: UsageStats;\n}\n```\n\n## DoD\n- Can spawn pi process and capture output\n- Streams progress to parent via onUpdate\n- Handles all termination cases (success, error, abort)\n- Cleans up temp files on completion","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:27.836925606+01:00","updated_at":"2026-01-16T16:25:37.339045836+01:00","closed_at":"2026-01-16T16:25:37.339045836+01:00","close_reason":"Implemented TaskRunner to spawn pi workers and stream NDJSON","dependencies":[{"issue_id":"tau-8od.5","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:27.83802133+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.2","type":"blocks","created_at":"2026-01-16T16:08:46.773656622+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.3","type":"blocks","created_at":"2026-01-16T16:08:50.37576493+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.4","type":"blocks","created_at":"2026-01-16T16:08:53.269641373+01:00","created_by":"daemon"}]}
{"id":"tau-8od.6","title":"Register task tool with pi.registerTool()","description":"Register the task tool that LLM can call.\n\n## File: src/index.ts (main extension)\n\n## Tool schema\n```typescript\nconst TaskParams = Type.Object({\n  task_type: Type.String({\n    description: 'Type of work: code, search, review, planning, general'\n  }),\n  description: Type.String({\n    description: 'Short description of the task (for logging/UI)'\n  }),\n  prompt: Type.String({\n    description: 'The full prompt for the worker'\n  }),\n  difficulty: Type.Optional(StringEnum(['small', 'medium', 'large'] as const, {\n    description: 'Task complexity. small=trivial, medium=standard (default), large=complex',\n  })),\n  session_id: Type.Optional(Type.String({\n    description: 'Continue an existing task session instead of starting new',\n  })),\n  skills: Type.Optional(Type.Array(Type.String(), {\n    description: 'Skills to inject (only valid for task_type=general)',\n  })),\n});\n```\n\n## Tool registration\n```typescript\npi.registerTool({\n  name: 'task',\n  label: 'Task',\n  description: buildToolDescription(registry),\n  parameters: TaskParams,\n  execute: async (toolCallId, params, onUpdate, ctx, signal) =\u003e { ... },\n  renderCall: (args, theme) =\u003e { ... },\n  renderResult: (result, options, theme) =\u003e { ... },\n});\n```\n\n## Description generation\n- List available task types with descriptions\n- Show difficulty options\n- Explain session_id continuation\n- Explain skills parameter (general only)\n\n## Execute flow\n1. Validate task_type exists\n2. Validate skills param only for general\n3. Resolve policy from registry + difficulty\n4. Load skills\n5. Get or create session\n6. Run task via TaskRunner\n7. Return result with session_id\n\n## DoD\n- Tool appears in pi's tool list\n- LLM can call task tool successfully\n- Invalid task_type returns helpful error\n- skills validation works for general only","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:42.094950135+01:00","updated_at":"2026-01-16T16:25:37.354560444+01:00","closed_at":"2026-01-16T16:25:37.354560444+01:00","close_reason":"Registered task tool and wired registry/skills/sessions/runner","dependencies":[{"issue_id":"tau-8od.6","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:42.096485339+01:00","created_by":"daemon"},{"issue_id":"tau-8od.6","depends_on_id":"tau-8od.5","type":"blocks","created_at":"2026-01-16T16:08:56.127457658+01:00","created_by":"daemon"}]}
{"id":"tau-8od.7","title":"Implement custom TUI rendering for task results","description":"Add custom renderCall and renderResult for nice TUI display.\n\n## File: src/render.ts\n\n## renderCall display\nShow task being delegated:\n```\n• task review:medium\n  └ \"Review changes in src/foo.rs\"\n```\n\n## renderResult display (collapsed)\n```\n✓ task review:medium (session: abc-123)\n  └ 3 turns ↑1.2k ↓800 $0.0042 anthropic/claude-sonnet-4\n  └ Found 2 issues: missing error handling, unused import\n```\n\n## renderResult display (expanded)\nShow full message content with markdown rendering.\n\n## Streaming display (isPartial)\n```\n⏳ task review:medium (running...)\n  └ read src/foo.rs\n  └ grep \"error\" ./\n  └ ...\n```\n\n## Status indicators\n- ⏳ Running (blinking dot like current subagent)\n- ✓ Completed (green)\n- ✗ Failed (red)\n- ⚠ Interrupted (yellow)\n\n## DoD\n- renderCall shows task_type:difficulty and description\n- renderResult shows completion status and summary\n- Streaming updates show tool calls as they happen\n- Expanded view shows full output with markdown","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:07:53.736798049+01:00","updated_at":"2026-01-16T16:25:37.369850361+01:00","closed_at":"2026-01-16T16:25:37.369850361+01:00","close_reason":"Added custom TUI rendering for task call/result","dependencies":[{"issue_id":"tau-8od.7","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:53.737869336+01:00","created_by":"daemon"},{"issue_id":"tau-8od.7","depends_on_id":"tau-8od.6","type":"blocks","created_at":"2026-01-16T16:08:59.301271905+01:00","created_by":"daemon"}]}
{"id":"tau-8od.8","title":"Remove old subagent extension from ~/.pi","description":"Clean up the old persona-based subagent extension.\n\n## Files to remove\n```\n~/.pi/agent/extensions/subagent/\n├── agents.ts      # DELETE\n├── index.ts       # DELETE\n├── README.md      # DELETE\n├── agents/        # DELETE entire directory\n└── prompts/       # DELETE entire directory\n```\n\n## Files to keep (migrate if useful)\n- agents/*.md content → Consider migrating to skills if valuable\n  - review.md → ~/.pi/agent/skills/review/SKILL.md (if not already exists)\n  - Other agents: evaluate if content is useful as skills\n\n## Verification\n- pi starts without subagent tool\n- No errors about missing extension\n- task tool works as replacement\n\n## DoD\n- ~/.pi/agent/extensions/subagent/ directory removed\n- Old 'subagent' tool no longer available\n- Any useful agent content migrated to skills","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:08:02.524474729+01:00","updated_at":"2026-01-16T16:25:37.384867919+01:00","closed_at":"2026-01-16T16:25:37.384867919+01:00","close_reason":"Removed old subagent extension and installed task extension symlink","dependencies":[{"issue_id":"tau-8od.8","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:02.525545826+01:00","created_by":"daemon"},{"issue_id":"tau-8od.8","depends_on_id":"tau-8od.6","type":"blocks","created_at":"2026-01-16T16:09:02.33018006+01:00","created_by":"daemon"}]}
{"id":"tau-8od.9","title":"Add parallel worker detection and constraints","description":"Detect when multiple task calls are in same parent turn.\n\n## Purpose\nWhen LLM calls task() multiple times in parallel, inject constraints to prevent conflicts.\n\n## Detection\n- Track task tool invocations per parent turn\n- Count concurrent workers spawned\n\n## Parallel constraints prompt (injected when parallelCount \u003e 1)\n```\n## Parallel Execution ({parallelCount} workers)\nThis parent spawned {parallelCount} task sessions in parallel.\n- Assume other workers may be editing the repo at the same time.\n- Avoid editing the same files or shared contracts unless explicitly required.\n- Keep changes narrowly scoped to your assigned area.\n- If you detect overlap or a dependency on another worker, stop and report it.\n```\n\n## Implementation\n- Use atomic counter per turn context\n- Increment on each task tool call\n- Finalize count before spawning any workers\n- Inject constraints if count \u003e 1\n\n## DoD\n- Single task call: no parallel constraints injected\n- Multiple parallel calls: all workers see constraint prompt\n- Count is accurate even with concurrent calls","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:08:16.179324624+01:00","updated_at":"2026-01-16T16:25:37.400336488+01:00","closed_at":"2026-01-16T16:25:37.400336488+01:00","close_reason":"Added parallel worker detection and constraint prompt injection","dependencies":[{"issue_id":"tau-8od.9","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:16.180459102+01:00","created_by":"daemon"},{"issue_id":"tau-8od.9","depends_on_id":"tau-8od.5","type":"blocks","created_at":"2026-01-16T16:09:16.30511082+01:00","created_by":"daemon"}]}
{"id":"tau-8oj","title":"Error when task type config references non-existent tools","description":"Currently, if a task type config specifies tools that don't exist (e.g. tools: [\"read\", \"nonexistent_tool\"]), the non-existent tools are silently ignored.\n\nThis is a bug because:\n1. User expects the tools they configure to be available\n2. Typos in tool names go unnoticed (e.g. \"grepp\" instead of \"grep\")\n3. Makes debugging config issues difficult\n\nExpected behavior:\n- On TaskRegistry.load(), validate that all tools in task type configs exist\n- Produce clear error or warning listing unknown tools\n- Either fail fast or log warning at startup\n\nAffected code:\n- extensions/task/src/registry.ts - normalizeTaskType() or load()\n- Need access to list of available tools to validate against","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:27:39.197777683+01:00","updated_at":"2026-01-17T02:38:37.748384336+01:00","closed_at":"2026-01-17T02:38:37.748384336+01:00","close_reason":"Validate task tool configs and error on unknown tool names."}
{"id":"tau-8wx","title":"DemoGraph: Beads renderer demo","description":"Synthetic issue graph to test the beads tool rendering (statuses + deps).","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-16T00:49:49.880630432+01:00","updated_at":"2026-01-16T00:49:49.880630432+01:00","labels":["demo-render"]}
{"id":"tau-8wx.1","title":"DemoGraph: Base renderer","description":"A completed task to show ✔ rendering.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.903399709+01:00","updated_at":"2026-01-16T00:49:49.990045144+01:00","closed_at":"2026-01-16T00:49:49.990045144+01:00","close_reason":"Demo complete","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.1","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.904387717+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.2","title":"DemoGraph: Blocking dependency","description":"Blocks other tasks to demonstrate blocked/ready lists.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-16T00:49:49.918227786+01:00","updated_at":"2026-01-16T00:49:49.918227786+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.2","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.918495047+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.3","title":"DemoGraph: Dep tree directions","description":"This task is blocked by another task.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.931698812+01:00","updated_at":"2026-01-16T00:49:49.931698812+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.3","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.931971723+01:00","created_by":"daemon"},{"issue_id":"tau-8wx.3","depends_on_id":"tau-8wx.2","type":"blocks","created_at":"2026-01-16T00:49:49.932425851+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.4","title":"DemoGraph: Polish output style","description":"In-progress task to show status variance.","status":"in_progress","priority":3,"issue_type":"task","created_at":"2026-01-16T00:49:49.961301754+01:00","updated_at":"2026-01-16T00:49:50.002032384+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.4","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.961563223+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.5","title":"DemoGraph: Release checklist","description":"Blocked by an open bug.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.97631254+01:00","updated_at":"2026-01-16T00:49:49.97631254+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.5","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.976633223+01:00","created_by":"daemon"},{"issue_id":"tau-8wx.5","depends_on_id":"tau-tgp","type":"blocks","created_at":"2026-01-16T00:49:49.977205606+01:00","created_by":"daemon"}]}
{"id":"tau-90x","title":"exa extension: improve tool schemas and rendering","description":"Update extensions/exa to match exa.* tool schemas (web_search_exa/crawling_exa/get_code_context_exa) and add rich TUI rendering.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:28:44.485293555+01:00","updated_at":"2026-01-16T16:31:37.769755395+01:00","closed_at":"2026-01-16T16:31:37.769755395+01:00","close_reason":"Updated exa extension tool schemas and added custom rendering"}
{"id":"tau-9h5","title":"Add default result_schema to TaskType config","description":"Allow task types to specify a default result_schema in settings.json.\n\nUse case: The review task type should always return structured JSON output (findings, overall_correctness, etc.) without requiring the caller to specify result_schema every time.\n\nChanges needed:\n- Add result_schema field to TaskType interface\n- Merge with per-call result_schema (per-call overrides default)\n- Update normalization in registry.ts\n- Update task-type-creation skill with example","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T02:24:52.760021271+01:00","updated_at":"2026-01-17T02:24:52.760021271+01:00"}
{"id":"tau-bq3","title":"Rename task size to complexity","description":"Rename task size to complexity with low/medium/high values, update config schema, resolution fallback, and tool/skill docs. Make model exclusive with complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:43:19.993083118+01:00","updated_at":"2026-01-17T01:46:47.044917942+01:00","closed_at":"2026-01-17T01:46:47.044917942+01:00","close_reason":"Renamed size to complexity with low/medium/high values, updated resolution fallback and docs."}
{"id":"tau-dck","title":"task: remove startup log and rely on pi reporting","description":"Remove the 'task extension loaded' session_start console.log from extensions/task. Add a requirement to AGENTS.md: extensions must not print startup banners/logging and should rely on pi's reporting/UI.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:38:22.929505157+01:00","updated_at":"2026-01-16T16:38:58.691700834+01:00","closed_at":"2026-01-16T16:38:58.691700834+01:00","close_reason":"Removed session_start console.log from task extension and documented no-startup-logging requirement in AGENTS.md","dependencies":[{"issue_id":"tau-dck","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T16:38:22.929946991+01:00","created_by":"daemon"}]}
{"id":"tau-dtk","title":"Skill resolution fallback: global path then extension-bundled","description":"Skills for builtin task types (code, search, review, planning) should be bundled with the task extension, not require users to install them globally.\n\nCurrent behavior:\n- Skills are discovered from global paths only (~/.pi/agent/skills/, ~/.codex/skills/, etc.)\n- Builtin task types reference skills (e.g. search type has skills: [\"search\"])\n- If user doesn't have these skills installed globally, they're missing\n\nExpected behavior:\n1. First check normal skill discovery path (user/global skills)\n2. If not found, fallback to extension-bundled skills (extensions/task/skills/)\n3. User skills override extension-bundled skills (allows customization)\n\nThis allows:\n- Task extension to ship with working default skills\n- Users to override with their own versions\n- No manual skill installation required for builtins\n\nBundled skills location: extensions/task/skills/\n- code/SKILL.md\n- search/SKILL.md\n- review/SKILL.md\n- planning/SKILL.md\n- task-delegation/SKILL.md\n- task-type-creation/SKILL.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:30:26.027018425+01:00","updated_at":"2026-01-17T02:38:37.789898229+01:00","closed_at":"2026-01-17T02:38:37.789898229+01:00","close_reason":"Added bundled skills and extension fallback for task types."}
{"id":"tau-fo6","title":"Enable nested task tool in worker sessions","description":"Initialize extension runtime for worker AgentSessions so nested task calls work (respect depth).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:05:09.521078863+01:00","updated_at":"2026-01-17T02:05:39.74193816+01:00","closed_at":"2026-01-17T02:05:39.74193816+01:00","close_reason":"Initialized extension runtime for worker sessions and added task-type-creation skill."}
{"id":"tau-fw1","title":"Fix empty Exa tool results for agent","description":"The Exa tools (web_search, crawl, code_context) were only returning JSON blocks, which resulted in empty output for the agent. Added text blocks to ensure results are visible to the LLM.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:03:19.998423931+01:00","updated_at":"2026-01-16T20:03:52.343830876+01:00","closed_at":"2026-01-16T20:03:52.343830876+01:00","close_reason":"Implemented text content blocks for all Exa tools."}
{"id":"tau-kao","title":"task tui: render nested task tool calls","description":"Detect activities where toolName==task inside a task worker run and render them as nested task blocks (task_type:difficulty, description, status icon, optional session_id, and a one-line output preview).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:45:57.095511909+01:00","updated_at":"2026-01-16T17:47:12.002285812+01:00","closed_at":"2026-01-16T17:47:12.002285812+01:00","close_reason":"Render nested task tool calls: capture tool result preview and show task_type:difficulty, description, session id, and output preview","dependencies":[{"issue_id":"tau-kao","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:45:57.10431211+01:00","created_by":"daemon"}]}
{"id":"tau-lgq","title":"Epic: In-process task workers (no pi subprocess)","description":"Replace TaskRunner's child_process.spawn('pi') worker execution with in-process AgentSession workers using the pi SDK (createAgentSession).nnGoalsn- No OS subprocess spawning for workersn- Keep session_id continuation (workers persistent across multiple task calls)n- Tools per worker/task come from TaskRegistry policy (strict allowlist)n- Preserve streaming updates + usage + TUI renderingn- Support nested task spawning in a single process (task tool available inside workers, per config)nnOut of scope (for now)n- Global tool locking / concurrency controlsnnDoDn- No remaining spawn('pi') usage in extensions/taskn- Manual validation: task tool runs a worker and returns output + session_id; session_id reuse continues contextn- Manual validation: nested task calls render reasonably","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T18:32:12.946092245+01:00","updated_at":"2026-01-16T19:11:12.458909588+01:00","closed_at":"2026-01-16T19:11:12.458909588+01:00","close_reason":"In-process worker backend implemented; subprocess removed; test checklist recorded","dependencies":[{"issue_id":"tau-lgq","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T18:32:12.955031927+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.1","title":"Investigate SDK worker sessions via createAgentSession","description":"Map feasibility of running delegated workers in-process using the pi SDK.nnScopen- Read /home/ribelo/projects/ribelo/pi-mono/packages/coding-agent/src/core/sdk.ts createAgentSession()n- Identify minimal CreateAgentSessionOptions needed for a headless worker (no extension discovery, controlled tools, controlled skills)n- Identify how to stream progress (AgentSession.subscribe events) and extract: tool calls, tool results, assistant text, usage, costnnFindingsn- createAgentSession(options) supports in-process AgentSession creation with custom tools/extensions and SessionManager.inMemory().n- AgentSession exposes tool APIs: getAllTools(), getActiveToolNames(), setActiveToolsByName(toolNames). setActiveToolsByName rebuilds system prompt with selected tools (supports built-in + extension tools if loaded).n- Tools selection: createAgentSession.tools affects built-in tools only; extension tools are registered via extension loading. To allow extension tools while enforcing allowlist, load needed extension factories (or allow discovery) then call session.setActiveToolsByName(allowedToolNames).n- Skills: set options.skills = [] to disable auto skill injection; continue appending worker skill content manually (same as current --no-skills + append-system-prompt behavior).n- System prompt: use options.systemPrompt = (defaultPrompt) =\u003e `${defaultPrompt}nn${workerPrompt}` to preserve default prompt + AGENTS.md context and append worker context/skills.n- Session persistence: keep a Map\u003csession_id, AgentSession\u003e in TaskRunner; construct each worker session with SessionManager.inMemory(cwd) and reuse the same AgentSession object across calls.nnRecommended createAgentSession options for workersn- cwd: parent cwdn- authStorage/modelRegistry: cached singletons from discoverAuthStorage() + discoverModels()n- sessionManager: SessionManager.inMemory(cwd)n- systemPrompt: function to append worker promptn- skills: []n- extensions: [] + inline extension factories for allowed extension tools (task/bd/exa), OR allow discovery then filter tools via setActiveToolsByNamen- tools: optional built-in tool list (but still call setActiveToolsByName for final allowlist)nnEvents to listen to (AgentSession.subscribe)n- tool_execution_start: toolCallId/toolName/args (start activity)n- tool_execution_end: toolCallId/result/isError (mark success/fail, optional result text)n- message_end (assistant): capture usage + last assistant text (turn count)n- message_end (toolResult): capture tool output text for activity previewn- message_update (assistant text_delta) if streaming preview is desirednnDeliverablen- Write a short note (in this issue description or a comment) with recommended createAgentSession() options for workers, including how to keep sessions persistent across calls.nnDoDn- Clear recommended options listn- Confirm which events to listen to for tool execution + message streaming + usage","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.761268104+01:00","updated_at":"2026-01-16T18:41:27.911632557+01:00","closed_at":"2026-01-16T18:41:27.911632557+01:00","close_reason":"Documented createAgentSession options + event mapping for in-process workers","dependencies":[{"issue_id":"tau-lgq.1","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.761639945+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.2","title":"Decide worker tool scope + nested task recursion policy","description":"We need one explicit decision before implementation:nnDecisionsn1) TaskRegistry.tools applies to BOTH built-in tools (read/bash/edit/write/ls/find/grep/...) and extension tools (e.g. task/bd/exa).n2) Workers may be allowed to call task (nested delegation) when included/allowed by the tool policy.n3) Default max nesting depth: 3. If exceeded, nested task call should fail fast with a clear error (not spawn).nnDoDn- Decision recorded in this issue (final answers)n- If nesting allowed: define default max depth + failure behavior when exceeded","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.779592749+01:00","updated_at":"2026-01-16T18:38:05.167791818+01:00","closed_at":"2026-01-16T18:38:05.167791818+01:00","close_reason":"Decisions recorded: tools allow built-in+extension; nested task allowed when permitted; max depth 3","dependencies":[{"issue_id":"tau-lgq.2","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.779922198+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.3","title":"Refactor task runner to support pluggable worker backend","description":"Prepare extensions/task for swapping the worker execution model.nnScopen- Identify code in extensions/task/src/runner.ts that is specific to child_process.spawn('pi')n- Introduce an internal abstraction (e.g. WorkerBackend) so we can implement InProcessWorkerBackend without rewriting higher-level logicnnDoDn- Clear separation between: (a) worker session orchestration, (b) backend executionn- No behavior changes yet","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.798047091+01:00","updated_at":"2026-01-16T18:53:13.996395599+01:00","closed_at":"2026-01-16T18:53:13.996395599+01:00","close_reason":"Refactored TaskRunner with WorkerBackend abstraction while keeping subprocess backend}","dependencies":[{"issue_id":"tau-lgq.3","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.798357164+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.4","title":"Implement in-process WorkerBackend using createAgentSession","description":"Implement worker execution without spawning OS processes.nnScopen- Replace spawn('pi') execution with an in-process AgentSession created by createAgentSession()n- Persist worker sessions in-memory keyed by session_id (reuse same AgentSession object across calls)n- Use SessionManager.inMemory() for worker sessions (no file sessions)n- Build worker system prompt from existing buildWorkerSystemPrompt() + injected skillsnnDoDn- Worker executes prompts successfully without spawning subprocessesn- session_id reuse continues prior worker contextn- No regressions: still returns final output to parent tool","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.817779665+01:00","updated_at":"2026-01-16T19:05:05.799294998+01:00","closed_at":"2026-01-16T19:05:05.799294998+01:00","close_reason":"Implemented in-process WorkerBackend using createAgentSession and switched TaskRunner to it}","dependencies":[{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.81809109+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.1","type":"blocks","created_at":"2026-01-16T18:34:21.686322207+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.2","type":"blocks","created_at":"2026-01-16T18:34:21.712413133+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.3","type":"blocks","created_at":"2026-01-16T18:34:21.728812581+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.5","title":"Stream worker events into task tool updates (no NDJSON parsing)","description":"Replace NDJSON stdout parsing with AgentSession.subscribe() event handling.nnScopen- Subscribe to worker AgentSession eventsn- Maintain TaskRunnerUpdateDetails incrementally:n  - activities list (toolCallId, toolName, args, status)n  - message preview (latest assistant text or latest tool output)n  - usage aggregation (turn count, input/output tokens, cost)n  - durationn- Feed onUpdate() for live TUI renderingnnDoDn- Live updates show tool activity while worker is runningn- Final result includes correct usage + durationn- Handles failure/abort cleanly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.836100031+01:00","updated_at":"2026-01-16T19:05:43.728462237+01:00","closed_at":"2026-01-16T19:05:43.728462237+01:00","close_reason":"In-process backend streams AgentSession events into TaskRunner (no NDJSON parsing for default path)}","dependencies":[{"issue_id":"tau-lgq.5","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.836421055+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.5","depends_on_id":"tau-lgq.4","type":"blocks","created_at":"2026-01-16T18:34:21.743838046+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.6","title":"Remove subprocess backend + cleanup task session plumbing","description":"Finalize migration away from OS process workers.nnScopen- Delete spawn('pi') code pathn- Remove temp prompt file handling that is no longer neededn- Update extensions/task/src/sessions.ts to reflect in-process sessions (store AgentSession/metadata instead of ChildProcess + sessionFile)n- Ensure nested task delegation still works with new architecture (as per recursion policy)nnDoDn- `rg \"spawn(\\\"pi\\\"\" extensions/task/src` returns no matchesn- Task tool works end-to-end in manual testing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.85492435+01:00","updated_at":"2026-01-16T19:10:39.736067182+01:00","closed_at":"2026-01-16T19:10:39.736067182+01:00","close_reason":"Removed subprocess backend and temp session plumbing; sessions now track in-process metadata}","dependencies":[{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.855245293+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq.5","type":"blocks","created_at":"2026-01-16T18:34:21.759222675+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq.2","type":"blocks","created_at":"2026-01-16T18:34:21.775318233+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.7","title":"Manual test plan + documentation for in-process workers","description":"Document how to validate the new worker model.nnTest checklistn1) Simple task run: call task tool with task_type=code and a simple bash echo; verify tool result returns output + session_id.n2) session_id continuation: call task again with same session_id; verify worker remembers prior context (ask it to summarize previous action).n3) Nested task call (if allowed): use task_type that allows task tool; prompt worker to delegate a sub-task; verify nested task renders and completes.n4) Max depth: attempt to nest beyond depth 3; verify task tool fails fast with a clear error.n5) Error handling: invalid task_type should return helpful error; worker failure should surface error text.nnDoDn- Checklist recorded in this issue (this description)}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.873621576+01:00","updated_at":"2026-01-16T19:10:56.210531566+01:00","closed_at":"2026-01-16T19:10:56.210531566+01:00","close_reason":"Recorded manual test checklist in issue description}","dependencies":[{"issue_id":"tau-lgq.7","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.873943461+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.7","depends_on_id":"tau-lgq.6","type":"blocks","created_at":"2026-01-16T18:34:21.792448587+01:00","created_by":"daemon"}]}
{"id":"tau-neg","title":"pi: sandboxed bash/edit/write with approvals (asrt)","description":"Implement sandboxing as a *tau extension* (no pi-mono core changes). Override built-in tools by registering tools with same names (bash/edit/write) and intercept policy/approvals. Use anthropic-experimental/sandbox-runtime (ASRT) for OS-level sandboxing of bash. Provide /sandbox + /approval commands with blocking prompts and per-call rerun. Persist state via session custom entries. Targets macOS + Linux. Workspace root = git repo root else cwd. Allow git commits; deny writes to \u003cworkspace\u003e/.git/hooks/** in non-danger modes.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-17T17:06:25.481232316+01:00","updated_at":"2026-01-17T17:31:51.736699409+01:00","comments":[{"id":1,"issue_id":"tau-neg","author":"ribelo","text":"Grounding notes (pi-mono):\\n- bash tool: packages/coding-agent/src/core/tools/bash.ts (pluggable BashOperations) and core/bash-executor.ts + AgentSession.executeBash()\\n- edit/write tools: src/core/tools/edit.ts, write.ts (currently no policy checks; uses resolveToCwd in path-utils.ts)\\n- interactive UI supports blocking confirm w/ timeout via ctx.ui.confirm (see interactive-mode.ts showExtensionConfirm())\\n- extension wrapper can intercept tool_call/tool_result, and extensions can register commands (/...) (see extensions/loader.ts + agent-session _tryExecuteExtensionCommand)\\n\\nPlan assumes implementing sandbox as a built-in inline extension factory loaded by default (so it can use ctx.ui.confirm and provide /sandbox + /approval).","created_at":"2026-01-17T16:08:56Z"},{"id":2,"issue_id":"tau-neg","author":"ribelo","text":"Decisions locked:\\n- Defaults on first run: fs=workspace-write, net=deny, approval=ask, timeout=60s; write these defaults into user settings (~/.pi/settings.json) if unset.\\n- Sandbox applies only to model tool calls (bash/edit/write), not user-triggered !/!! bash.\\n- Network policy: deny | allowlist(domains, supports *.example.com) | allow-all. Approval policy governs whether to prompt to temporarily override net/fs for a single rerun.\\n- Session overrides should persist by writing a session custom entry (SessionManager supports type=custom entries).\\n- Approval prompt escalation (best-effort):\\n  * If fs=read-only and a write is attempted: prompt to rerun once with fs=workspace-write (net unchanged).\\n  * If fs=workspace-write and write outside workspace: prompt to rerun once with fs=danger-full-access.\\n  * If write hits \u003cworkspace\u003e/.git/hooks/**: deny in non-danger modes, but when approval=ask, offer rerun once with fs=danger-full-access (explicit override).\\n  * If network denied (net=deny or allowlist miss): prompt to rerun once with net=allow-all (fs unchanged).\\n  * Headless/RPC: no prompt; deny.\\n","created_at":"2026-01-17T16:17:04Z"},{"id":4,"issue_id":"tau-neg","author":"ribelo","text":"Clarification: tau is an extensions workspace. Do NOT create repo-local .pi/extensions. Extensions live under tau/extensions/* and are installed by symlinking/copying into ~/.pi/agent/extensions/\u003cname\u003e. Sandbox work will only touch tau/extensions/sandbox/**.","created_at":"2026-01-17T16:40:33Z"}]}
{"id":"tau-neg.1","title":"Spike: run anthropic sandbox-runtime in pi execution","description":"Spike ASRT from tau extension context: add dependency in tau/extensions/sandbox, import in .pi/extensions/sandbox/index.ts, wrap+spawn command, verify mac+linux behavior, list deps (bwrap/socat/python3). DoD: findings in bd comment + minimal script/test.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:17.913295682+01:00","updated_at":"2026-01-17T17:31:51.754778785+01:00","dependencies":[{"issue_id":"tau-neg.1","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:17.913631065+01:00","created_by":"daemon"}]}
{"id":"tau-neg.10","title":"Define filesystem/network/approval policy model + settings layering","description":"Define sandbox policy model *inside tau sandbox extension*: filesystemMode (read-only|workspace-write|danger-full-access), networkMode (deny|allowlist|allow-all), networkAllowlist domains, approvalPolicy (never|ask|on-failure), approvalTimeoutSeconds (default 60). Implement config read/write: user (~/.pi/agent/settings.json) + project (\u003cworkspace\u003e/.pi/settings.json) + session overrides (session custom entry), with precedence session \u003e project \u003e user. DoD: unit tests in tau extension + docs comment.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:47.614267227+01:00","updated_at":"2026-01-17T17:42:08.26986767+01:00","closed_at":"2026-01-17T17:42:08.26986767+01:00","close_reason":"Policy model + config layering implemented in tau/extensions/sandbox with tests","dependencies":[{"issue_id":"tau-neg.10","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:47.615854449+01:00","created_by":"daemon"}],"comments":[{"id":5,"issue_id":"tau-neg.10","author":"ribelo","text":"Implemented sandbox policy model + settings layering inside tau/extensions/sandbox (no repo-local .pi).n- Config types: filesystemMode/networkMode/allowlist/approvalPolicy/timeoutn- Reads: ~/.pi/agent/settings.json (user) + \u003cworkspace\u003e/.pi/settings.json (project) + sessionOverride paramn- Precedence: session \u003e project \u003e usern- ensureUserDefaults() writes defaults into user settings (only fills missing keys)n- Added vitest tests in extensions/sandbox/test (isolated via TAU_SANDBOX_USER_SETTINGS_PATH env)nDoD progress: core model + tests are in place; remaining: wire session overrides + command UI in tau-neg.3.","created_at":"2026-01-17T16:41:35Z"}]}
{"id":"tau-neg.2","title":"Workspace root detection (git root else cwd)","description":"Implement workspace root discovery inside extension (git rev-parse --show-toplevel else ctx.cwd) used for sandbox roots and project settings location. DoD: unit tests.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T17:07:38.72607795+01:00","updated_at":"2026-01-17T17:31:51.788871405+01:00","dependencies":[{"issue_id":"tau-neg.2","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.727212059+01:00","created_by":"daemon"}]}
{"id":"tau-neg.3","title":"Add built-in sandbox extension skeleton + /sandbox and /approval commands","description":"Create tau sandbox extension: .pi/extensions/sandbox/index.ts (real implementation) + extensions/sandbox/src/index.ts re-export + package.json. Register /sandbox + /approval commands (interactive picker UX) and override tools bash/edit/write by registering same names. Persist state via session custom entries (customType sandbox_state). DoD: manual QA in TUI.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.749451539+01:00","updated_at":"2026-01-17T17:31:51.806252094+01:00","dependencies":[{"issue_id":"tau-neg.3","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.749883518+01:00","created_by":"daemon"},{"issue_id":"tau-neg.3","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.749914567+01:00","created_by":"daemon"}],"comments":[{"id":3,"issue_id":"tau-neg.3","author":"ribelo","text":"Session persistence confirmed: store current sandbox+approval state (fs mode, net mode, allowlist, approval policy, timeout) as session CustomEntry (type=custom, customType like 'sandbox_state') so resume keeps settings. Use pi.appendEntry from extension command handlers; reconstruct state by scanning session entries on session_start.","created_at":"2026-01-17T16:18:47Z"}]}
{"id":"tau-neg.4","title":"Enforce filesystem policy for edit/write (realpath checks + deny .git/hooks)","description":"Implement edit/write tools in extension (override built-ins) with realpath-safe enforcement: read-only denies writes (except /tmp + $TMPDIR), workspace-write allows only under workspace root, danger allows all. Deny writes to \u003cworkspace\u003e/.git/hooks/** unless danger-full-access. DoD: unit tests + meaningful errors.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.77294451+01:00","updated_at":"2026-01-17T17:31:51.823309295+01:00","dependencies":[{"issue_id":"tau-neg.4","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.77328717+01:00","created_by":"daemon"},{"issue_id":"tau-neg.4","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.765494871+01:00","created_by":"daemon"},{"issue_id":"tau-neg.4","depends_on_id":"tau-neg.2","type":"blocks","created_at":"2026-01-17T17:08:33.827395268+01:00","created_by":"daemon"}]}
{"id":"tau-neg.5","title":"Sandboxed bash execution via ASRT with fs+network modes","description":"Implement bash tool override in extension using ASRT for OS-level sandboxing (mac+linux). Map filesystemMode/networkMode/allowlist into ASRT config. Include deny-write for \u003cworkspace\u003e/.git/hooks/** (unless danger). Best-effort linux denial heuristics; meaningful error text. DoD: gated integration test + manual QA.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.795798835+01:00","updated_at":"2026-01-17T17:31:51.840071712+01:00","dependencies":[{"issue_id":"tau-neg.5","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.796082289+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.1","type":"blocks","created_at":"2026-01-17T17:08:33.733119108+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.81243869+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.2","type":"blocks","created_at":"2026-01-17T17:08:33.842317114+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.7","type":"blocks","created_at":"2026-01-17T17:08:33.856811047+01:00","created_by":"daemon"}]}
{"id":"tau-neg.6","title":"Approval flow: ask+timeout + rerun tool call with elevated permission","description":"Implement approval flow in extension for denied operations: never-\u003edeny; ask-\u003eblocking prompt (60s, notify-send if available) then rerun tool call once with elevated permission (fs or net) for this call only; on-failure-\u003eprompt only when likely policy-related. Headless/RPC: deny. DoD: unit tests for decision logic + manual QA.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.817206855+01:00","updated_at":"2026-01-17T17:31:51.85656731+01:00","dependencies":[{"issue_id":"tau-neg.6","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.817534207+01:00","created_by":"daemon"},{"issue_id":"tau-neg.6","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.780526415+01:00","created_by":"daemon"}]}
{"id":"tau-neg.7","title":"Missing sandbox dependencies handling (prompt once per session)","description":"Detect missing ASRT deps (linux: bwrap/socat/python3; mac: sandbox-exec, optional rg). Prompt once per session to allow unsandboxed bash execution (still keep edit/write enforcement). Cache decision in session state. DoD: unit tests + QA.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T17:07:38.83909539+01:00","updated_at":"2026-01-17T17:31:51.873319647+01:00","dependencies":[{"issue_id":"tau-neg.7","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.839435786+01:00","created_by":"daemon"},{"issue_id":"tau-neg.7","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.797182552+01:00","created_by":"daemon"}]}
{"id":"tau-neg.8","title":"Add vitest coverage for sandbox policies (unit + gated integration)","description":"Add vitest coverage in tau extension workspace: policy merging, settings precedence, workspace root detection, realpath enforcement, approval decision logic. Add OS-gated integration tests for ASRT when env PI_SANDBOX_TESTS=1. DoD: green tests.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.859097387+01:00","updated_at":"2026-01-17T17:31:51.88968711+01:00","dependencies":[{"issue_id":"tau-neg.8","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.85938536+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.5","type":"blocks","created_at":"2026-01-17T17:08:33.871245832+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.4","type":"blocks","created_at":"2026-01-17T17:08:33.886092592+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.6","type":"blocks","created_at":"2026-01-17T17:08:33.901229175+01:00","created_by":"daemon"}]}
{"id":"tau-neg.9","title":"Docs: sandbox/approval usage + troubleshooting","description":"Docs in tau extension: /sandbox + /approval usage, defaults, allowlist syntax, deps to install, troubleshooting. DoD: README under .pi/extensions/sandbox and extensions/sandbox.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-17T17:07:38.879022437+01:00","updated_at":"2026-01-17T17:31:51.905681849+01:00","dependencies":[{"issue_id":"tau-neg.9","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.879304008+01:00","created_by":"daemon"},{"issue_id":"tau-neg.9","depends_on_id":"tau-neg.6","type":"blocks","created_at":"2026-01-17T17:08:33.917850991+01:00","created_by":"daemon"},{"issue_id":"tau-neg.9","depends_on_id":"tau-neg.5","type":"blocks","created_at":"2026-01-17T17:08:33.933079229+01:00","created_by":"daemon"}]}
{"id":"tau-r8o","title":"Fix worked-for prompt causing infinite generation","description":"Rendering 'Worked for …' looks fine, but the data/prompt being sent to the model appears to include a recursive or unbounded representation (possibly a function, HTML, or repeating string) causing the model to never stop talking. Investigate worked-for.ts prompt construction + call sites and fix to send bounded, plain-text content.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-16T00:24:35.551771099+01:00","updated_at":"2026-01-16T00:34:48.438814703+01:00","closed_at":"2026-01-16T00:34:48.438814703+01:00","close_reason":"Closed"}
{"id":"tau-s7j","title":"task tui: show worker duration in usage line","description":"Measure wall-clock duration of worker run and include it in the footer usage line (e.g. '10s 2 turns ↑…').","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:35:36.422495453+01:00","updated_at":"2026-01-16T17:38:03.689332797+01:00","closed_at":"2026-01-16T17:38:03.689332797+01:00","close_reason":"Measured worker wall time and display it in task footer usage line","dependencies":[{"issue_id":"tau-s7j","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:35:36.431290871+01:00","created_by":"daemon"}]}
{"id":"tau-tge","title":"Add structured output support for task workers","description":"Add optional 'output_schema' parameter to task tool.nnWhen provided:n1. Validate JSON schema before spawning workern2. Inject a 'submit_result' tool matching the schema into workern3. Force tool-only mode (no free text response) on the providern4. Return parsed structured data instead of textnnThis enables programmatic processing of worker results.nnProviders support forcing tool use:n- Anthropic: tool_choice.type = 'any'n- OpenAI: tool_choice = 'required'n- Gemini: toolConfig.functionCallingConfig.mode = 'ANY'","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T22:18:17.94547851+01:00","updated_at":"2026-01-16T22:42:50.12537049+01:00","closed_at":"2026-01-16T22:42:50.12537049+01:00","close_reason":"Done"}
{"id":"tau-tgp","title":"DemoGraph: Multi-JSON output parsing","description":"Related + discovered-from example (non-blocking deps).","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-16T00:49:49.946226445+01:00","updated_at":"2026-01-16T00:49:49.946226445+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-tgp","depends_on_id":"tau-8wx.3","type":"discovered-from","created_at":"2026-01-16T00:49:49.946628703+01:00","created_by":"daemon"},{"issue_id":"tau-tgp","depends_on_id":"tau-8wx.2","type":"related","created_at":"2026-01-16T00:49:49.946902496+01:00","created_by":"daemon"}]}
{"id":"tau-tt5","title":"skill-marker: package extension + add install script for global pi extensions","description":"User reports skill-marker not loading globally; their ~/.pi/agent/extensions uses symlinks to tau/extensions/* packages (beads/exa/task/tau).nnWork:n- Create tau/extensions/skill-marker as a proper extension package (package.json with pi.extensions, src/index.ts).n- Make tau/.pi/extensions/skill-marker/index.ts re-export from tau/extensions/skill-marker/src/index.ts to avoid duplication.n- Add an install helper script in tau to symlink (or copy) extensions into ~/.pi/agent/extensions, including skill-marker.nnDoD:n- Running the install script results in ~/.pi/agent/extensions/skill-marker pointing to tau/extensions/skill-marker.n- `pi` shows skill-marker in 'Loaded extensions' list outside the tau repo.n- Docs updated with the new install path/script.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:29:05.084242187+01:00","updated_at":"2026-01-17T17:35:35.359763715+01:00","closed_at":"2026-01-17T17:35:35.359763715+01:00","close_reason":"Removed repo-local ./.pi/extensions; packaged skill-marker under extensions/skill-marker; added scripts/pi/install-extensions.sh and updated AGENTS.md + global symlinks"}
{"id":"tau-vze","title":"task tool: reject unknown session_id","description":"If session_id is provided but not known to the SessionManager, return an error instead of silently creating a new session.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T19:34:02.449567153+01:00","updated_at":"2026-01-16T19:35:51.133002784+01:00","closed_at":"2026-01-16T19:35:51.133002784+01:00","close_reason":"Unknown session_id now errors instead of starting a new session","dependencies":[{"issue_id":"tau-vze","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-16T19:34:02.458508738+01:00","created_by":"daemon"}]}
{"id":"tau-wf1","title":"task tool: fail on missing skills","description":"If any requested skills are missing, return an error and do not run the worker. Include missing skill names in the error message.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T19:34:09.829173876+01:00","updated_at":"2026-01-16T19:35:57.841827531+01:00","closed_at":"2026-01-16T19:35:57.841827531+01:00","close_reason":"Missing skills now fail fast with explicit error","dependencies":[{"issue_id":"tau-wf1","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-16T19:34:09.829669812+01:00","created_by":"daemon"}]}
{"id":"tau-xdn","title":"Error when task type config references non-existent skills","description":"Same issue as tau-8oj but for skills.\n\nCurrently, if a task type config specifies skills that don't exist, they are silently ignored.\n\nExpected behavior:\n- Validate that all skills in task type configs exist\n- Produce clear error listing unknown skills\n- Fail fast on invalid config\n\nRelated: tau-8oj (same issue for tools)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:30:16.869912146+01:00","updated_at":"2026-01-17T02:38:37.773872447+01:00","closed_at":"2026-01-17T02:38:37.773872447+01:00","close_reason":"Validate task tool configs and error on unknown skill names."}
