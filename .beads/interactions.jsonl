{"id":"tau-003","title":"fix: make $skill autocomplete work with tau terminal prompt editor","description":"Bug: skill-marker extension sets a custom editor via ctx.ui.setEditorComponent, but tau/terminal-prompt also sets a custom editor and is loaded after skill-marker, overwriting it. Result: $skill autocomplete stops working globally.\n\nFix approach:\n- Stop skill-marker extension from owning the editor (no ctx.ui.setEditorComponent).\n- Implement $skill autocomplete + auto-trigger inside tau terminal prompt editor (TerminalPromptEditor), since it owns the editor.\n- Keep skill-marker extension responsible for skill injection only.\n\nDoD:\n- With global extensions installed, typing '$' shows skill suggestions even outside tau repo.\n- / and @ completions remain unchanged.\n- Skill injection still works.\n","notes":"Revising approach: use editor-hub plugin composition so terminal-prompt and skill-marker remain independent; do not move logic into terminal-prompt directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:43:20.290055176+01:00","updated_at":"2026-01-17T17:50:40.621339319+01:00","closed_at":"2026-01-17T17:50:40.621339319+01:00","close_reason":"Resolved via editor-hub plugin composition; skill-marker and terminal-prompt no longer fight over editor ownership"}
{"id":"tau-05f","title":"Add task-delegation skill to task extension","description":"Move /tmp/task-delegation/SKILL.md into extensions/task and copy it into ~/.pi/agent/skills/task-delegation/SKILL.md on startup if missing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:11:28.806891138+01:00","updated_at":"2026-01-17T01:12:11.613053671+01:00","closed_at":"2026-01-17T01:12:11.613053671+01:00","close_reason":"Added task-delegation skill bundle and install-on-missing logic."}
{"id":"tau-0mv","title":"Task tool field renames (type/size/result_schema)","description":"Replace task tool fields with type/size/result_schema, update validation, messages, response payload, and rendering. No backward compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:42:15.685676185+01:00","updated_at":"2026-01-17T00:48:28.595006069+01:00","closed_at":"2026-01-17T00:48:28.595006069+01:00","close_reason":"Replaced task tool fields with type/size/result_schema and updated payloads/messages."}
{"id":"tau-13i","title":"extension: auto-trigger $skill autocomplete while typing","description":"Add editor behavior so typing '$' triggers the autocomplete list immediately, similar to how '/' command suggestions appear without pressing Tab.nnImplementation notes:n- Implement in .pi/extensions/skill-marker/index.ts within SkillMarkerEditor.n- After super.handleInput inserts a char, if we are in $skill token context and autocomplete is not already open, invoke Editor's internal autocomplete trigger (via runtime method access).n- Must not break existing '/' and '@' autocomplete behavior.nnDoD:n- Typing '$' (at start or after whitespace) immediately shows skill suggestions (no Tab).n- Continuing to type updates suggestions.n- '$' not preceded by whitespace does not trigger.n- Manual check: '/mo' and '@' autocomplete still behave exactly as before.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:58:53.078911903+01:00","updated_at":"2026-01-17T16:59:20.625140361+01:00","closed_at":"2026-01-17T16:59:20.625140361+01:00","close_reason":"Implemented auto-trigger for $skill autocomplete on typing '$' (no Tab required)","dependencies":[{"issue_id":"tau-13i","depends_on_id":"tau-2lq","type":"discovered-from","created_at":"2026-01-17T16:58:53.088178418+01:00","created_by":"daemon"}]}
{"id":"tau-1q7","title":"chore: configure git remote for tau and set upstream","description":"This repo currently has no git remotes configured (.git/config has no [remote]). Add origin and set main to track origin/main so git pull --rebase and git push work.","status":"closed","priority":1,"issue_type":"chore","created_at":"2026-01-16T16:32:41.236898376+01:00","updated_at":"2026-01-16T16:34:29.064810293+01:00","closed_at":"2026-01-16T16:34:29.064810293+01:00","close_reason":"Added origin remote (https://github.com/ribelo/tau), pushed main, and verified upstream tracking"}
{"id":"tau-1vq","title":"Add padding line between worked-for separator and prompt","description":"After the worked-for separator widget, add a single empty row of vertical spacing before the editor/prompt renders.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:34:17.456419231+01:00","updated_at":"2026-01-16T00:34:46.135108646+01:00","closed_at":"2026-01-16T00:34:46.135108646+01:00","close_reason":"Closed"}
{"id":"tau-2bl","title":"task tool: return worker output to caller","description":"Fix task tool so the LLM receives actual text content (last assistant message or last tool result) as the tool result. Stop returning content blocks of type 'json' (they are not passed through). Include session_id in returned text for continuation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:44:55.909433488+01:00","updated_at":"2026-01-16T16:47:28.887229686+01:00","closed_at":"2026-01-16T16:47:28.887229686+01:00","close_reason":"task tool now returns text tool result (last assistant or tool output) and includes session_id; stopped returning json blocks","dependencies":[{"issue_id":"tau-2bl","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T16:44:55.918351468+01:00","created_by":"daemon"}]}
{"id":"tau-2c9","title":"Epic: Sandbox failure diagnostics for model clarity","description":"When commands fail inside sandbox, the model often sees cryptic errors like 'Could not resolve host' or 'Permission denied' without understanding these are sandbox restrictions, not real system issues.\n\nProblem:\n- ASRT removes network namespace, so network blocks surface as DNS failures\n- Model misdiagnoses sandbox denials as 'DNS broken' or 'system issue'\n- No structured way for model to know WHY a command failed\n\nSolution:\n- Classify sandbox failures by type (network/filesystem) and subtype (dns/blocked/write)\n- Gate diagnostics using known sandbox config (reduce false positives)\n- Emit clear diagnostic message into tool output stream\n- Optionally include machine-readable JSON blob\n\nRef: ASRT design uses proxies outside sandbox via Unix sockets, so network denial = no network namespace = DNS-like errors.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-18T02:32:18.667434158+01:00","updated_at":"2026-01-18T02:50:13.617045301+01:00","closed_at":"2026-01-18T02:50:13.617045301+01:00","close_reason":"Implemented sandbox failure diagnostics: structured classifier + human + JSON emission, verified ASRT allow-all semantics"}
{"id":"tau-2c9.1","title":"Add classifySandboxFailure() with structured failure types","description":"Replace boolean-only looksLikePolicyViolation() with richer classifier that returns structured failure info:\n\ntype SandboxFailure =\n  | { kind: 'network'; subtype: 'dns' | 'blocked' | 'connect'; evidence: string; confidence: 'high' | 'medium' }\n  | { kind: 'filesystem'; subtype: 'read' | 'write'; evidence: string; confidence: 'high' | 'medium' }\n  | { kind: 'unknown'; evidence: string; confidence: 'low' };\n\nPatterns to detect:\n- Network/blocked (high): 'connection blocked by network allowlist' (ASRT explicit)\n- Network/dns (medium): 'could not resolve host', 'temporary failure in name resolution', ENOTFOUND, EAI_AGAIN\n- Filesystem/write (high): 'read-only file system', 'permission denied', 'operation not permitted'\n\nKeep looksLikePolicyViolation() for approval prompt, use classifier for diagnostics.\n\nDoD: function + unit tests covering all patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T02:32:34.751081319+01:00","updated_at":"2026-01-18T02:48:47.420288206+01:00","closed_at":"2026-01-18T02:48:47.420288206+01:00","close_reason":"Implemented classifySandboxFailure() with tests; wired looksLikePolicyViolation to classifier","dependencies":[{"issue_id":"tau-2c9.1","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:32:34.751494608+01:00","created_by":"ribelo"}]}
{"id":"tau-2c9.2","title":"Emit sandbox diagnostic into tool output on failure","description":"After runCommandCapture() returns with error, if usingSandbox \u0026\u0026 exitCode !== 0:\n\n1. Call classifySandboxFailure(result.output)\n2. Gate by config consistency:\n   - network failure → only if networkMode !== 'allow-all'\n   - filesystem failure → only if filesystemMode !== 'danger-full-access'\n3. Emit diagnostic via onData():\n   '[sandbox] Command failed likely due to sandbox restrictions (network/dns). (fs=workspace-write, net=deny). Evidence: \"Could not resolve host\". Network sandboxing on Linux can surface as DNS failures. If network is required, switch to allowlist/allow-all or re-run with escalate=true.'\n\nThis ensures model sees WHY command failed, not just cryptic error.\n\nDoD: integration into bash handler + manual QA with network-denied curl","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T02:32:50.478067311+01:00","updated_at":"2026-01-18T02:48:52.498035588+01:00","closed_at":"2026-01-18T02:48:52.498035588+01:00","close_reason":"Emit sandbox diagnostic + gating and guidance into bash tool output on sandbox failure","dependencies":[{"issue_id":"tau-2c9.2","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:32:50.479016242+01:00","created_by":"ribelo"},{"issue_id":"tau-2c9.2","depends_on_id":"tau-2c9.1","type":"blocks","created_at":"2026-01-18T02:33:25.641202573+01:00","created_by":"ribelo"}]}
{"id":"tau-2c9.3","title":"Add machine-readable SANDBOX_DIAGNOSTIC JSON line","description":"Optionally emit a single JSON line that model can parse reliably:\n\nSANDBOX_DIAGNOSTIC={\n  \"usingSandbox\": true,\n  \"filesystemMode\": \"workspace-write\",\n  \"networkMode\": \"deny\",\n  \"networkAllowlist\": null,\n  \"classification\": { \"kind\": \"network\", \"subtype\": \"dns\", \"evidence\": \"Could not resolve host\", \"confidence\": \"medium\" }\n}\n\nThis avoids model hallucinating why DNS failed.\n\nDoD: JSON emission + system prompt hint about parsing SANDBOX_DIAGNOSTIC","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T02:33:01.968450085+01:00","updated_at":"2026-01-18T02:48:57.573066566+01:00","closed_at":"2026-01-18T02:48:57.573066566+01:00","close_reason":"Emit SANDBOX_DIAGNOSTIC=\u003cjson\u003e machine-readable line in bash output","dependencies":[{"issue_id":"tau-2c9.3","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:33:01.968931674+01:00","created_by":"ribelo"},{"issue_id":"tau-2c9.3","depends_on_id":"tau-2c9.2","type":"blocks","created_at":"2026-01-18T02:33:30.714772293+01:00","created_by":"ribelo"}]}
{"id":"tau-2c9.4","title":"Verify ASRT allow-all semantics (empty allowedDomains)","description":"CRITICAL: Current code may have wrong semantics!\n\nIn wrapCommandWithSandbox(), for allow-all we currently have network config with empty arrays. But ASRT README says empty allowedDomains = NO network access (block all).\n\nNeed to verify:\n1. Check installed ASRT version behavior\n2. For true 'allow-all': either omit network field entirely OR use explicit wildcard\n3. Current code already omits network for allow-all - verify this is correct\n\nIf empty arrays block network, this explains confusing DNS failures in allow-all mode.\n\nDoD: verify behavior + fix if needed + add comment explaining correct semantics","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T02:33:15.112467762+01:00","updated_at":"2026-01-18T02:49:02.647505473+01:00","closed_at":"2026-01-18T02:49:02.647505473+01:00","close_reason":"Verified ASRT allow-all semantics and added coverage for allowlist→allow-all reset","dependencies":[{"issue_id":"tau-2c9.4","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:33:15.11291178+01:00","created_by":"ribelo"}]}
{"id":"tau-2lq","title":"pi: $skill marker autocomplete + skill injection extension","description":"Goal: Implement a pi extension that lets users type $skillname with autocomplete and injects the corresponding SKILL.md contents as a separate \u003cskill\u003e...\u003c/skill\u003e message before the agent starts (codex-style: marker + injected instructions, not inline expansion).nnKey code anchors (pi-mono):n- Input hook order: src/core/agent-session.ts (prompt(): input event -\u003e /skill expansion -\u003e before_agent_start)n- Autocomplete provider: src/modes/interactive/interactive-mode.ts (CombinedAutocompleteProvider)n- Custom editor injection: src/modes/interactive/interactive-mode.ts (setCustomEditorComponent)n- Skills discovery: src/core/skills.ts + src/core/sdk.ts (discoverSkills/loadSettings)nnDefinition of Done:n- Project-local extension (./.pi/extensions/*) provides $skill autocomplete and injects skill bodies before LLM turn.n- Works alongside existing / commands and @ file autocomplete.n- Documented usage and manual test steps.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-17T16:11:06.707164144+01:00","updated_at":"2026-01-17T16:42:27.566712635+01:00","closed_at":"2026-01-17T16:42:27.566712635+01:00","close_reason":"Implemented project-local skill-marker extension (autocomplete + before_agent_start injection). Optional upstream API improvement deferred in tau-2lq.7."}
{"id":"tau-2lq.1","title":"spec: define  marker semantics and injected \u003cskill\u003e format","description":"Decisions for $skill marker + injection (codex-style marker + separate injected instructions message).\n\n## Marker detection\n- Syntax: `$` + skill name\n- Name charset: `[a-z0-9][a-z0-9-]*` (lowercase + digits + hyphen).\n- Boundary rules:\n  - Marker must start at beginning of prompt or be preceded by whitespace.\n  - Name ends at the first non `[a-z0-9-]` char (punctuation ok after).\n  - Examples matched: `$beads`, `use $beads, please`, `\n$beads do X`\n  - Examples NOT matched: `$PATH` (uppercase), `foo$beads` (no whitespace boundary), `\\$beads` (escaped)\n\n## Escaping\n- Escape syntax: `\\$name` (a backslash immediately before `$`) disables injection and leaves literal text.\n\n## Multiple skills\n- Multiple markers may appear in one prompt.\n- Dedupe by skill name, keep the order of first occurrence.\n\n## Prompt text handling\n- Do NOT inline-expand the user prompt.\n- Keep the `$skill` markers unchanged in the user prompt text (transparent + harmless).\n\n## Injected payload\n- Inject a separate extension custom message before the LLM call containing one or more blocks:\n\n```\n\u003cskill\u003e\n\u003cname\u003ebeads\u003c/name\u003e\n\u003cpath\u003e/abs/path/to/SKILL.md\u003c/path\u003e\n\u003cinstructions\u003e\n...SKILL.md body (frontmatter stripped)...\n\u003c/instructions\u003e\n\u003c/skill\u003e\n```\n\n- Injected instructions use pi behavior: strip YAML frontmatter (same as `/skill:name` expansion).\n\n## Size limits\n- Apply truncation to injected instructions using pi defaults: max 2000 lines OR 50KB (whichever hits first).\n- If truncated, append a note inside `\u003cinstructions\u003e`: `[Skill content truncated; full content at: \u003cpath\u003e]`.\n\n## Error handling\n- Unknown skill name: do not inject; optionally notify user via UI (if available).\n- Unreadable SKILL.md: do not inject; notify user via UI (if available).\n\nDoD examples\n- `$beads do X` injects beads SKILL.md body as separate message.\n- `\\$beads` does not inject.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.779585404+01:00","updated_at":"2026-01-17T16:35:00.818137983+01:00","closed_at":"2026-01-17T16:35:00.818137983+01:00","close_reason":"Spec decisions captured in description","dependencies":[{"issue_id":"tau-2lq.1","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.779921829+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.2","title":"extension: scaffold project-local skill-marker extension","description":"Create a project-local pi extension skeleton under ./.pi/extensions/skill-marker/ (index.ts + README).\n\nImplementation notes:\n- Must be auto-discovered by pi (project-local).\n- No startup banners / console.log noise.\n- Provide minimal configuration knobs (e.g. enable/disable, marker char) via constants or env vars.\n\nDoD:\n- .pi/extensions/skill-marker/index.ts exists and loads in pi without errors.\n- README describes how to enable globally (copy to ~/.pi/agent/extensions/) if desired.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.800549346+01:00","updated_at":"2026-01-17T16:35:26.740761485+01:00","closed_at":"2026-01-17T16:35:26.740761485+01:00","close_reason":"Scaffolded project-local extension with README","dependencies":[{"issue_id":"tau-2lq.2","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.800876353+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.3","title":"extension: discover skills + build lookup index","description":"Implement skill discovery inside the extension using pi APIs (import from @mariozechner/pi-coding-agent):\n- loadSettings(cwd, agentDir) to respect existing skills settings\n- discoverSkills(cwd, agentDir, settings.skills) to get names/descriptions/paths\n- Build in-memory index: name -\u003e { path, description }\n- Cache SKILL.md contents on first use (strip frontmatter for injected body if we choose)\n\nCode anchors (pi-mono reference):\n- skills discovery logic: packages/coding-agent/src/core/skills.ts\n- sdk helpers: packages/coding-agent/src/core/sdk.ts (discoverSkills, loadSettings)\n\nDoD:\n- Given a known local skill, extension can resolve name -\u003e SKILL.md path reliably.\n- Handles missing/disabled/invalid skills gracefully (notify or ignore per spec).\n- No filesystem scanning on every keystroke (cache or debounce).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.822095914+01:00","updated_at":"2026-01-17T16:36:12.945527135+01:00","closed_at":"2026-01-17T16:36:12.945527135+01:00","close_reason":"Implemented skill discovery + in-memory index and cached body loader","dependencies":[{"issue_id":"tau-2lq.3","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.82239641+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.3","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:29.98080527+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.4","title":"extension:  autocomplete in editor (wrap existing provider)","description":"Add $skill autocomplete while typing in pi interactive editor.\n\nApproach:\n- ctx.ui.setEditorComponent() install CustomEditor subclass that wraps the existing autocomplete provider injected by interactive-mode.\n- Implement AutocompleteProvider wrapper:\n  - If cursor is at token matching (start|whitespace) + \"$\" + partialName =\u003e return skill suggestions (fuzzy match).\n  - applyCompletion inserts \"$\" + skillName only (no expansion).\n  - Otherwise delegate to underlying provider so / commands and @file completion keep working.\n\nCode anchors (pi-mono reference):\n- Autocomplete provider: packages/coding-agent/src/modes/interactive/interactive-mode.ts (CombinedAutocompleteProvider)\n- Editor supports custom autocomplete providers: packages/tui/src/components/editor.ts + packages/tui/src/autocomplete.ts\n\nDoD:\n- Typing \"$be\" + Tab suggests beads (if available) and inserts \"$beads\".\n- Existing / and @ completion still works unchanged.\n- No noticeable lag while typing.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.842937862+01:00","updated_at":"2026-01-17T16:37:45.708017135+01:00","closed_at":"2026-01-17T16:37:45.708017135+01:00","close_reason":"Implemented $skill autocomplete by wrapping existing editor autocomplete provider","dependencies":[{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.843236264+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:29.998136193+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.2","type":"blocks","created_at":"2026-01-17T16:12:30.016243816+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.3","type":"blocks","created_at":"2026-01-17T16:12:30.03395951+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.5","title":"extension: inject skill instructions before agent_start (codex-style)","description":"Implement skill injection at send-time.\n\nApproach:\n- Use before_agent_start event to detect explicit mentions of $skill tokens in the prompt.\n- For each resolved skill, read SKILL.md and inject a separate custom message into the turn context containing one or more \u003cskill\u003e blocks.\n- Do NOT inline-expand the user prompt text; keep marker or strip per spec task.\n\nInjected message format should include name + path + contents (codex-inspired), e.g.:\n\u003cskill\u003e\n\u003cname\u003ebeads\u003c/name\u003e\n\u003cpath\u003e/abs/.../SKILL.md\u003c/path\u003e\n...contents...\n\u003c/skill\u003e\n\nDoD:\n- With $skill mention, a custom message is added before the user message reaches the model.\n- Supports multiple $skills in one prompt (deduped)\n- Unknown skill leaves prompt unchanged + user notified (or silent) per spec.\n- Escaped \\$skill is not injected.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.862085184+01:00","updated_at":"2026-01-17T16:38:35.357668778+01:00","closed_at":"2026-01-17T16:38:35.357668778+01:00","close_reason":"Implemented before_agent_start skill injection as separate \u003cskill\u003e blocks","dependencies":[{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.862380019+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:30.051487502+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.2","type":"blocks","created_at":"2026-01-17T16:12:30.06904926+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.3","type":"blocks","created_at":"2026-01-17T16:12:30.086927194+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.6","title":"docs/qa: usage docs + manual test checklist","description":"Write concise docs and a manual QA checklist for the extension.\n\nDocs must cover:\n- How to install project-locally (./.pi/extensions/skill-marker/)\n- How to install globally (~/.pi/agent/extensions/)\n- Examples: $beads, multiple skills, escaping\n- Known limitations (context size, skill filtering vs --skills, etc.)\n\nQA checklist DoD:\n- Steps to verify autocomplete for $ / existing / commands / @ file refs\n- Steps to verify injected message appears in context (by observing model behavior or logs)\n- Error handling checks (missing skill, unreadable SKILL.md)\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-17T16:12:16.881456894+01:00","updated_at":"2026-01-17T16:42:24.433041158+01:00","closed_at":"2026-01-17T16:42:24.433041158+01:00","close_reason":"Docs and manual QA checklist added to extension README","dependencies":[{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.881784242+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq.4","type":"blocks","created_at":"2026-01-17T16:12:30.104153448+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq.5","type":"blocks","created_at":"2026-01-17T16:12:30.127249369+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.7","title":"optional: pi core API - expose discovered skills to extensions","description":"Optional upstream improvement (pi-mono): expose the discovered skills list (name/description/path) to extensions via ExtensionContext or ExtensionAPI.\n\nRationale:\n- Extension currently must re-run discoverSkills() and may not respect CLI --skills filtering.\n- A first-class API would make $skill autocomplete/injection consistent with pi core.\n\nDoD:\n- Proposed API shape documented in issue (and implemented if we choose to upstream).\n- If implemented: minimal tests + docs update in pi-mono.\n","notes":"Optional upstream pi-mono API improvement; extension works without it.","status":"deferred","priority":4,"issue_type":"task","created_at":"2026-01-17T16:12:16.900610928+01:00","updated_at":"2026-01-17T16:42:24.449241658+01:00","dependencies":[{"issue_id":"tau-2lq.7","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.900933075+01:00","created_by":"daemon"}]}
{"id":"tau-2q6","title":"sandbox: move initial state from system prompt to user part[0]","description":"Adjust sandbox prompt strategy: system prompt (first turn) only describes sandbox semantics; current sandbox state must be injected as user message content[0] even on first message (SANDBOX_STATE). Avoid conflicting state between system and user channels.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T11:21:14.661255868+01:00","updated_at":"2026-01-18T11:23:30.670176838+01:00","closed_at":"2026-01-18T11:23:30.670176838+01:00","close_reason":"System prompt now describes sandbox semantics only; initial SANDBOX_STATE is injected into user message content[0], with SANDBOX_CHANGE used for mid-session updates"}
{"id":"tau-2xo","title":"Rename task_type 'general' to 'custom'","description":"The 'general' task type name is too vague. Rename to 'custom' to better indicate it's a user-configurable task type that accepts skills injection.nnChanges needed:n- Update task_type validationn- Update documentationn- Remove 'general' alias entirely (no backward compatibility)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:18:17.919781343+01:00","updated_at":"2026-01-16T22:21:50.26924761+01:00","closed_at":"2026-01-16T22:21:50.26924761+01:00","close_reason":"Renamed task_type general to custom and removed alias}"}
{"id":"tau-3a6","title":"Fix bd tool wrapper returning empty results","description":"The bd tool wrapper (used by pi for nice rendering) returns empty output while running bd CLI directly via bash works. Examples: 'bd ready', 'bd list', 'bd show tau-xxx' all return empty via the tool but work via bash. Need to investigate and fix the wrapper implementation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-18T02:16:00.801953518+01:00","updated_at":"2026-01-18T11:43:47.786122441+01:00","closed_at":"2026-01-18T11:43:47.786122441+01:00","close_reason":"bd tool now returns a text summary alongside JSON for list/ready/show so clients that ignore JSON-only outputs still display results"}
{"id":"tau-46k","title":"editor-hub: compose editor contributions from multiple extensions","description":"Create an editor composition mechanism so multiple extensions can contribute editor behavior without overwriting each other via ctx.ui.setEditorComponent.nnMotivation: tau/terminal-prompt and skill-marker both need editor hooks (render + autocomplete). Only one extension can own the editor in pi, so we need a shared hub with a plugin registry.nnDoD:n- New extension package: extensions/editor-hub (package.json + src/index.ts + src/registry.ts).n- Other extensions register plugins instead of calling setEditorComponent directly.n- Works regardless of extension load order (hub sets editor on next tick).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:47:13.562347054+01:00","updated_at":"2026-01-17T17:48:00.039536681+01:00","closed_at":"2026-01-17T17:48:00.039536681+01:00","close_reason":"Added editor-hub extension package with plugin registry + composed editor (delayed install to avoid load-order issues)"}
{"id":"tau-5va","title":"Task tool batch input and concurrent execution","description":"Make task tool accept an array of task items, run them concurrently with Promise.all, return ordered results per item, and aggregate updates.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:42:39.224472647+01:00","updated_at":"2026-01-17T00:08:53.77784996+01:00","closed_at":"2026-01-17T00:08:53.77784996+01:00","close_reason":"Implemented batch task input with concurrent execution and ordered results."}
{"id":"tau-5vw","title":"Demo: render test","description":"Testing beads decorator rendering","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:00:02.9490764+01:00","updated_at":"2026-01-16T00:00:02.9490764+01:00"}
{"id":"tau-5xl","title":"task tui: improve task result rendering","description":"Adjust task tool rendering: hide separate call entry, show description inside result, show per-tool success/failure icons, and move usage line to bottom. Combine tool call+result into single line in the task cell.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:31:03.185562479+01:00","updated_at":"2026-01-16T17:33:37.708020437+01:00","closed_at":"2026-01-16T17:33:37.708020437+01:00","close_reason":"Updated task tool rendering: hide call view, show description in result, add per-tool status icons, move usage to footer","dependencies":[{"issue_id":"tau-5xl","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:31:03.197161976+01:00","created_by":"daemon"}]}
{"id":"tau-6jl","title":"Fix invalid tool names in TaskRegistry builtins","description":"TaskRegistry.builtins() references tools that don't exist: ls, find, grep.\n\nActual available tools: read, write, edit, bash, bd, task, web_search_exa, crawling_exa, get_code_context_exa, git_commit_with_user_approval\n\nCurrent broken config:\n- search: tools: ['read', 'ls', 'find', 'grep']  \n- review: tools: ['read', 'ls', 'find', 'grep', 'bash']\n- planning: tools: ['read', 'ls', 'find', 'grep']\n\nShould be:\n- search: tools: ['read', 'bash'] (or just read if truly read-only)\n- review: tools: ['read', 'bash']\n- planning: tools: ['read', 'bash'] (or just read)\n\nNote: read-only enforcement should be via skill guidance, not fake tool restrictions.\n\nRelated: tau-8oj (silent ignore of non-existent tools)","status":"closed","issue_type":"task","created_at":"2026-01-17T02:42:57.887311017+01:00","updated_at":"2026-01-17T18:03:14.157980791+01:00","closed_at":"2026-01-17T18:03:14.157980791+01:00","close_reason":"Already fixed: extensions/task/src/registry.ts builtins use tools ['read','bash'] for search/review/planning (no ls/find/grep). No further changes needed."}
{"id":"tau-8fd","title":"Port commit.ts extension","description":"Port mitsuhiko/agent-stuff pi-extensions/commit.ts into tau extensions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:34:47.738221331+01:00","updated_at":"2026-01-16T01:36:48.185430791+01:00","closed_at":"2026-01-16T01:36:48.185430791+01:00","close_reason":"Implemented /commit command + git_commit_with_user_approval tool"}
{"id":"tau-8od","title":"Epic: Task-based delegation extension for pi","description":"Replace persona-based subagent extension with task-based delegation system.\n\n## Goals\n1. Task types with minimal contracts (policy, not persona)\n2. Difficulty-based model selection (small/medium/large)\n3. Skill injection into workers\n4. Session continuation via session_id\n5. No sandbox policies (for now)\n6. No personas - workers execute WHAT, not WHO they are\n\n## Architecture\n- **Task Type**: Policy (model, tools, thinking) + default skills\n- **Skill**: Injectable knowledge from ~/.pi/agent/skills/ or .pi/skills/\n- **Task Session**: Durable transcript, resumable via session_id\n- **Worker**: Executes task with context prompt (not identity persona)\n\n## Built-in Task Types\n- code: General implementation work\n- search: Find code, definitions, references (read-only tools)\n- review: Code review with review skill\n- planning: Architecture and design decisions\n- general: User-specified skills\n\n## Config (settings.json)\n```json\n{\n  \"tasks\": {\n    \"code\": {\n      \"difficulty\": {\n        \"small\": { \"model\": \"anthropic/claude-haiku-4\" },\n        \"medium\": { \"model\": \"anthropic/claude-sonnet-4\" },\n        \"large\": { \"model\": \"anthropic/claude-sonnet-4\", \"thinking\": \"high\" }\n      }\n    }\n  }\n}\n```\n\n## DoD\n- New extension in tau/extensions/task/\n- Old subagent extension removed from ~/.pi\n- task tool registered and working\n- Skill injection functional\n- Session continuation working\n- Custom TUI rendering for task results","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T16:06:21.183042058+01:00","updated_at":"2026-01-16T16:25:40.080749927+01:00","closed_at":"2026-01-16T16:25:40.080749927+01:00","close_reason":"Implemented task-based delegation extension and removed old subagent"}
{"id":"tau-8od.1","title":"Create extension scaffold: tau/extensions/task/","description":"Create the basic extension structure.\n\n## Files to create\n```\ntau/extensions/task/\n├── package.json          # Extension manifest with pi.extensions\n└── src/\n    ├── index.ts          # Extension entry point\n    └── types.ts          # TypeScript interfaces\n```\n\n## package.json structure\n```json\n{\n  \"name\": \"task\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"pi\": {\n    \"extensions\": [\"./src/index.ts\"]\n  }\n}\n```\n\n## index.ts minimal scaffold\n- Import ExtensionAPI from @mariozechner/pi-coding-agent\n- Export default function that takes pi: ExtensionAPI\n- Log 'task extension loaded' on session_start\n\n## DoD\n- Extension loads without errors when pi starts\n- session_start event fires and logs message","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:37.81537964+01:00","updated_at":"2026-01-16T16:25:37.274466645+01:00","closed_at":"2026-01-16T16:25:37.274466645+01:00","close_reason":"Created extensions/task scaffold","dependencies":[{"issue_id":"tau-8od.1","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:37.81573528+01:00","created_by":"daemon"}]}
{"id":"tau-8od.10","title":"Create review skill from old review agent","description":"Migrate review agent content to a proper skill.\n\n## Source\nCheck ~/.pi/agent/extensions/subagent/agents/ or ~/.pi/agent/agents/ for review.md\n\n## Target\n~/.pi/agent/skills/review/SKILL.md\n\n## Skill format\n```markdown\n---\nname: review\ndescription: Code review guidelines and output format\n---\n\n# Code Review Skill\n\n{extracted guidelines from old review.md}\n\n## Output Format\n{any structured output requirements}\n```\n\n## Key content to preserve\n- Review process guidelines\n- What to look for (bugs, security, style)\n- Output format/structure expectations\n\n## What to remove\n- Identity prompts ('You are a code reviewer...')\n- Persona language\n- Redundant instructions covered by task context\n\n## DoD\n- review skill exists at correct path\n- loadSkill('review', cwd) returns content\n- No persona language in skill content","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-16T16:08:24.985482274+01:00","updated_at":"2026-01-16T16:25:37.415559899+01:00","closed_at":"2026-01-16T16:25:37.415559899+01:00","close_reason":"Migrated review agent into review skill (plus planning/search skills)","dependencies":[{"issue_id":"tau-8od.10","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:24.986576165+01:00","created_by":"daemon"},{"issue_id":"tau-8od.10","depends_on_id":"tau-8od.8","type":"blocks","created_at":"2026-01-16T16:09:19.222513085+01:00","created_by":"daemon"}]}
{"id":"tau-8od.2","title":"Implement TaskRegistry: load built-in + user config","description":"Create TaskRegistry that manages task type definitions.\n\n## File: src/registry.ts\n\n## TaskType interface\n```typescript\ninterface TaskType {\n  name: string;\n  description: string;\n  tools?: string[];          // undefined = all tools\n  defaultModel?: string;     // 'inherit' or canonical ID\n  defaultThinking?: ThinkingLevel;\n  difficulty?: {\n    small?: { model?: string; thinking?: ThinkingLevel };\n    medium?: { model?: string; thinking?: ThinkingLevel };\n    large?: { model?: string; thinking?: ThinkingLevel };\n  };\n  skills?: string[];         // default skills to inject\n}\n```\n\n## Built-in task types\n- code: All tools, inherit model\n- search: read/ls/find/grep only\n- review: read-only + bash, skills: ['review']\n- planning: read-only tools\n- general: All tools, accepts skills param from caller\n\n## Config loading\n- Load from ~/.pi/agent/settings.json under 'tasks' key\n- Load from .pi/settings.json (project-local, higher priority)\n- Merge with built-ins: user config overrides built-in defaults\n\n## API\n- TaskRegistry.get(taskType): TaskType | undefined\n- TaskRegistry.resolve(taskType, difficulty): ResolvedPolicy\n- TaskRegistry.list(): TaskType[]\n\n## DoD\n- Built-in task types available without config\n- User config overrides work\n- Difficulty resolution returns correct model/thinking","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:49.472725849+01:00","updated_at":"2026-01-16T16:25:37.290224987+01:00","closed_at":"2026-01-16T16:25:37.290224987+01:00","close_reason":"Implemented TaskRegistry with config overrides and difficulty resolution","dependencies":[{"issue_id":"tau-8od.2","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:49.473861189+01:00","created_by":"daemon"},{"issue_id":"tau-8od.2","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:37.461313153+01:00","created_by":"daemon"}]}
{"id":"tau-8od.3","title":"Implement SkillLoader: load skills from disk","description":"Create SkillLoader that finds and loads skill content.\n\n## File: src/skills.ts\n\n## LoadedSkill interface\n```typescript\ninterface LoadedSkill {\n  name: string;\n  path: string;\n  contents: string;\n}\n```\n\n## Search paths (in order of priority)\n1. .pi/skills/{name}/SKILL.md (project-local)\n2. .pi/skills/{name}.md\n3. ~/.pi/agent/skills/{name}/SKILL.md (user)\n4. ~/.pi/agent/skills/{name}.md\n\n## API\n- loadSkill(name: string, cwd: string): LoadedSkill | null\n- loadSkills(names: string[], cwd: string): { loaded: LoadedSkill[], missing: string[] }\n\n## DoD\n- Can load beads skill from ~/.pi/agent/skills/beads/SKILL.md\n- Project-local skills take precedence\n- Returns null for missing skills without throwing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:57.0292357+01:00","updated_at":"2026-01-16T16:25:37.306095795+01:00","closed_at":"2026-01-16T16:25:37.306095795+01:00","close_reason":"Implemented SkillLoader with project/user lookup","dependencies":[{"issue_id":"tau-8od.3","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:57.030363726+01:00","created_by":"daemon"},{"issue_id":"tau-8od.3","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:40.817028386+01:00","created_by":"daemon"}]}
{"id":"tau-8od.4","title":"Implement SessionManager: track active task sessions","description":"Create SessionManager for session continuation.\n\n## File: src/sessions.ts\n\n## TaskSession interface\n```typescript\ninterface TaskSession {\n  sessionId: string;\n  taskType: string;\n  difficulty: Difficulty;\n  process: ChildProcess;       // spawned pi process\n  createdAt: number;\n}\n```\n\n## In-memory storage\n- Map\u003csessionId, TaskSession\u003e\n- Sessions live for duration of parent pi process\n\n## API\n- getSession(sessionId): TaskSession | undefined\n- createSession(taskType, difficulty): TaskSession\n- hasSession(sessionId): boolean\n\n## Session ID generation\n- Use crypto.randomUUID() for new sessions\n- Accept existing sessionId for continuation\n\n## DoD\n- Can create new session and retrieve by ID\n- Can detect session_id mismatch (wrong task_type)\n- Sessions survive across multiple task tool calls","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:04.431335224+01:00","updated_at":"2026-01-16T16:25:37.322701746+01:00","closed_at":"2026-01-16T16:25:37.322701746+01:00","close_reason":"Implemented SessionManager for task session tracking","dependencies":[{"issue_id":"tau-8od.4","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:04.432434044+01:00","created_by":"daemon"},{"issue_id":"tau-8od.4","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:43.678883381+01:00","created_by":"daemon"}]}
{"id":"tau-8od.5","title":"Implement TaskRunner: spawn and stream pi processes","description":"Create TaskRunner that spawns worker pi processes.\n\n## File: src/runner.ts\n\n## Core responsibilities\n1. Build worker system prompt (context, not persona)\n2. Spawn pi process with correct flags\n3. Stream JSON events back to parent\n4. Handle completion/error/interruption\n\n## Worker system prompt structure\n```\n# Task Execution Context\nYou are executing a delegated task from parent session: {parentSessionId}\n\n## Guidelines\n- Focus on the requested task\n- Use available tools as needed\n- If specific output format required, follow it exactly\n- Otherwise, summarize what you did and why\n\n{parallel_constraints if parallelCount \u003e 1}\n\n---\n\u003cskill name=\"{name}\" path=\"{path}\"\u003e\n{skill contents}\n\u003c/skill\u003e\n```\n\n## pi spawn arguments\n```bash\npi --mode json -p --no-session \\\n  --model {resolvedModel} \\\n  --thinking {resolvedThinking} \\\n  --tools {toolsList} \\\n  --append-system-prompt {tempPromptFile} \\\n  \"Task: {userPrompt}\"\n```\n\n## Event processing\n- Parse NDJSON from stdout\n- Emit updates via onUpdate callback\n- Accumulate messages for final result\n- Track usage stats (tokens, cost)\n\n## TaskResult\n```typescript\ntype TaskOutput =\n  | { type: 'completed'; message: string }\n  | { type: 'completed_tool'; toolOutput: string }\n  | { type: 'completed_empty' }\n  | { type: 'interrupted'; resumable: true }\n  | { type: 'failed'; reason: string; resumable: boolean };\n\ninterface TaskResult {\n  output: TaskOutput;\n  sessionId: string;\n  usage: UsageStats;\n}\n```\n\n## DoD\n- Can spawn pi process and capture output\n- Streams progress to parent via onUpdate\n- Handles all termination cases (success, error, abort)\n- Cleans up temp files on completion","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:27.836925606+01:00","updated_at":"2026-01-16T16:25:37.339045836+01:00","closed_at":"2026-01-16T16:25:37.339045836+01:00","close_reason":"Implemented TaskRunner to spawn pi workers and stream NDJSON","dependencies":[{"issue_id":"tau-8od.5","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:27.83802133+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.2","type":"blocks","created_at":"2026-01-16T16:08:46.773656622+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.3","type":"blocks","created_at":"2026-01-16T16:08:50.37576493+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.4","type":"blocks","created_at":"2026-01-16T16:08:53.269641373+01:00","created_by":"daemon"}]}
{"id":"tau-8od.6","title":"Register task tool with pi.registerTool()","description":"Register the task tool that LLM can call.\n\n## File: src/index.ts (main extension)\n\n## Tool schema\n```typescript\nconst TaskParams = Type.Object({\n  task_type: Type.String({\n    description: 'Type of work: code, search, review, planning, general'\n  }),\n  description: Type.String({\n    description: 'Short description of the task (for logging/UI)'\n  }),\n  prompt: Type.String({\n    description: 'The full prompt for the worker'\n  }),\n  difficulty: Type.Optional(StringEnum(['small', 'medium', 'large'] as const, {\n    description: 'Task complexity. small=trivial, medium=standard (default), large=complex',\n  })),\n  session_id: Type.Optional(Type.String({\n    description: 'Continue an existing task session instead of starting new',\n  })),\n  skills: Type.Optional(Type.Array(Type.String(), {\n    description: 'Skills to inject (only valid for task_type=general)',\n  })),\n});\n```\n\n## Tool registration\n```typescript\npi.registerTool({\n  name: 'task',\n  label: 'Task',\n  description: buildToolDescription(registry),\n  parameters: TaskParams,\n  execute: async (toolCallId, params, onUpdate, ctx, signal) =\u003e { ... },\n  renderCall: (args, theme) =\u003e { ... },\n  renderResult: (result, options, theme) =\u003e { ... },\n});\n```\n\n## Description generation\n- List available task types with descriptions\n- Show difficulty options\n- Explain session_id continuation\n- Explain skills parameter (general only)\n\n## Execute flow\n1. Validate task_type exists\n2. Validate skills param only for general\n3. Resolve policy from registry + difficulty\n4. Load skills\n5. Get or create session\n6. Run task via TaskRunner\n7. Return result with session_id\n\n## DoD\n- Tool appears in pi's tool list\n- LLM can call task tool successfully\n- Invalid task_type returns helpful error\n- skills validation works for general only","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:42.094950135+01:00","updated_at":"2026-01-16T16:25:37.354560444+01:00","closed_at":"2026-01-16T16:25:37.354560444+01:00","close_reason":"Registered task tool and wired registry/skills/sessions/runner","dependencies":[{"issue_id":"tau-8od.6","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:42.096485339+01:00","created_by":"daemon"},{"issue_id":"tau-8od.6","depends_on_id":"tau-8od.5","type":"blocks","created_at":"2026-01-16T16:08:56.127457658+01:00","created_by":"daemon"}]}
{"id":"tau-8od.7","title":"Implement custom TUI rendering for task results","description":"Add custom renderCall and renderResult for nice TUI display.\n\n## File: src/render.ts\n\n## renderCall display\nShow task being delegated:\n```\n• task review:medium\n  └ \"Review changes in src/foo.rs\"\n```\n\n## renderResult display (collapsed)\n```\n✓ task review:medium (session: abc-123)\n  └ 3 turns ↑1.2k ↓800 $0.0042 anthropic/claude-sonnet-4\n  └ Found 2 issues: missing error handling, unused import\n```\n\n## renderResult display (expanded)\nShow full message content with markdown rendering.\n\n## Streaming display (isPartial)\n```\n⏳ task review:medium (running...)\n  └ read src/foo.rs\n  └ grep \"error\" ./\n  └ ...\n```\n\n## Status indicators\n- ⏳ Running (blinking dot like current subagent)\n- ✓ Completed (green)\n- ✗ Failed (red)\n- ⚠ Interrupted (yellow)\n\n## DoD\n- renderCall shows task_type:difficulty and description\n- renderResult shows completion status and summary\n- Streaming updates show tool calls as they happen\n- Expanded view shows full output with markdown","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:07:53.736798049+01:00","updated_at":"2026-01-16T16:25:37.369850361+01:00","closed_at":"2026-01-16T16:25:37.369850361+01:00","close_reason":"Added custom TUI rendering for task call/result","dependencies":[{"issue_id":"tau-8od.7","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:53.737869336+01:00","created_by":"daemon"},{"issue_id":"tau-8od.7","depends_on_id":"tau-8od.6","type":"blocks","created_at":"2026-01-16T16:08:59.301271905+01:00","created_by":"daemon"}]}
{"id":"tau-8od.8","title":"Remove old subagent extension from ~/.pi","description":"Clean up the old persona-based subagent extension.\n\n## Files to remove\n```\n~/.pi/agent/extensions/subagent/\n├── agents.ts      # DELETE\n├── index.ts       # DELETE\n├── README.md      # DELETE\n├── agents/        # DELETE entire directory\n└── prompts/       # DELETE entire directory\n```\n\n## Files to keep (migrate if useful)\n- agents/*.md content → Consider migrating to skills if valuable\n  - review.md → ~/.pi/agent/skills/review/SKILL.md (if not already exists)\n  - Other agents: evaluate if content is useful as skills\n\n## Verification\n- pi starts without subagent tool\n- No errors about missing extension\n- task tool works as replacement\n\n## DoD\n- ~/.pi/agent/extensions/subagent/ directory removed\n- Old 'subagent' tool no longer available\n- Any useful agent content migrated to skills","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:08:02.524474729+01:00","updated_at":"2026-01-16T16:25:37.384867919+01:00","closed_at":"2026-01-16T16:25:37.384867919+01:00","close_reason":"Removed old subagent extension and installed task extension symlink","dependencies":[{"issue_id":"tau-8od.8","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:02.525545826+01:00","created_by":"daemon"},{"issue_id":"tau-8od.8","depends_on_id":"tau-8od.6","type":"blocks","created_at":"2026-01-16T16:09:02.33018006+01:00","created_by":"daemon"}]}
{"id":"tau-8od.9","title":"Add parallel worker detection and constraints","description":"Detect when multiple task calls are in same parent turn.\n\n## Purpose\nWhen LLM calls task() multiple times in parallel, inject constraints to prevent conflicts.\n\n## Detection\n- Track task tool invocations per parent turn\n- Count concurrent workers spawned\n\n## Parallel constraints prompt (injected when parallelCount \u003e 1)\n```\n## Parallel Execution ({parallelCount} workers)\nThis parent spawned {parallelCount} task sessions in parallel.\n- Assume other workers may be editing the repo at the same time.\n- Avoid editing the same files or shared contracts unless explicitly required.\n- Keep changes narrowly scoped to your assigned area.\n- If you detect overlap or a dependency on another worker, stop and report it.\n```\n\n## Implementation\n- Use atomic counter per turn context\n- Increment on each task tool call\n- Finalize count before spawning any workers\n- Inject constraints if count \u003e 1\n\n## DoD\n- Single task call: no parallel constraints injected\n- Multiple parallel calls: all workers see constraint prompt\n- Count is accurate even with concurrent calls","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:08:16.179324624+01:00","updated_at":"2026-01-16T16:25:37.400336488+01:00","closed_at":"2026-01-16T16:25:37.400336488+01:00","close_reason":"Added parallel worker detection and constraint prompt injection","dependencies":[{"issue_id":"tau-8od.9","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:16.180459102+01:00","created_by":"daemon"},{"issue_id":"tau-8od.9","depends_on_id":"tau-8od.5","type":"blocks","created_at":"2026-01-16T16:09:16.30511082+01:00","created_by":"daemon"}]}
{"id":"tau-8oj","title":"Error when task type config references non-existent tools","description":"Currently, if a task type config specifies tools that don't exist (e.g. tools: [\"read\", \"nonexistent_tool\"]), the non-existent tools are silently ignored.\n\nThis is a bug because:\n1. User expects the tools they configure to be available\n2. Typos in tool names go unnoticed (e.g. \"grepp\" instead of \"grep\")\n3. Makes debugging config issues difficult\n\nExpected behavior:\n- On TaskRegistry.load(), validate that all tools in task type configs exist\n- Produce clear error or warning listing unknown tools\n- Either fail fast or log warning at startup\n\nAffected code:\n- extensions/task/src/registry.ts - normalizeTaskType() or load()\n- Need access to list of available tools to validate against","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:27:39.197777683+01:00","updated_at":"2026-01-17T02:38:37.748384336+01:00","closed_at":"2026-01-17T02:38:37.748384336+01:00","close_reason":"Validate task tool configs and error on unknown tool names."}
{"id":"tau-8wx","title":"DemoGraph: Beads renderer demo","description":"Synthetic issue graph to test the beads tool rendering (statuses + deps).","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-16T00:49:49.880630432+01:00","updated_at":"2026-01-16T00:49:49.880630432+01:00","labels":["demo-render"]}
{"id":"tau-8wx.1","title":"DemoGraph: Base renderer","description":"A completed task to show ✔ rendering.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.903399709+01:00","updated_at":"2026-01-16T00:49:49.990045144+01:00","closed_at":"2026-01-16T00:49:49.990045144+01:00","close_reason":"Demo complete","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.1","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.904387717+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.2","title":"DemoGraph: Blocking dependency","description":"Blocks other tasks to demonstrate blocked/ready lists.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-16T00:49:49.918227786+01:00","updated_at":"2026-01-16T00:49:49.918227786+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.2","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.918495047+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.3","title":"DemoGraph: Dep tree directions","description":"This task is blocked by another task.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.931698812+01:00","updated_at":"2026-01-16T00:49:49.931698812+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.3","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.931971723+01:00","created_by":"daemon"},{"issue_id":"tau-8wx.3","depends_on_id":"tau-8wx.2","type":"blocks","created_at":"2026-01-16T00:49:49.932425851+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.4","title":"DemoGraph: Polish output style","description":"In-progress task to show status variance.","status":"in_progress","priority":3,"issue_type":"task","created_at":"2026-01-16T00:49:49.961301754+01:00","updated_at":"2026-01-16T00:49:50.002032384+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.4","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.961563223+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.5","title":"DemoGraph: Release checklist","description":"Blocked by an open bug.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.97631254+01:00","updated_at":"2026-01-16T00:49:49.97631254+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.5","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.976633223+01:00","created_by":"daemon"},{"issue_id":"tau-8wx.5","depends_on_id":"tau-tgp","type":"blocks","created_at":"2026-01-16T00:49:49.977205606+01:00","created_by":"daemon"}]}
{"id":"tau-90x","title":"exa extension: improve tool schemas and rendering","description":"Update extensions/exa to match exa.* tool schemas (web_search_exa/crawling_exa/get_code_context_exa) and add rich TUI rendering.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:28:44.485293555+01:00","updated_at":"2026-01-16T16:31:37.769755395+01:00","closed_at":"2026-01-16T16:31:37.769755395+01:00","close_reason":"Updated exa extension tool schemas and added custom rendering"}
{"id":"tau-9h5","title":"Add default result_schema to TaskType config","description":"Allow task types to specify a default result_schema in settings.json.\n\nUse case: The review task type should always return structured JSON output (findings, overall_correctness, etc.) without requiring the caller to specify result_schema every time.\n\nChanges needed:\n- Add result_schema field to TaskType interface\n- Merge with per-call result_schema (per-call overrides default)\n- Update normalization in registry.ts\n- Update task-type-creation skill with example","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T02:24:52.760021271+01:00","updated_at":"2026-01-17T02:24:52.760021271+01:00"}
{"id":"tau-bq3","title":"Rename task size to complexity","description":"Rename task size to complexity with low/medium/high values, update config schema, resolution fallback, and tool/skill docs. Make model exclusive with complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:43:19.993083118+01:00","updated_at":"2026-01-17T01:46:47.044917942+01:00","closed_at":"2026-01-17T01:46:47.044917942+01:00","close_reason":"Renamed size to complexity with low/medium/high values, updated resolution fallback and docs."}
{"id":"tau-dck","title":"task: remove startup log and rely on pi reporting","description":"Remove the 'task extension loaded' session_start console.log from extensions/task. Add a requirement to AGENTS.md: extensions must not print startup banners/logging and should rely on pi's reporting/UI.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:38:22.929505157+01:00","updated_at":"2026-01-16T16:38:58.691700834+01:00","closed_at":"2026-01-16T16:38:58.691700834+01:00","close_reason":"Removed session_start console.log from task extension and documented no-startup-logging requirement in AGENTS.md","dependencies":[{"issue_id":"tau-dck","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T16:38:22.929946991+01:00","created_by":"daemon"}]}
{"id":"tau-dtk","title":"Skill resolution fallback: global path then extension-bundled","description":"Skills for builtin task types (code, search, review, planning) should be bundled with the task extension, not require users to install them globally.\n\nCurrent behavior:\n- Skills are discovered from global paths only (~/.pi/agent/skills/, ~/.codex/skills/, etc.)\n- Builtin task types reference skills (e.g. search type has skills: [\"search\"])\n- If user doesn't have these skills installed globally, they're missing\n\nExpected behavior:\n1. First check normal skill discovery path (user/global skills)\n2. If not found, fallback to extension-bundled skills (extensions/task/skills/)\n3. User skills override extension-bundled skills (allows customization)\n\nThis allows:\n- Task extension to ship with working default skills\n- Users to override with their own versions\n- No manual skill installation required for builtins\n\nBundled skills location: extensions/task/skills/\n- code/SKILL.md\n- search/SKILL.md\n- review/SKILL.md\n- planning/SKILL.md\n- task-delegation/SKILL.md\n- task-type-creation/SKILL.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:30:26.027018425+01:00","updated_at":"2026-01-17T02:38:37.789898229+01:00","closed_at":"2026-01-17T02:38:37.789898229+01:00","close_reason":"Added bundled skills and extension fallback for task types."}
{"id":"tau-fme","title":"sandbox: adjust permissions instructions (no tool list)","description":"Update first-turn \u003cpermissions instructions\u003e injection to avoid listing specific tools as sandboxed; instruct model to assume all tool calls are subject to sandbox restrictions and not attempt bypass.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T11:17:00.409271062+01:00","updated_at":"2026-01-18T11:17:47.598922962+01:00","closed_at":"2026-01-18T11:17:47.598922962+01:00","close_reason":"Updated first-turn \u003cpermissions instructions\u003e to avoid listing specific tools; instruct model to assume all tool calls are sandboxed and include mode semantics"}
{"id":"tau-fo6","title":"Enable nested task tool in worker sessions","description":"Initialize extension runtime for worker AgentSessions so nested task calls work (respect depth).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:05:09.521078863+01:00","updated_at":"2026-01-17T02:05:39.74193816+01:00","closed_at":"2026-01-17T02:05:39.74193816+01:00","close_reason":"Initialized extension runtime for worker sessions and added task-type-creation skill."}
{"id":"tau-fw1","title":"Fix empty Exa tool results for agent","description":"The Exa tools (web_search, crawl, code_context) were only returning JSON blocks, which resulted in empty output for the agent. Added text blocks to ensure results are visible to the LLM.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:03:19.998423931+01:00","updated_at":"2026-01-16T20:03:52.343830876+01:00","closed_at":"2026-01-16T20:03:52.343830876+01:00","close_reason":"Implemented text content blocks for all Exa tools."}
{"id":"tau-i3c","title":"Consolidate tau extensions into single vertical-slice architecture","description":"Refactor tau from 8 separate pi extensions into a single unified extension with vertical-slice architecture.\n\n## Current State\n- 8 separate extensions: beads, editor-hub, exa, sandbox, skill-marker, task, tau (misc)\n- Each with own package.json and pi.extensions entry\n- editor-hub is a workaround for cross-extension editor coordination\n- Extensions can't easily share state or call each other\n\n## Target State\n- Single extensions/tau/ with vertical-slice folder structure\n- Each feature in its own folder with index.ts (Rust mod.rs pattern)\n- Shared state in shared/ folder\n- Single TauEditor with all customizations baked in\n- No runtime plugin registry - compile-time composition\n\n## Structure\n```\nextensions/tau/src/\n├── index.ts           # only file in root\n├── shared/            # state.ts, config.ts\n├── editor/            # TauEditor\n├── beads/\n├── exa/\n├── skill-marker/\n├── terminal-prompt/\n├── worked-for/\n├── status/\n├── commit/\n├── sandbox/\n└── task/\n```\n\n## Dependencies to merge\n- ajv, ajv-formats (from task)\n- @anthropic-ai/sandbox-runtime (from sandbox)\n\n## DoD\n- Single tau extension in extensions/tau/\n- All features working as before\n- Old extension folders deleted\n- install-extensions.sh updated\n- Tool names unchanged (bd, bash, edit, write, task, web_search_exa, etc.)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-17T19:46:42.336935846+01:00","updated_at":"2026-01-18T14:31:36.927402592+01:00","closed_at":"2026-01-18T14:31:36.927402592+01:00","close_reason":"Completed consolidation into single extensions/tau with vertical-slice structure; removed legacy extensions and updated installer"}
{"id":"tau-i3c.1","title":"Create scaffolding: package.json, index.ts, shared/","description":"Create the new tau extension structure with scaffolding files.\n\n## Files to create\n\n### extensions/tau/package.json\n- Merge dependencies from task (ajv, ajv-formats) and sandbox (@anthropic-ai/sandbox-runtime)\n- Single pi.extensions entry pointing to ./src/index.ts\n\n### extensions/tau/src/index.ts\n- Import all feature init functions\n- Create shared state\n- Wire up session_start for TauEditor\n- Skeleton with TODO comments for each feature\n\n### extensions/tau/src/shared/index.ts\n- Re-export from state.ts and config.ts\n\n### extensions/tau/src/shared/state.ts\n- TauState type definition\n- createState() function\n- Placeholder sections for each feature's state\n\n### extensions/tau/src/shared/config.ts\n- TauConfig type for pi settings.json\n- Single 'tau' key namespace\n\n## DoD\n- npm install works in extensions/tau/\n- pi can load the extension (empty but no errors)\n- Folder structure matches agreed design","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:09.023625002+01:00","updated_at":"2026-01-18T13:29:17.244767084+01:00","closed_at":"2026-01-18T13:29:17.244767084+01:00","close_reason":"Created tau extension scaffolding (single entrypoint + shared state/config) and verified npm install","dependencies":[{"issue_id":"tau-i3c.1","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:09.024167278+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.10","title":"Migrate status/ feature","description":"Move status to tau/src/status/\n\n## Source\n- extensions/tau/src/status.ts\n\n## Target\n- extensions/tau/src/status/index.ts\n\n## Changes\n- Export initStatus(pi, state) function\n- Keep /status command\n- Keep StatusCard rendering\n- Can access sandbox config via state (for future enhancement)\n\n## DoD\n- /status command shows OpenAI, Gemini CLI, Antigravity quotas\n- StatusCard renders correctly\n- Burn rate calculations work","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:59.298453304+01:00","updated_at":"2026-01-18T13:36:53.853496181+01:00","closed_at":"2026-01-18T13:36:53.853496181+01:00","close_reason":"Moved status into vertical slice (initStatus(pi, state))","dependencies":[{"issue_id":"tau-i3c.10","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:59.298871714+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.10","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:51:03.300204095+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.11","title":"Migrate commit/ feature","description":"Move commit to tau/src/commit/\n\n## Source\n- extensions/tau/src/commit.ts\n\n## Target\n- extensions/tau/src/commit/index.ts\n\n## Changes\n- Export initCommit(pi, state) function\n- Keep tool name 'git_commit_with_user_approval'\n- Keep custom renderers\n\n## DoD\n- git_commit_with_user_approval tool works\n- User can edit commit message\n- Renders correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:09.054401024+01:00","updated_at":"2026-01-18T13:36:58.928159112+01:00","closed_at":"2026-01-18T13:36:58.928159112+01:00","close_reason":"Moved commit into vertical slice (initCommit(pi, state)); kept tool name and renderers","dependencies":[{"issue_id":"tau-i3c.11","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:09.054818652+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.11","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:51:08.37349453+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.12","title":"Unify state persistence to tau:state","description":"Consolidate all feature state into single tau:state entry type.\n\n## Current state types (to merge)\n- tau-state (terminal-prompt)\n- tau:worked-for-state\n- tau:status-state  \n- sandbox_state\n\n## Target\n- Single 'tau:state' custom entry type\n- All features read/write to unified state object\n\n## Implementation\n- Update state.ts with persistence helpers\n- Each feature uses state.persist() to save\n- On session_start, load and distribute to features\n\n## Backward compatibility\n- Migration: read old state types on first load\n- Write only new format going forward\n\n## DoD\n- All state persists correctly\n- Session resume works\n- Old sessions migrate cleanly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:21.715485517+01:00","updated_at":"2026-01-18T13:47:41.250691559+01:00","closed_at":"2026-01-18T13:47:41.250691559+01:00","close_reason":"Added unified tau:state persisted object + migration from legacy state types; updated terminal-prompt/worked-for/status/sandbox to read/write via tau:state","dependencies":[{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:21.715918454+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.2","type":"blocks","created_at":"2026-01-17T19:51:33.117564366+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.3","type":"blocks","created_at":"2026-01-17T19:51:38.191581677+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.4","type":"blocks","created_at":"2026-01-17T19:51:43.274348607+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.5","type":"blocks","created_at":"2026-01-17T19:51:48.353267429+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.6","type":"blocks","created_at":"2026-01-17T19:51:53.431271639+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.9","type":"blocks","created_at":"2026-01-17T19:51:58.508372286+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.10","type":"blocks","created_at":"2026-01-17T19:52:03.588532023+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.11","type":"blocks","created_at":"2026-01-17T19:52:08.667950699+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:26:36.63683515+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.13","title":"Delete old extensions and update install script","description":"Clean up old extension folders and update deployment.\n\n## Delete\n- extensions/beads/\n- extensions/editor-hub/\n- extensions/exa/\n- extensions/sandbox/\n- extensions/skill-marker/\n- extensions/task/\n\n## Keep (but now has new structure)\n- extensions/tau/\n\n## Update scripts/pi/install-extensions.sh\n- Remove: beads, exa, task, editor-hub, sandbox, skill-marker from EXTS array\n- Keep only: tau\n\n## Update AGENTS.md\n- Remove references to separate extensions\n- Update any paths\n\n## DoD\n- Only extensions/tau/ exists\n- install-extensions.sh only installs tau\n- No broken symlinks in ~/.pi/agent/extensions/","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:35.045442391+01:00","updated_at":"2026-01-18T14:29:41.26677004+01:00","closed_at":"2026-01-18T14:29:41.26677004+01:00","close_reason":"Removed legacy extensions/, updated installer to install only tau and clean up old symlinks; updated AGENTS.md packaging notes","dependencies":[{"issue_id":"tau-i3c.13","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:35.04585025+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.13","depends_on_id":"tau-i3c.12","type":"blocks","created_at":"2026-01-17T19:52:25.221002106+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.13","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:26:41.768942095+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.14","title":"Integration test: verify all features work","description":"Manual integration testing after migration.\n\n## Test checklist\n\n### Tools\n- [ ] bd tool: bd ready, bd list, bd show\n- [ ] bash tool: runs sandboxed\n- [ ] edit tool: respects fs policy\n- [ ] write tool: respects fs policy\n- [ ] task tool: spawns workers, returns output\n- [ ] web_search_exa: searches, renders results\n- [ ] crawling_exa: fetches URLs\n- [ ] get_code_context_exa: returns code snippets\n- [ ] git_commit_with_user_approval: editor flow works\n\n### Commands\n- [ ] /bd - runs bd commands\n- [ ] /status - shows quotas\n- [ ] /sandbox - settings UI\n- [ ] /approval - settings UI\n- [ ] /tau prompt - toggles prompt styling\n- [ ] /worked - toggles timer\n\n### Editor\n- [ ] Terminal prompt styling\n- [ ] $skill autocomplete triggers on $\n- [ ] Skill injection works\n\n### State\n- [ ] Settings persist across session restart\n- [ ] Old sessions load without errors\n\n## DoD\n- All checklist items pass\n- No console errors during normal operation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:49.685969695+01:00","updated_at":"2026-01-18T14:31:13.134859814+01:00","closed_at":"2026-01-18T14:31:13.134859814+01:00","close_reason":"Smoke-tested: pi loads tau extension without errors; installer updates global symlink to only tau. Full interactive checklist requires manual UI verification.","dependencies":[{"issue_id":"tau-i3c.14","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:49.686394487+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.14","depends_on_id":"tau-i3c.13","type":"blocks","created_at":"2026-01-17T19:52:30.301099695+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.14","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:26:46.837265898+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.2","title":"Migrate editor/ - TauEditor with baked-in customizations","description":"Create unified TauEditor that replaces editor-hub pattern.\n\n## Source\n- extensions/editor-hub/src/index.ts (HubEditor class)\n- extensions/editor-hub/src/registry.ts (plugin registry - DELETE this pattern)\n\n## Target\n- extensions/tau/src/editor/index.ts\n\n## Implementation\n- TauEditor extends CustomEditor\n- Direct function calls instead of plugin registry:\n  - wrapEditorRender() from terminal-prompt\n  - wrapAutocomplete() from skill-marker\n  - afterInput() from skill-marker\n- Takes TauState in constructor\n- No Symbol.for globals, no runtime registration\n\n## DoD\n- TauEditor class created\n- Compile-time composition (import functions directly)\n- No editor-hub registry pattern\n- Editor loads in pi without errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:30.248753928+01:00","updated_at":"2026-01-18T13:34:01.892590042+01:00","closed_at":"2026-01-18T13:34:01.892590042+01:00","close_reason":"Added TauEditor with compile-time composition (terminal-prompt render wrapper + skill-marker autocomplete hooks); no editor-hub registry","dependencies":[{"issue_id":"tau-i3c.2","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:30.249172478+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.2","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:22.67681726+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.3","title":"Migrate beads/ feature","description":"Move beads extension to tau/src/beads/\n\n## Source\n- extensions/beads/src/index.ts\n\n## Target  \n- extensions/tau/src/beads/index.ts\n\n## Changes\n- Export initBeads(pi, state) function\n- Use state for any shared config\n- Keep tool name 'bd'\n- Keep command '/bd'\n- Keep message renderer\n\n## DoD\n- bd tool works\n- /bd command works\n- /bd init flow works\n- Custom message rendering works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:40.880230704+01:00","updated_at":"2026-01-18T13:38:48.539521321+01:00","closed_at":"2026-01-18T13:38:48.539521321+01:00","close_reason":"Copied beads tool into tau/src/beads (initBeads) and wired into tau entrypoint","dependencies":[{"issue_id":"tau-i3c.3","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:40.880737893+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.3","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:27.753524387+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.4","title":"Migrate exa/ feature","description":"Move exa extension to tau/src/exa/\n\n## Source\n- extensions/exa/src/index.ts\n\n## Target\n- extensions/tau/src/exa/index.ts\n\n## Changes\n- Export initExa(pi, state) function\n- Keep tool names: web_search_exa, crawling_exa, get_code_context_exa\n- Keep custom renderers\n\n## DoD\n- All 3 exa tools work\n- Tool rendering works\n- EXA_API_KEY env var handling unchanged","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:50.814386466+01:00","updated_at":"2026-01-18T13:38:20.560506178+01:00","closed_at":"2026-01-18T13:38:20.560506178+01:00","close_reason":"Copied exa tools into tau/src/exa (initExa) and wired into tau entrypoint","dependencies":[{"issue_id":"tau-i3c.4","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:50.814796149+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.4","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:25:17.881833255+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.5","title":"Migrate sandbox/ feature","description":"Move sandbox extension to tau/src/sandbox/\n\n## Source files\n- extensions/sandbox/src/index.ts\n- extensions/sandbox/src/config.ts\n- extensions/sandbox/src/fs-policy.ts\n- extensions/sandbox/src/sandbox-bash.ts\n- extensions/sandbox/src/workspace-root.ts\n\n## Target\n- extensions/tau/src/sandbox/index.ts (initSandbox + exports for task)\n- extensions/tau/src/sandbox/config.ts\n- extensions/tau/src/sandbox/fs-policy.ts\n- extensions/tau/src/sandbox/bash.ts\n- extensions/tau/src/sandbox/workspace-root.ts\n\n## Changes\n- Export initSandbox(pi, state) function\n- Export createSandboxedBashOperations for task to use\n- Store effective config in shared state\n- Migrate config to tau namespace in settings.json\n- Keep tool names: bash, edit, write\n- Keep commands: /sandbox, /approval\n\n## DoD\n- Sandboxed bash/edit/write work\n- /sandbox and /approval commands work\n- Config loads from tau namespace\n- state.sandbox.* accessible by other features","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:03.613020417+01:00","updated_at":"2026-01-18T13:42:09.695212334+01:00","closed_at":"2026-01-18T13:42:09.695212334+01:00","close_reason":"Copied sandbox into tau/src/sandbox (initSandbox), added exported createSandboxedBashOperations, and switched config to settings.tau.sandbox (with legacy fallback)","dependencies":[{"issue_id":"tau-i3c.5","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:03.613480717+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.5","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:37.910861598+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.6","title":"Migrate task/ feature","description":"Move task extension to tau/src/task/\n\n## Source files\n- extensions/task/src/index.ts\n- extensions/task/src/runner.ts\n- extensions/task/src/sessions.ts\n- extensions/task/src/registry.ts\n- extensions/task/src/skills.ts\n- extensions/task/src/render.ts\n- extensions/task/src/types.ts\n- extensions/task/skills/ (bundled skill files)\n\n## Target\n- extensions/tau/src/task/index.ts\n- extensions/tau/src/task/runner.ts\n- extensions/tau/src/task/sessions.ts\n- extensions/tau/src/task/registry.ts\n- extensions/tau/src/task/skills.ts\n- extensions/tau/src/task/render.ts\n- extensions/tau/src/task/types.ts\n- extensions/tau/skills/ (move bundled skills)\n\n## Changes\n- Export initTask(pi, state) function\n- Access sandbox config via state.sandbox (for future sandboxed workers)\n- Keep tool name 'task'\n- Dependencies (ajv, ajv-formats) in root package.json\n\n## DoD\n- task tool works with all task types\n- Worker spawning works\n- Bundled skills load correctly\n- Custom TUI rendering works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:15.879714916+01:00","updated_at":"2026-01-18T13:43:22.168503289+01:00","closed_at":"2026-01-18T13:43:22.168503289+01:00","close_reason":"Copied task extension into tau/src/task (initTask) and moved bundled skills to extensions/tau/skills","dependencies":[{"issue_id":"tau-i3c.6","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:15.880193861+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.6","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:42.98903941+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.7","title":"Migrate skill-marker/ feature","description":"Move skill-marker extension to tau/src/skill-marker/\n\n## Source files\n- extensions/skill-marker/src/index.ts\n- extensions/skill-marker/src/autocomplete.ts\n\n## Target\n- extensions/tau/src/skill-marker/index.ts\n- extensions/tau/src/skill-marker/autocomplete.ts\n\n## Changes\n- Export initSkillMarker(pi, state) function\n- Export wrapAutocomplete() for TauEditor\n- Export afterInput() for TauEditor\n- Remove registerEditorPlugin calls (now direct)\n- Store skill registry in shared state\n\n## DoD\n- $skill markers detected in prompts\n- Skill content injected before agent_start\n- Autocomplete works in TauEditor","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:27.957089631+01:00","updated_at":"2026-01-18T13:33:45.386181206+01:00","closed_at":"2026-01-18T13:33:45.386181206+01:00","close_reason":"Moved skill-marker into tau and exposed editor hooks (wrapAutocompleteProvider/afterInput)","dependencies":[{"issue_id":"tau-i3c.7","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:27.957503432+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.7","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:48.069138521+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.7","depends_on_id":"tau-i3c.2","type":"blocks","created_at":"2026-01-18T13:28:06.686895299+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.8","title":"Migrate terminal-prompt/ feature","description":"Move terminal-prompt to tau/src/terminal-prompt/\n\n## Source\n- extensions/tau/src/terminal-prompt.ts\n\n## Target\n- extensions/tau/src/terminal-prompt/index.ts\n\n## Changes\n- Export initTerminalPrompt(pi, state) function\n- Export wrapEditorRender() for TauEditor\n- Read enabled state from shared state\n- Remove registerEditorPlugin calls\n- Keep /tau command for toggling\n\n## DoD\n- Terminal prompt styling works\n- /tau prompt on|off|toggle works\n- State persists across sessions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:38.109041812+01:00","updated_at":"2026-01-18T13:33:50.466164658+01:00","closed_at":"2026-01-18T13:33:50.466164658+01:00","close_reason":"Moved terminal-prompt into tau vertical slice and exposed wrapEditorRender; state stored in tau shared state","dependencies":[{"issue_id":"tau-i3c.8","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:38.109594779+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.8","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:53.141314515+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.8","depends_on_id":"tau-i3c.2","type":"blocks","created_at":"2026-01-18T13:28:11.760662648+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.9","title":"Migrate worked-for/ feature","description":"Move worked-for to tau/src/worked-for/\n\n## Source\n- extensions/tau/src/worked-for.ts\n\n## Target\n- extensions/tau/src/worked-for/index.ts\n\n## Changes\n- Export initWorkedFor(pi, state) function\n- Store timer state in shared state\n- Keep /worked command\n- Keep widget and separator rendering\n\n## DoD\n- Timer widget shows during agent runs\n- Separator rendered after agent_end\n- /worked on|off|toggle works\n- /worked tools on|off|toggle works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:48.898015293+01:00","updated_at":"2026-01-18T13:36:48.776602833+01:00","closed_at":"2026-01-18T13:36:48.776602833+01:00","close_reason":"Moved worked-for into vertical slice and wired enable/tool flags through TauState","dependencies":[{"issue_id":"tau-i3c.9","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:48.898490461+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.9","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:58.219938005+01:00","created_by":"ribelo"}]}
{"id":"tau-je2","title":"sandbox: inject state + SANDBOX_CHANGE into user message","description":"Extension-only: inject initial sandbox state into system prompt on first turn; inject subsequent sandbox changes into latest user message content[0] as SANDBOX_CHANGE, emitting only the latest pending change (cycle-friendly).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T03:09:07.92439179+01:00","updated_at":"2026-01-18T03:09:49.914974915+01:00","closed_at":"2026-01-18T03:09:49.914974915+01:00","close_reason":"Implemented first-turn system prompt sandbox state injection + cycle-safe SANDBOX_CHANGE injection as user message content[0] via context hook"}
{"id":"tau-kao","title":"task tui: render nested task tool calls","description":"Detect activities where toolName==task inside a task worker run and render them as nested task blocks (task_type:difficulty, description, status icon, optional session_id, and a one-line output preview).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:45:57.095511909+01:00","updated_at":"2026-01-16T17:47:12.002285812+01:00","closed_at":"2026-01-16T17:47:12.002285812+01:00","close_reason":"Render nested task tool calls: capture tool result preview and show task_type:difficulty, description, session id, and output preview","dependencies":[{"issue_id":"tau-kao","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:45:57.10431211+01:00","created_by":"daemon"}]}
{"id":"tau-lgq","title":"Epic: In-process task workers (no pi subprocess)","description":"Replace TaskRunner's child_process.spawn('pi') worker execution with in-process AgentSession workers using the pi SDK (createAgentSession).nnGoalsn- No OS subprocess spawning for workersn- Keep session_id continuation (workers persistent across multiple task calls)n- Tools per worker/task come from TaskRegistry policy (strict allowlist)n- Preserve streaming updates + usage + TUI renderingn- Support nested task spawning in a single process (task tool available inside workers, per config)nnOut of scope (for now)n- Global tool locking / concurrency controlsnnDoDn- No remaining spawn('pi') usage in extensions/taskn- Manual validation: task tool runs a worker and returns output + session_id; session_id reuse continues contextn- Manual validation: nested task calls render reasonably","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T18:32:12.946092245+01:00","updated_at":"2026-01-16T19:11:12.458909588+01:00","closed_at":"2026-01-16T19:11:12.458909588+01:00","close_reason":"In-process worker backend implemented; subprocess removed; test checklist recorded","dependencies":[{"issue_id":"tau-lgq","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T18:32:12.955031927+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.1","title":"Investigate SDK worker sessions via createAgentSession","description":"Map feasibility of running delegated workers in-process using the pi SDK.nnScopen- Read /home/ribelo/projects/ribelo/pi-mono/packages/coding-agent/src/core/sdk.ts createAgentSession()n- Identify minimal CreateAgentSessionOptions needed for a headless worker (no extension discovery, controlled tools, controlled skills)n- Identify how to stream progress (AgentSession.subscribe events) and extract: tool calls, tool results, assistant text, usage, costnnFindingsn- createAgentSession(options) supports in-process AgentSession creation with custom tools/extensions and SessionManager.inMemory().n- AgentSession exposes tool APIs: getAllTools(), getActiveToolNames(), setActiveToolsByName(toolNames). setActiveToolsByName rebuilds system prompt with selected tools (supports built-in + extension tools if loaded).n- Tools selection: createAgentSession.tools affects built-in tools only; extension tools are registered via extension loading. To allow extension tools while enforcing allowlist, load needed extension factories (or allow discovery) then call session.setActiveToolsByName(allowedToolNames).n- Skills: set options.skills = [] to disable auto skill injection; continue appending worker skill content manually (same as current --no-skills + append-system-prompt behavior).n- System prompt: use options.systemPrompt = (defaultPrompt) =\u003e `${defaultPrompt}nn${workerPrompt}` to preserve default prompt + AGENTS.md context and append worker context/skills.n- Session persistence: keep a Map\u003csession_id, AgentSession\u003e in TaskRunner; construct each worker session with SessionManager.inMemory(cwd) and reuse the same AgentSession object across calls.nnRecommended createAgentSession options for workersn- cwd: parent cwdn- authStorage/modelRegistry: cached singletons from discoverAuthStorage() + discoverModels()n- sessionManager: SessionManager.inMemory(cwd)n- systemPrompt: function to append worker promptn- skills: []n- extensions: [] + inline extension factories for allowed extension tools (task/bd/exa), OR allow discovery then filter tools via setActiveToolsByNamen- tools: optional built-in tool list (but still call setActiveToolsByName for final allowlist)nnEvents to listen to (AgentSession.subscribe)n- tool_execution_start: toolCallId/toolName/args (start activity)n- tool_execution_end: toolCallId/result/isError (mark success/fail, optional result text)n- message_end (assistant): capture usage + last assistant text (turn count)n- message_end (toolResult): capture tool output text for activity previewn- message_update (assistant text_delta) if streaming preview is desirednnDeliverablen- Write a short note (in this issue description or a comment) with recommended createAgentSession() options for workers, including how to keep sessions persistent across calls.nnDoDn- Clear recommended options listn- Confirm which events to listen to for tool execution + message streaming + usage","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.761268104+01:00","updated_at":"2026-01-16T18:41:27.911632557+01:00","closed_at":"2026-01-16T18:41:27.911632557+01:00","close_reason":"Documented createAgentSession options + event mapping for in-process workers","dependencies":[{"issue_id":"tau-lgq.1","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.761639945+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.2","title":"Decide worker tool scope + nested task recursion policy","description":"We need one explicit decision before implementation:nnDecisionsn1) TaskRegistry.tools applies to BOTH built-in tools (read/bash/edit/write/ls/find/grep/...) and extension tools (e.g. task/bd/exa).n2) Workers may be allowed to call task (nested delegation) when included/allowed by the tool policy.n3) Default max nesting depth: 3. If exceeded, nested task call should fail fast with a clear error (not spawn).nnDoDn- Decision recorded in this issue (final answers)n- If nesting allowed: define default max depth + failure behavior when exceeded","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.779592749+01:00","updated_at":"2026-01-16T18:38:05.167791818+01:00","closed_at":"2026-01-16T18:38:05.167791818+01:00","close_reason":"Decisions recorded: tools allow built-in+extension; nested task allowed when permitted; max depth 3","dependencies":[{"issue_id":"tau-lgq.2","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.779922198+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.3","title":"Refactor task runner to support pluggable worker backend","description":"Prepare extensions/task for swapping the worker execution model.nnScopen- Identify code in extensions/task/src/runner.ts that is specific to child_process.spawn('pi')n- Introduce an internal abstraction (e.g. WorkerBackend) so we can implement InProcessWorkerBackend without rewriting higher-level logicnnDoDn- Clear separation between: (a) worker session orchestration, (b) backend executionn- No behavior changes yet","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.798047091+01:00","updated_at":"2026-01-16T18:53:13.996395599+01:00","closed_at":"2026-01-16T18:53:13.996395599+01:00","close_reason":"Refactored TaskRunner with WorkerBackend abstraction while keeping subprocess backend}","dependencies":[{"issue_id":"tau-lgq.3","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.798357164+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.4","title":"Implement in-process WorkerBackend using createAgentSession","description":"Implement worker execution without spawning OS processes.nnScopen- Replace spawn('pi') execution with an in-process AgentSession created by createAgentSession()n- Persist worker sessions in-memory keyed by session_id (reuse same AgentSession object across calls)n- Use SessionManager.inMemory() for worker sessions (no file sessions)n- Build worker system prompt from existing buildWorkerSystemPrompt() + injected skillsnnDoDn- Worker executes prompts successfully without spawning subprocessesn- session_id reuse continues prior worker contextn- No regressions: still returns final output to parent tool","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.817779665+01:00","updated_at":"2026-01-16T19:05:05.799294998+01:00","closed_at":"2026-01-16T19:05:05.799294998+01:00","close_reason":"Implemented in-process WorkerBackend using createAgentSession and switched TaskRunner to it}","dependencies":[{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.81809109+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.1","type":"blocks","created_at":"2026-01-16T18:34:21.686322207+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.2","type":"blocks","created_at":"2026-01-16T18:34:21.712413133+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.3","type":"blocks","created_at":"2026-01-16T18:34:21.728812581+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.5","title":"Stream worker events into task tool updates (no NDJSON parsing)","description":"Replace NDJSON stdout parsing with AgentSession.subscribe() event handling.nnScopen- Subscribe to worker AgentSession eventsn- Maintain TaskRunnerUpdateDetails incrementally:n  - activities list (toolCallId, toolName, args, status)n  - message preview (latest assistant text or latest tool output)n  - usage aggregation (turn count, input/output tokens, cost)n  - durationn- Feed onUpdate() for live TUI renderingnnDoDn- Live updates show tool activity while worker is runningn- Final result includes correct usage + durationn- Handles failure/abort cleanly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.836100031+01:00","updated_at":"2026-01-16T19:05:43.728462237+01:00","closed_at":"2026-01-16T19:05:43.728462237+01:00","close_reason":"In-process backend streams AgentSession events into TaskRunner (no NDJSON parsing for default path)}","dependencies":[{"issue_id":"tau-lgq.5","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.836421055+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.5","depends_on_id":"tau-lgq.4","type":"blocks","created_at":"2026-01-16T18:34:21.743838046+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.6","title":"Remove subprocess backend + cleanup task session plumbing","description":"Finalize migration away from OS process workers.nnScopen- Delete spawn('pi') code pathn- Remove temp prompt file handling that is no longer neededn- Update extensions/task/src/sessions.ts to reflect in-process sessions (store AgentSession/metadata instead of ChildProcess + sessionFile)n- Ensure nested task delegation still works with new architecture (as per recursion policy)nnDoDn- `rg \"spawn(\\\"pi\\\"\" extensions/task/src` returns no matchesn- Task tool works end-to-end in manual testing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.85492435+01:00","updated_at":"2026-01-16T19:10:39.736067182+01:00","closed_at":"2026-01-16T19:10:39.736067182+01:00","close_reason":"Removed subprocess backend and temp session plumbing; sessions now track in-process metadata}","dependencies":[{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.855245293+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq.5","type":"blocks","created_at":"2026-01-16T18:34:21.759222675+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq.2","type":"blocks","created_at":"2026-01-16T18:34:21.775318233+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.7","title":"Manual test plan + documentation for in-process workers","description":"Document how to validate the new worker model.nnTest checklistn1) Simple task run: call task tool with task_type=code and a simple bash echo; verify tool result returns output + session_id.n2) session_id continuation: call task again with same session_id; verify worker remembers prior context (ask it to summarize previous action).n3) Nested task call (if allowed): use task_type that allows task tool; prompt worker to delegate a sub-task; verify nested task renders and completes.n4) Max depth: attempt to nest beyond depth 3; verify task tool fails fast with a clear error.n5) Error handling: invalid task_type should return helpful error; worker failure should surface error text.nnDoDn- Checklist recorded in this issue (this description)}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.873621576+01:00","updated_at":"2026-01-16T19:10:56.210531566+01:00","closed_at":"2026-01-16T19:10:56.210531566+01:00","close_reason":"Recorded manual test checklist in issue description}","dependencies":[{"issue_id":"tau-lgq.7","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.873943461+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.7","depends_on_id":"tau-lgq.6","type":"blocks","created_at":"2026-01-16T18:34:21.792448587+01:00","created_by":"daemon"}]}
{"id":"tau-neg","title":"pi: sandboxed bash/edit/write with approvals (asrt)","description":"Implement sandboxing as a *tau extension* (no pi-mono core changes). Override built-in tools by registering tools with same names (bash/edit/write) and intercept policy/approvals. Use anthropic-experimental/sandbox-runtime (ASRT) for OS-level sandboxing of bash. Provide /sandbox + /approval commands with blocking prompts and per-call rerun. Persist state via session custom entries. Targets macOS + Linux. Workspace root = git repo root else cwd. Allow git commits; deny writes to \u003cworkspace\u003e/.git/hooks/** in non-danger modes.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-17T17:06:25.481232316+01:00","updated_at":"2026-01-18T11:26:20.058405864+01:00","closed_at":"2026-01-18T11:26:20.058405864+01:00","close_reason":"All sandbox epic child tasks completed (ASRT bash/edit/write, approvals, diagnostics, missing deps handling, docs)","comments":[{"id":1,"issue_id":"tau-neg","author":"ribelo","text":"Grounding notes (pi-mono):\\n- bash tool: packages/coding-agent/src/core/tools/bash.ts (pluggable BashOperations) and core/bash-executor.ts + AgentSession.executeBash()\\n- edit/write tools: src/core/tools/edit.ts, write.ts (currently no policy checks; uses resolveToCwd in path-utils.ts)\\n- interactive UI supports blocking confirm w/ timeout via ctx.ui.confirm (see interactive-mode.ts showExtensionConfirm())\\n- extension wrapper can intercept tool_call/tool_result, and extensions can register commands (/...) (see extensions/loader.ts + agent-session _tryExecuteExtensionCommand)\\n\\nPlan assumes implementing sandbox as a built-in inline extension factory loaded by default (so it can use ctx.ui.confirm and provide /sandbox + /approval).","created_at":"2026-01-17T16:08:56Z"},{"id":2,"issue_id":"tau-neg","author":"ribelo","text":"Decisions locked:\\n- Defaults on first run: fs=workspace-write, net=deny, approval=ask, timeout=60s; write these defaults into user settings (~/.pi/settings.json) if unset.\\n- Sandbox applies only to model tool calls (bash/edit/write), not user-triggered !/!! bash.\\n- Network policy: deny | allowlist(domains, supports *.example.com) | allow-all. Approval policy governs whether to prompt to temporarily override net/fs for a single rerun.\\n- Session overrides should persist by writing a session custom entry (SessionManager supports type=custom entries).\\n- Approval prompt escalation (best-effort):\\n  * If fs=read-only and a write is attempted: prompt to rerun once with fs=workspace-write (net unchanged).\\n  * If fs=workspace-write and write outside workspace: prompt to rerun once with fs=danger-full-access.\\n  * If write hits \u003cworkspace\u003e/.git/hooks/**: deny in non-danger modes, but when approval=ask, offer rerun once with fs=danger-full-access (explicit override).\\n  * If network denied (net=deny or allowlist miss): prompt to rerun once with net=allow-all (fs unchanged).\\n  * Headless/RPC: no prompt; deny.\\n","created_at":"2026-01-17T16:17:04Z"},{"id":4,"issue_id":"tau-neg","author":"ribelo","text":"Clarification: tau is an extensions workspace. Do NOT create repo-local .pi/extensions. Extensions live under tau/extensions/* and are installed by symlinking/copying into ~/.pi/agent/extensions/\u003cname\u003e. Sandbox work will only touch tau/extensions/sandbox/**.","created_at":"2026-01-17T16:40:33Z"}]}
{"id":"tau-neg.1","title":"Spike: run anthropic sandbox-runtime in pi execution","description":"Spike ASRT from tau extension context: add dependency in tau/extensions/sandbox, import in .pi/extensions/sandbox/index.ts, wrap+spawn command, verify mac+linux behavior, list deps (bwrap/socat/python3). DoD: findings in bd comment + minimal script/test.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:17.913295682+01:00","updated_at":"2026-01-17T18:34:34.583326169+01:00","closed_at":"2026-01-17T18:34:34.583326169+01:00","close_reason":"ASRT spike complete; smoke test passes and root causes documented","dependencies":[{"issue_id":"tau-neg.1","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:17.913631065+01:00","created_by":"daemon"}],"comments":[{"id":8,"issue_id":"tau-neg.1","author":"ribelo","text":"ASRT spike notes (Linux/bwrap):nn- bwrap fails when binding default write path $HOME/.claude/debug if ~/.claude is a symlink (dotfiles). Workaround: for smoke tests, set HOME to a temp dir when ~/.claude is symlink, and ensure $HOME/.claude/debug + $HOME/.npm/_logs exist.n- SandboxManager.initialize() always starts proxy infrastructure (HTTP+SOCKS) even when allowedDomains is empty; this keeps background handles alive and can make quick scripts appear to hang. For smoke, call SandboxManager.wrapWithSandbox(..., customConfig) without initialize().n- bwrap can create mountpoint files in the host FS for mandatory deny bindings (e.g. .bashrc, .profile, .git/hooks) if wrapWithSandbox() is run with cwd inside the workspace. For the real extension we should run wrapWithSandbox() from a dedicated temp cwd and use absolute allowWrite/denyWrite paths rooted at the workspace to avoid polluting the checkout.","created_at":"2026-01-17T17:34:30Z"}]}
{"id":"tau-neg.10","title":"Define filesystem/network/approval policy model + settings layering","description":"Define sandbox policy model *inside tau sandbox extension*: filesystemMode (read-only|workspace-write|danger-full-access), networkMode (deny|allowlist|allow-all), networkAllowlist domains, approvalPolicy (never|ask|on-failure), approvalTimeoutSeconds (default 60). Implement config read/write: user (~/.pi/agent/settings.json) + project (\u003cworkspace\u003e/.pi/settings.json) + session overrides (session custom entry), with precedence session \u003e project \u003e user. DoD: unit tests in tau extension + docs comment.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:47.614267227+01:00","updated_at":"2026-01-17T17:42:08.26986767+01:00","closed_at":"2026-01-17T17:42:08.26986767+01:00","close_reason":"Policy model + config layering implemented in tau/extensions/sandbox with tests","dependencies":[{"issue_id":"tau-neg.10","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:47.615854449+01:00","created_by":"daemon"}],"comments":[{"id":5,"issue_id":"tau-neg.10","author":"ribelo","text":"Implemented sandbox policy model + settings layering inside tau/extensions/sandbox (no repo-local .pi).n- Config types: filesystemMode/networkMode/allowlist/approvalPolicy/timeoutn- Reads: ~/.pi/agent/settings.json (user) + \u003cworkspace\u003e/.pi/settings.json (project) + sessionOverride paramn- Precedence: session \u003e project \u003e usern- ensureUserDefaults() writes defaults into user settings (only fills missing keys)n- Added vitest tests in extensions/sandbox/test (isolated via TAU_SANDBOX_USER_SETTINGS_PATH env)nDoD progress: core model + tests are in place; remaining: wire session overrides + command UI in tau-neg.3.","created_at":"2026-01-17T16:41:35Z"}]}
{"id":"tau-neg.2","title":"Workspace root detection (git root else cwd)","description":"Implement workspace root discovery inside extension (git rev-parse --show-toplevel else ctx.cwd) used for sandbox roots and project settings location. DoD: unit tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:07:38.72607795+01:00","updated_at":"2026-01-17T17:44:57.314659489+01:00","closed_at":"2026-01-17T17:44:57.314659489+01:00","close_reason":"Workspace root detection implemented in sandbox extension with tests","dependencies":[{"issue_id":"tau-neg.2","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.727212059+01:00","created_by":"daemon"}],"comments":[{"id":6,"issue_id":"tau-neg.2","author":"ribelo","text":"Implemented discoverWorkspaceRoot(cwd) in extensions/sandbox/src/workspace-root.ts using `git -C \u003ccwd\u003e rev-parse --show-toplevel` fallback to cwd. Added vitest coverage (skips if git missing). Wired extension session_start to computeEffectiveConfig using discovered workspace root.","created_at":"2026-01-17T16:44:25Z"},{"id":7,"issue_id":"tau-neg.2","author":"ribelo","text":"Test comment","created_at":"2026-01-17T17:20:10Z"},{"id":9,"issue_id":"tau-neg.2","author":"ribelo","text":"Another test comment for UI","created_at":"2026-01-17T17:35:00Z"}]}
{"id":"tau-neg.3","title":"Add built-in sandbox extension skeleton + /sandbox and /approval commands","description":"Create tau sandbox extension: .pi/extensions/sandbox/index.ts (real implementation) + extensions/sandbox/src/index.ts re-export + package.json. Register /sandbox + /approval commands (interactive picker UX) and override tools bash/edit/write by registering same names. Persist state via session custom entries (customType sandbox_state). DoD: manual QA in TUI.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.749451539+01:00","updated_at":"2026-01-17T20:09:24.416019821+01:00","closed_at":"2026-01-17T20:09:24.416019821+01:00","close_reason":"Extension skeleton complete with /sandbox and /approval commands, CLI flags (--sandbox-fs, --sandbox-net, --approval-policy), and full session state persistence.","dependencies":[{"issue_id":"tau-neg.3","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.749883518+01:00","created_by":"daemon"},{"issue_id":"tau-neg.3","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.749914567+01:00","created_by":"daemon"}],"comments":[{"id":3,"issue_id":"tau-neg.3","author":"ribelo","text":"Session persistence confirmed: store current sandbox+approval state (fs mode, net mode, allowlist, approval policy, timeout) as session CustomEntry (type=custom, customType like 'sandbox_state') so resume keeps settings. Use pi.appendEntry from extension command handlers; reconstruct state by scanning session entries on session_start.","created_at":"2026-01-17T16:18:47Z"},{"id":10,"issue_id":"tau-neg.3","author":"ribelo","text":"Implemented sandbox extension skeleton in tau/extensions/sandbox/src/index.ts:n- /sandbox and /approval commands with SettingsList-based picker UIs (session overrides + allowlist editor).n- Session override persistence via custom entry type 'sandbox_state' (restored on session_start/tree/fork).n- Tool overrides for bash/edit/write wired to built-in tool factories.nPending: manual TUI QA before closing.","created_at":"2026-01-17T17:59:18Z"}]}
{"id":"tau-neg.4","title":"Enforce filesystem policy for edit/write (realpath checks + deny .git/hooks)","description":"Implement edit/write tools in extension (override built-ins) with realpath-safe enforcement: read-only denies writes (except /tmp + $TMPDIR), workspace-write allows only under workspace root, danger allows all. Deny writes to \u003cworkspace\u003e/.git/hooks/** unless danger-full-access. DoD: unit tests + meaningful errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.77294451+01:00","updated_at":"2026-01-18T01:31:55.585832984+01:00","closed_at":"2026-01-18T01:31:55.585832984+01:00","close_reason":"Implemented filesystem policy enforcement for edit/write with realpath checks, /tmp always writable, and deny writes to \u003cworkspace\u003e/.git/hooks/** unless danger-full-access. Unit tests included.","dependencies":[{"issue_id":"tau-neg.4","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.77328717+01:00","created_by":"daemon"},{"issue_id":"tau-neg.4","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.765494871+01:00","created_by":"daemon"},{"issue_id":"tau-neg.4","depends_on_id":"tau-neg.2","type":"blocks","created_at":"2026-01-17T17:08:33.827395268+01:00","created_by":"daemon"}]}
{"id":"tau-neg.5","title":"Sandboxed bash execution via ASRT with fs+network modes","description":"Implement bash tool override in extension using ASRT for OS-level sandboxing (mac+linux). Map filesystemMode/networkMode/allowlist into ASRT config. Include deny-write for \u003cworkspace\u003e/.git/hooks/** (unless danger). Best-effort linux denial heuristics; meaningful error text. DoD: gated integration test + manual QA.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.795798835+01:00","updated_at":"2026-01-18T01:31:47.910994887+01:00","closed_at":"2026-01-18T01:31:47.910994887+01:00","close_reason":"Implemented ASRT-wrapped bash with fs/network modes + deny .git/hooks in non-danger modes. Added --no-sandbox escape hatch and symlink-safe handling for ASRT default mounts (resolve targets for ~/.claude/debug + ~/.npm/_logs). Gated integration tests tracked in tau-neg.8.","dependencies":[{"issue_id":"tau-neg.5","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.796082289+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.1","type":"blocks","created_at":"2026-01-17T17:08:33.733119108+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.81243869+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.2","type":"blocks","created_at":"2026-01-17T17:08:33.842317114+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.7","type":"blocks","created_at":"2026-01-17T17:08:33.856811047+01:00","created_by":"daemon"}]}
{"id":"tau-neg.6","title":"Approval flow: ask+timeout + rerun tool call with elevated permission","description":"Implement approval flow in extension for denied operations: never-\u003edeny; ask-\u003eblocking prompt (60s, notify-send if available) then rerun tool call once with elevated permission (fs or net) for this call only; on-failure-\u003eprompt only when likely policy-related. Headless/RPC: deny. DoD: unit tests for decision logic + manual QA.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.817206855+01:00","updated_at":"2026-01-17T20:09:10.645449826+01:00","closed_at":"2026-01-17T20:09:10.645449826+01:00","close_reason":"Implemented approval flow: ask→prompt before bash, on-failure→prompt after sandbox error, never→deny. Added --approval-policy CLI flag. Timeout configurable via settings.","dependencies":[{"issue_id":"tau-neg.6","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.817534207+01:00","created_by":"daemon"},{"issue_id":"tau-neg.6","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.780526415+01:00","created_by":"daemon"}]}
{"id":"tau-neg.7","title":"Missing sandbox dependencies handling (prompt once per session)","description":"Detect missing ASRT deps (linux: bwrap/socat/python3; mac: sandbox-exec, optional rg). Prompt once per session to allow unsandboxed bash execution (still keep edit/write enforcement). Cache decision in session state. DoD: unit tests + QA.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:07:38.83909539+01:00","updated_at":"2026-01-18T02:49:07.723493126+01:00","closed_at":"2026-01-18T02:49:07.723493126+01:00","close_reason":"Detect missing ASRT deps and prompt once per session to allow unsandboxed bash fallback","dependencies":[{"issue_id":"tau-neg.7","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.839435786+01:00","created_by":"daemon"},{"issue_id":"tau-neg.7","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.797182552+01:00","created_by":"daemon"}]}
{"id":"tau-neg.8","title":"Add vitest coverage for sandbox policies (unit + gated integration)","description":"Add vitest coverage in tau extension workspace: policy merging, settings precedence, workspace root detection, realpath enforcement, approval decision logic. Add OS-gated integration tests for ASRT when env PI_SANDBOX_TESTS=1. DoD: green tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.859097387+01:00","updated_at":"2026-01-18T02:21:23.029665597+01:00","closed_at":"2026-01-18T02:21:23.029665597+01:00","close_reason":"Added vitest coverage: approval.test.ts (38 tests for policy decision logic) + sandbox-bash.integration.test.ts (16 ASRT integration tests gated behind PI_SANDBOX_TESTS=1). Total: 83 tests (67 unit + 16 integration).","dependencies":[{"issue_id":"tau-neg.8","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.85938536+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.5","type":"blocks","created_at":"2026-01-17T17:08:33.871245832+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.4","type":"blocks","created_at":"2026-01-17T17:08:33.886092592+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.6","type":"blocks","created_at":"2026-01-17T17:08:33.901229175+01:00","created_by":"daemon"}]}
{"id":"tau-neg.9","title":"Docs: sandbox/approval usage + troubleshooting","description":"Docs in tau extension: /sandbox + /approval usage, defaults, allowlist syntax, deps to install, troubleshooting. DoD: README under .pi/extensions/sandbox and extensions/sandbox.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-17T17:07:38.879022437+01:00","updated_at":"2026-01-18T02:49:12.797347136+01:00","closed_at":"2026-01-18T02:49:12.797347136+01:00","close_reason":"Added sandbox/approval usage + troubleshooting docs in extensions/sandbox/README.md","dependencies":[{"issue_id":"tau-neg.9","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.879304008+01:00","created_by":"daemon"},{"issue_id":"tau-neg.9","depends_on_id":"tau-neg.6","type":"blocks","created_at":"2026-01-17T17:08:33.917850991+01:00","created_by":"daemon"},{"issue_id":"tau-neg.9","depends_on_id":"tau-neg.5","type":"blocks","created_at":"2026-01-17T17:08:33.933079229+01:00","created_by":"daemon"}]}
{"id":"tau-px0","title":"Update beads extension UI","description":"Update the beads extension UI to remove $ prefix, extract flags in header, and improve issue alignment in lists.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T18:05:37.950426512+01:00","updated_at":"2026-01-17T18:06:30.459726952+01:00","closed_at":"2026-01-17T18:06:30.459726952+01:00","close_reason":"Done"}
{"id":"tau-r8o","title":"Fix worked-for prompt causing infinite generation","description":"Rendering 'Worked for …' looks fine, but the data/prompt being sent to the model appears to include a recursive or unbounded representation (possibly a function, HTML, or repeating string) causing the model to never stop talking. Investigate worked-for.ts prompt construction + call sites and fix to send bounded, plain-text content.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-16T00:24:35.551771099+01:00","updated_at":"2026-01-16T00:34:48.438814703+01:00","closed_at":"2026-01-16T00:34:48.438814703+01:00","close_reason":"Closed"}
{"id":"tau-s7j","title":"task tui: show worker duration in usage line","description":"Measure wall-clock duration of worker run and include it in the footer usage line (e.g. '10s 2 turns ↑…').","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:35:36.422495453+01:00","updated_at":"2026-01-16T17:38:03.689332797+01:00","closed_at":"2026-01-16T17:38:03.689332797+01:00","close_reason":"Measured worker wall time and display it in task footer usage line","dependencies":[{"issue_id":"tau-s7j","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:35:36.431290871+01:00","created_by":"daemon"}]}
{"id":"tau-t4p","title":"agent-awareness extension: detect concurrent pi processes in overlapping directories","description":"## Overview\n\nCreate a new pi extension that detects other pi processes working in overlapping directories and injects contextual warnings to prevent destructive operations that could interfere with concurrent agents.\n\n## Problem\n\nWhen multiple pi agents work in the same git repository (e.g., one in /tau/extensions/beads, another in /tau/extensions/sandbox), they may:\n- Run destructive git commands (restore, reset, clean) that affect each other\n- Be confused by unstaged changes they didn't make\n- Accidentally overwrite or delete files another agent is working on\n\n## Solution\n\nInject awareness of concurrent agents into the model context, similar to how sandbox extension injects SANDBOX_STATE/SANDBOX_CHANGE notices.\n\n## Detection Logic\n\n1. Find all pi processes via pgrep -x pi\n2. For each PID (excluding process.pid), read /proc/\u003cpid\u003e/cwd\n3. Find git root for our cwd (git rev-parse --show-toplevel)\n4. Count PIDs where cwd is within same git root, or is ancestor/descendant of our cwd\n5. Subtract 1 (self) - if count \u003e 0, inject notice\n\n## Injection Pattern\n\n- System prompt (first turn): behavioral instructions\n- Context hook: AGENT_CONTEXT notice prepended to last user message\n- When count drops to 0: inject 'no other agents detected' notice\n\n## Platform Support\n\n- Linux: full support via /proc filesystem\n- macOS: stub returning empty (implement later)\n- Windows: stub returning empty\n\n## Files\n\nNew extension at: extensions/agent-awareness/\n- package.json (minimal, like beads extension)\n- src/index.ts (main extension)\n- src/detection.ts (process detection logic)\n- src/injection.ts (message injection helpers)\n- test/ (unit tests)","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-18T12:47:31.84605292+01:00","updated_at":"2026-01-18T12:47:31.84605292+01:00"}
{"id":"tau-t4p.1","title":"Create extension scaffold","description":"## Task\n\nCreate the basic extension structure for agent-awareness.\n\n## Files to Create\n\n### extensions/agent-awareness/package.json\n```json\n{\n  \"name\": \"agent-awareness\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"pi\": {\n    \"extensions\": [\"./src/index.ts\"]\n  },\n  \"devDependencies\": {\n    \"vitest\": \"^3.2.4\"\n  },\n  \"scripts\": {\n    \"test\": \"vitest --run\"\n  }\n}\n```\n\n### extensions/agent-awareness/src/index.ts\nMinimal skeleton that exports default function and registers with pi.\n\n## DoD\n\n- Directory exists: extensions/agent-awareness/\n- package.json is valid and follows beads extension pattern\n- src/index.ts exports default function that takes ExtensionAPI\n- npm install succeeds in the extension directory\n- Extension loads without errors when pi starts","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T12:47:44.924015072+01:00","updated_at":"2026-01-18T12:47:44.924015072+01:00","dependencies":[{"issue_id":"tau-t4p.1","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:47:44.924526402+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.2","title":"Implement Linux process detection","description":"## Task\n\nImplement the core detection logic for Linux using /proc filesystem.\n\n## File: extensions/agent-awareness/src/detection.ts\n\n### Functions to Implement\n\n#### listPiProcesses(): Promise\u003cArray\u003c{pid: number, cwd: string}\u003e\u003e\n1. Run `pgrep -x pi` to get list of PIDs\n2. For each PID, read /proc/\u003cpid\u003e/cwd symlink\n3. Filter out any that fail (process may have exited)\n4. Return array of {pid, cwd} objects\n\n#### getGitRoot(cwd: string): Promise\u003cstring | null\u003e\n1. Run `git -C \u003ccwd\u003e rev-parse --show-toplevel`\n2. Return the path or null if not a git repo\n\n#### isOverlapping(ourCwd: string, ourGitRoot: string | null, theirCwd: string): boolean\nCheck if two directories overlap:\n- Same directory: ourCwd === theirCwd\n- They are ancestor of us: ourCwd.startsWith(theirCwd + '/')\n- We are ancestor of them: theirCwd.startsWith(ourCwd + '/')\n- Same git root: if ourGitRoot !== null, check if theirCwd.startsWith(ourGitRoot + '/') or theirCwd === ourGitRoot\n\n#### countOverlappingAgents(ourCwd: string): Promise\u003cnumber\u003e\n1. Get our PID via process.pid\n2. Get our git root via getGitRoot(ourCwd)\n3. List all pi processes\n4. Filter to overlapping ones (excluding our PID)\n5. Return count\n\n## Platform Guard\n\nExport a function `isLinux(): boolean` that returns `process.platform === 'linux'`\n\nFor non-Linux, countOverlappingAgents should return 0.\n\n## DoD\n\n- All functions implemented and exported\n- Unit tests for isOverlapping with various path combinations\n- Unit tests mock /proc reads for listPiProcesses\n- Works correctly when run on Linux","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:02.052225903+01:00","updated_at":"2026-01-18T12:48:02.052225903+01:00","dependencies":[{"issue_id":"tau-t4p.2","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:02.052640603+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.2","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:49:29.324954331+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.3","title":"Implement message injection helpers","description":"## Task\n\nImplement helpers for injecting AGENT_CONTEXT notices into messages, following the sandbox extension pattern.\n\n## File: extensions/agent-awareness/src/injection.ts\n\n### Functions to Implement\n\n#### buildAgentContextNotice(count: number): string\n- If count \u003e 0: return `AGENT_CONTEXT: ${count} other agent${count \u003e 1 ? 's' : ''} working in overlapping directories`\n- If count === 0: return `AGENT_CONTEXT: no other agents detected`\n\n#### injectAgentContextIntoMessages\u003cT extends { role: string; content?: any }\u003e(messages: T[], noticeText: string): T[]\nFollow sandbox-change.ts pattern:\n1. Find the last user message\n2. If content[0] already starts with 'AGENT_CONTEXT:', return unchanged\n3. Prepend a TextContent block with noticeText + '\\n\\n'\n4. Return new array (don't mutate input)\n\n### Types\n\n```typescript\nimport type { TextContent, ImageContent } from \"@mariozechner/pi-ai\";\n```\n\n## Reference\n\nSee: extensions/sandbox/src/sandbox-change.ts for the pattern\n\n## DoD\n\n- Functions implemented and exported\n- Unit tests for buildAgentContextNotice with various counts\n- Unit tests for injectAgentContextIntoMessages\n- Handles edge cases: empty messages array, non-user messages only","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:18.815824173+01:00","updated_at":"2026-01-18T12:48:18.815824173+01:00","dependencies":[{"issue_id":"tau-t4p.3","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:18.816269089+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.3","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:49:37.145379576+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.4","title":"Implement system prompt injection","description":"## Task\n\nInject behavioral instructions into the system prompt on first model turn.\n\n## Implementation in src/index.ts\n\n### Hook: before_agent_start\n\nRegister handler for 'before_agent_start' event:\n\n```typescript\npi.on(\"before_agent_start\", async (event, ctx) =\u003e {\n  // Only inject once per session (track via session state)\n  if (sessionState.instructionsInjected) return;\n  \n  sessionState.instructionsInjected = true;\n  persistState();\n  \n  const instructions = buildConcurrentAgentInstructions();\n  return {\n    systemPrompt: `${event.systemPrompt}\\n\\n${instructions}`\n  };\n});\n```\n\n### Instructions Text\n\n```\n\u003cconcurrent_agent_instructions\u003e\nMultiple pi agents may work concurrently in overlapping directories.\nThe current state is injected as AGENT_CONTEXT: ... in user messages.\n\nWhen other agents are detected:\n- Do not run: git restore, git checkout, git reset, git clean, git push --force, git rebase\n- Do not bulk delete files (rm -rf, find -delete)\n- Always read files before editing them\n- Expect unstaged changes you didn't make - this is normal\n- If uncertain about file ownership, ask user for confirmation\n\u003c/concurrent_agent_instructions\u003e\n```\n\n### Session State\n\nTrack if instructions were injected to avoid duplicate injection.\n\n## DoD\n\n- Handler registered for before_agent_start\n- Instructions injected into system prompt on first turn only\n- Session state persisted correctly\n- Does not inject on subsequent turns","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:35.973395429+01:00","updated_at":"2026-01-18T12:48:35.973395429+01:00","dependencies":[{"issue_id":"tau-t4p.4","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:35.973823886+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.4","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:49:44.797113811+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.5","title":"Implement context hook for AGENT_CONTEXT injection","description":"## Task\n\nInject AGENT_CONTEXT notice into messages before each model turn.\n\n## Implementation in src/index.ts\n\n### Hook: context\n\n```typescript\npi.on(\"context\", async (event, ctx) =\u003e {\n  // Run detection synchronously before each turn\n  const count = await countOverlappingAgents(ctx.cwd);\n  \n  // Track previous count to detect changes\n  const previousCount = sessionState.lastAgentCount ?? -1;\n  \n  // Inject notice if:\n  // 1. count \u003e 0 (there are other agents)\n  // 2. count dropped to 0 (was \u003e 0, now 0 - need to inform model)\n  const shouldInject = count \u003e 0 || (previousCount \u003e 0 \u0026\u0026 count === 0);\n  \n  sessionState.lastAgentCount = count;\n  persistState();\n  \n  if (!shouldInject) return;\n  \n  const notice = buildAgentContextNotice(count);\n  const nextMessages = injectAgentContextIntoMessages(event.messages, notice);\n  \n  return { messages: nextMessages };\n});\n```\n\n### Session State Updates\n\nAdd to SessionState type:\n```typescript\ntype SessionState = {\n  instructionsInjected?: boolean;\n  lastAgentCount?: number;\n};\n```\n\n### State Management\n\nFollow sandbox pattern:\n- loadSessionState(ctx) - read from session entries\n- persistState() - write via pi.appendEntry()\n\n## DoD\n\n- Handler registered for context event\n- Detection runs synchronously before each turn (\u003c100ms target)\n- Notice injected when count \u003e 0\n- Notice injected when count drops to 0\n- State persisted between turns\n- Does not duplicate injection if notice already present","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:51.732930772+01:00","updated_at":"2026-01-18T12:48:51.732930772+01:00","dependencies":[{"issue_id":"tau-t4p.5","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:51.733421803+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.5","depends_on_id":"tau-t4p.2","type":"blocks","created_at":"2026-01-18T12:49:52.382775808+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.5","depends_on_id":"tau-t4p.3","type":"blocks","created_at":"2026-01-18T12:50:00.428564294+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.6","title":"Add extension to install script","description":"## Task\n\nUpdate the tau extension installer script to include agent-awareness.\n\n## File: scripts/pi/install-extensions.sh\n\nAdd agent-awareness to the list of extensions to symlink into ~/.pi/agent/extensions/\n\n## DoD\n\n- Script updated to include agent-awareness\n- Running ./scripts/pi/install-extensions.sh symlinks the new extension\n- Extension is discoverable by pi after installation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T12:49:03.328238539+01:00","updated_at":"2026-01-18T12:49:03.328238539+01:00","dependencies":[{"issue_id":"tau-t4p.6","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:49:03.329139359+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.6","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:50:07.948474071+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.7","title":"Integration testing","description":"## Task\n\nCreate integration tests that verify the full extension behavior.\n\n## Tests to Create\n\n### test/integration.test.ts\n\n1. **Detection test**: Verify countOverlappingAgents returns correct count\n   - May need to mock or spawn actual pi processes for realistic test\n\n2. **Injection test**: Verify AGENT_CONTEXT appears in messages\n   - Create mock pi extension context\n   - Simulate context hook invocation\n   - Assert notice is prepended to last user message\n\n3. **State persistence test**: Verify session state tracks correctly\n   - Simulate multiple turns\n   - Assert lastAgentCount is tracked\n   - Assert instructionsInjected flag prevents duplicate injection\n\n### Manual Testing Checklist\n\n- [ ] Start pi in directory A\n- [ ] Start second pi in same directory A\n- [ ] Verify first pi shows 'AGENT_CONTEXT: 1 other agent...' on next turn\n- [ ] Close second pi\n- [ ] Verify first pi shows 'AGENT_CONTEXT: no other agents detected'\n\n## DoD\n\n- Unit tests pass: npm test in extensions/agent-awareness\n- Manual testing completed and documented\n- No regressions in existing extension behavior","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T12:49:18.465564134+01:00","updated_at":"2026-01-18T12:49:18.465564134+01:00","dependencies":[{"issue_id":"tau-t4p.7","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:49:18.465994248+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.7","depends_on_id":"tau-t4p.5","type":"blocks","created_at":"2026-01-18T12:50:19.508207152+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.7","depends_on_id":"tau-t4p.4","type":"blocks","created_at":"2026-01-18T12:50:27.20882145+01:00","created_by":"ribelo"}]}
{"id":"tau-tge","title":"Add structured output support for task workers","description":"Add optional 'output_schema' parameter to task tool.nnWhen provided:n1. Validate JSON schema before spawning workern2. Inject a 'submit_result' tool matching the schema into workern3. Force tool-only mode (no free text response) on the providern4. Return parsed structured data instead of textnnThis enables programmatic processing of worker results.nnProviders support forcing tool use:n- Anthropic: tool_choice.type = 'any'n- OpenAI: tool_choice = 'required'n- Gemini: toolConfig.functionCallingConfig.mode = 'ANY'","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T22:18:17.94547851+01:00","updated_at":"2026-01-16T22:42:50.12537049+01:00","closed_at":"2026-01-16T22:42:50.12537049+01:00","close_reason":"Done"}
{"id":"tau-tgp","title":"DemoGraph: Multi-JSON output parsing","description":"Related + discovered-from example (non-blocking deps).","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-16T00:49:49.946226445+01:00","updated_at":"2026-01-16T00:49:49.946226445+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-tgp","depends_on_id":"tau-8wx.3","type":"discovered-from","created_at":"2026-01-16T00:49:49.946628703+01:00","created_by":"daemon"},{"issue_id":"tau-tgp","depends_on_id":"tau-8wx.2","type":"related","created_at":"2026-01-16T00:49:49.946902496+01:00","created_by":"daemon"}]}
{"id":"tau-tt5","title":"skill-marker: package extension + add install script for global pi extensions","description":"User reports skill-marker not loading globally; their ~/.pi/agent/extensions uses symlinks to tau/extensions/* packages (beads/exa/task/tau).nnWork:n- Create tau/extensions/skill-marker as a proper extension package (package.json with pi.extensions, src/index.ts).n- Make tau/.pi/extensions/skill-marker/index.ts re-export from tau/extensions/skill-marker/src/index.ts to avoid duplication.n- Add an install helper script in tau to symlink (or copy) extensions into ~/.pi/agent/extensions, including skill-marker.nnDoD:n- Running the install script results in ~/.pi/agent/extensions/skill-marker pointing to tau/extensions/skill-marker.n- `pi` shows skill-marker in 'Loaded extensions' list outside the tau repo.n- Docs updated with the new install path/script.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:29:05.084242187+01:00","updated_at":"2026-01-17T17:35:35.359763715+01:00","closed_at":"2026-01-17T17:35:35.359763715+01:00","close_reason":"Removed repo-local ./.pi/extensions; packaged skill-marker under extensions/skill-marker; added scripts/pi/install-extensions.sh and updated AGENTS.md + global symlinks"}
{"id":"tau-v50","title":"beads renderer: support dep add/remove/cycles and comments","description":"Port the old stash changes (from pre-tau-i3c consolidation) into the unified tau extension's beads renderer.\\n\\nDoD:\\n- bd dep add/remove/cycles render as a compact block\\n- bd comment/comments render as a compact block\\n- ensureJsonFlag/quiet handling updated\\n- no crashes when json is empty\\n\\nSource reference: stash@{0} (old extensions/beads/src/index.ts)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T14:40:24.3486337+01:00","updated_at":"2026-01-18T14:42:05.088524316+01:00","closed_at":"2026-01-18T14:42:05.088524316+01:00","close_reason":"Ported renderer support into extensions/tau/src/beads for dep add/remove/cycles and comment/comments","dependencies":[{"issue_id":"tau-v50","depends_on_id":"tau-i3c","type":"discovered-from","created_at":"2026-01-18T14:40:24.351753362+01:00","created_by":"ribelo"}]}
{"id":"tau-vze","title":"task tool: reject unknown session_id","description":"If session_id is provided but not known to the SessionManager, return an error instead of silently creating a new session.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T19:34:02.449567153+01:00","updated_at":"2026-01-16T19:35:51.133002784+01:00","closed_at":"2026-01-16T19:35:51.133002784+01:00","close_reason":"Unknown session_id now errors instead of starting a new session","dependencies":[{"issue_id":"tau-vze","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-16T19:34:02.458508738+01:00","created_by":"daemon"}]}
{"id":"tau-wf1","title":"task tool: fail on missing skills","description":"If any requested skills are missing, return an error and do not run the worker. Include missing skill names in the error message.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T19:34:09.829173876+01:00","updated_at":"2026-01-16T19:35:57.841827531+01:00","closed_at":"2026-01-16T19:35:57.841827531+01:00","close_reason":"Missing skills now fail fast with explicit error","dependencies":[{"issue_id":"tau-wf1","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-16T19:34:09.829669812+01:00","created_by":"daemon"}]}
{"id":"tau-wts","title":"sandbox: show change notices in session history","description":"Ensure SANDBOX_CHANGE is visible to the user in session history (not just injected into LLM context). Use extension hooks: add a display-only custom message (filtered out in context) so users can see changes in the session log, while the model still gets SANDBOX_CHANGE as user content[0].","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T03:14:25.429812941+01:00","updated_at":"2026-01-18T03:18:22.722866089+01:00","closed_at":"2026-01-18T03:18:22.722866089+01:00","close_reason":"Emit sandbox change notices as UI-visible session history entries (custom message) while filtering them from LLM context"}
{"id":"tau-xdn","title":"Error when task type config references non-existent skills","description":"Same issue as tau-8oj but for skills.\n\nCurrently, if a task type config specifies skills that don't exist, they are silently ignored.\n\nExpected behavior:\n- Validate that all skills in task type configs exist\n- Produce clear error listing unknown skills\n- Fail fast on invalid config\n\nRelated: tau-8oj (same issue for tools)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:30:16.869912146+01:00","updated_at":"2026-01-17T02:38:37.773872447+01:00","closed_at":"2026-01-17T02:38:37.773872447+01:00","close_reason":"Validate task tool configs and error on unknown skill names."}
