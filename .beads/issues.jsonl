{"id":"tau-003","title":"fix: make $skill autocomplete work with tau terminal prompt editor","description":"Bug: skill-marker extension sets a custom editor via ctx.ui.setEditorComponent, but tau/terminal-prompt also sets a custom editor and is loaded after skill-marker, overwriting it. Result: $skill autocomplete stops working globally.\n\nFix approach:\n- Stop skill-marker extension from owning the editor (no ctx.ui.setEditorComponent).\n- Implement $skill autocomplete + auto-trigger inside tau terminal prompt editor (TerminalPromptEditor), since it owns the editor.\n- Keep skill-marker extension responsible for skill injection only.\n\nDoD:\n- With global extensions installed, typing '$' shows skill suggestions even outside tau repo.\n- / and @ completions remain unchanged.\n- Skill injection still works.\n","notes":"Revising approach: use editor-hub plugin composition so terminal-prompt and skill-marker remain independent; do not move logic into terminal-prompt directly.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:43:20.290055176+01:00","updated_at":"2026-01-17T17:50:40.621339319+01:00","closed_at":"2026-01-17T17:50:40.621339319+01:00","close_reason":"Resolved via editor-hub plugin composition; skill-marker and terminal-prompt no longer fight over editor ownership"}
{"id":"tau-05f","title":"Add task-delegation skill to task extension","description":"Move /tmp/task-delegation/SKILL.md into extensions/task and copy it into ~/.pi/agent/skills/task-delegation/SKILL.md on startup if missing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:11:28.806891138+01:00","updated_at":"2026-01-17T01:12:11.613053671+01:00","closed_at":"2026-01-17T01:12:11.613053671+01:00","close_reason":"Added task-delegation skill bundle and install-on-missing logic."}
{"id":"tau-0mv","title":"Task tool field renames (type/size/result_schema)","description":"Replace task tool fields with type/size/result_schema, update validation, messages, response payload, and rendering. No backward compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T00:42:15.685676185+01:00","updated_at":"2026-01-17T00:48:28.595006069+01:00","closed_at":"2026-01-17T00:48:28.595006069+01:00","close_reason":"Replaced task tool fields with type/size/result_schema and updated payloads/messages."}
{"id":"tau-102","title":"Dummy for deletion","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-23T02:00:39.428956423+01:00","updated_at":"2026-01-23T02:01:01.076714006+01:00","deleted_at":"2026-01-23T02:01:01.076714006+01:00","deleted_by":"ribelo","delete_reason":"manual delete","original_type":"task"}
{"id":"tau-13i","title":"extension: auto-trigger $skill autocomplete while typing","description":"Add editor behavior so typing '$' triggers the autocomplete list immediately, similar to how '/' command suggestions appear without pressing Tab.nnImplementation notes:n- Implement in .pi/extensions/skill-marker/index.ts within SkillMarkerEditor.n- After super.handleInput inserts a char, if we are in $skill token context and autocomplete is not already open, invoke Editor's internal autocomplete trigger (via runtime method access).n- Must not break existing '/' and '@' autocomplete behavior.nnDoD:n- Typing '$' (at start or after whitespace) immediately shows skill suggestions (no Tab).n- Continuing to type updates suggestions.n- '$' not preceded by whitespace does not trigger.n- Manual check: '/mo' and '@' autocomplete still behave exactly as before.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:58:53.078911903+01:00","updated_at":"2026-01-17T16:59:20.625140361+01:00","closed_at":"2026-01-17T16:59:20.625140361+01:00","close_reason":"Implemented auto-trigger for $skill autocomplete on typing '$' (no Tab required)","dependencies":[{"issue_id":"tau-13i","depends_on_id":"tau-2lq","type":"discovered-from","created_at":"2026-01-17T16:58:53.088178418+01:00","created_by":"daemon"}]}
{"id":"tau-1q7","title":"chore: configure git remote for tau and set upstream","description":"This repo currently has no git remotes configured (.git/config has no [remote]). Add origin and set main to track origin/main so git pull --rebase and git push work.","status":"closed","priority":1,"issue_type":"chore","created_at":"2026-01-16T16:32:41.236898376+01:00","updated_at":"2026-01-16T16:34:29.064810293+01:00","closed_at":"2026-01-16T16:34:29.064810293+01:00","close_reason":"Added origin remote (https://github.com/ribelo/tau), pushed main, and verified upstream tracking"}
{"id":"tau-1si","title":"Epic: tau post-migration cleanup (shared utils + boundaries)","description":"Goal: follow-up refactors after consolidating many extensions into `extensions/tau`.\n\nScope:\n- remove dead code\n- move shared helpers into `extensions/tau/src/shared/`\n- reduce duplication between sandbox/task/registry\n- keep behavior unchanged (refactor-only)\n\nMotivation:\n- avoid drift (duplicate deepMerge/readJsonFile/migrateApprovalPolicy)\n- clearer boundaries (task shouldn't re-implement sandbox config logic)\n- remove stdout logging from extensions\n","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-18T22:09:28.88977813+01:00","updated_at":"2026-01-18T22:34:39.259416648+01:00","closed_at":"2026-01-18T22:34:39.259416648+01:00","close_reason":"Done: moved shared helpers to shared/, removed duplication, and improved type safety."}
{"id":"tau-1si.1","title":"shared: dedupe deepMerge/readJsonFile/migrateApprovalPolicy","description":"Targets:\n- `extensions/tau/src/shared/state.ts`: deepMerge implementation\n- `extensions/tau/src/sandbox/config.ts`: deepMerge + readJsonFile + migrateApprovalPolicy\n- `extensions/tau/src/task/registry.ts`: readJsonFile + migrateApprovalPolicy\n\nGoal:\n- Move these into `extensions/tau/src/shared/` (e.g. json.ts, merge.ts, sandbox-policy.ts), and reuse.\n- Keep behavior identical.\n\nDoD:\n- One canonical deep merge helper used by sandbox config + persisted state.\n- One canonical json file reader used by task registry + sandbox config.\n- One canonical approvalPolicy migration/normalization helper used everywhere.\n- `npm -C extensions/tau test` passes.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T22:10:13.173553821+01:00","updated_at":"2026-01-19T00:21:14.135994336+01:00","closed_at":"2026-01-19T00:21:14.135994336+01:00","close_reason":"Done in previous session: created shared/fs.ts, shared/json.ts, shared/policy.ts and updated sandbox/config.ts and task/registry.ts to use them.","dependencies":[{"issue_id":"tau-1si.1","depends_on_id":"tau-1si","type":"parent-child","created_at":"2026-01-18T22:10:13.174037174+01:00","created_by":"ribelo"}]}
{"id":"tau-1si.2","title":"sandbox/task: centralize parent effective sandbox snapshot","description":"Problem:\n- `extensions/tau/src/task/index.ts` currently re-computes effective sandbox config as a fallback.\n\nGoal:\n- Export a small helper from sandbox (or shared) so task doesn't know sandbox internals.\n\nSuggested shape:\n- `getEffectiveSandboxConfig(ctx, state)` or similar.\n\nDoD:\n- `extensions/tau/src/task/index.ts` no longer calls `computeEffectiveConfig`/`discoverWorkspaceRoot` directly.\n- Behavior unchanged.\n- `npm -C extensions/tau test` passes.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T22:10:18.247316088+01:00","updated_at":"2026-01-19T00:24:41.578970924+01:00","closed_at":"2026-01-19T00:24:41.578970924+01:00","close_reason":"Done: created getEffectiveSandboxConfig in sandbox/index.ts and used it in task/index.ts. Removed computeEffectiveConfig and discoverWorkspaceRoot calls from task/index.ts.","dependencies":[{"issue_id":"tau-1si.2","depends_on_id":"tau-1si","type":"parent-child","created_at":"2026-01-18T22:10:18.247938727+01:00","created_by":"ribelo"}]}
{"id":"tau-1si.3","title":"sandbox: unify allowlist helpers","description":"Current duplication:\n- Parsing in `extensions/tau/src/sandbox/index.ts` (`parseAllowlist`).\n- Normalization/intersection in `extensions/tau/src/task/sandbox-policy.ts`.\n\nGoal:\n- Create a single allowlist helper module reused by both.\n\nDoD:\n- One implementation for parse+normalize+intersection.\n- Existing tests still pass; add/update tests only if needed.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-18T22:10:23.319479588+01:00","updated_at":"2026-01-19T00:28:43.044392707+01:00","closed_at":"2026-01-19T00:28:43.044392707+01:00","close_reason":"Done: created shared/allowlist.ts and unified allowlist helpers across sandbox/index.ts and task/sandbox-policy.ts.","dependencies":[{"issue_id":"tau-1si.3","depends_on_id":"tau-1si","type":"parent-child","created_at":"2026-01-18T22:10:23.320070866+01:00","created_by":"ribelo"}]}
{"id":"tau-1si.4","title":"sandbox: remove stdout logging from /sandbox in headless mode","description":"Current:\n- `extensions/tau/src/sandbox/index.ts` uses `console.log(buildSandboxSummary())` when `!ctx.hasUI`.\n\nGoal:\n- Replace with `pi.sendMessage(..., { triggerTurn: false })` or equivalent UI-safe output that doesn't spam stdout or leak into model context.\n\nDoD:\n- No `console.log` usage from tau extensions for user-facing output.\n- Manual smoke: headless /sandbox produces readable output.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T22:10:28.39657183+01:00","updated_at":"2026-01-19T00:25:45.757224121+01:00","closed_at":"2026-01-19T00:25:45.757224121+01:00","close_reason":"Done: replaced console.log with pi.sendMessage in showSandboxSettings for headless mode.","dependencies":[{"issue_id":"tau-1si.4","depends_on_id":"tau-1si","type":"parent-child","created_at":"2026-01-18T22:10:28.397058078+01:00","created_by":"ribelo"}]}
{"id":"tau-1si.5","title":"task: remove dead fields/helpers (if truly unused)","description":"Candidates:\n- `extensions/tau/src/task/registry.ts`: `isDirectory()` appears unused.\n- `extensions/tau/src/task/sessions.ts`: `workerSession` + `nestingDepth` fields and `setWorkerSession()` appear unused.\n\nGoal:\n- Delete unused code, or wire it up properly if it's meant to be used.\n\nDoD:\n- Unused symbols removed OR proven used.\n- No behavior change.\n- `npm -C extensions/tau test` passes.\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-18T22:10:33.476253681+01:00","updated_at":"2026-01-19T00:29:42.724620519+01:00","closed_at":"2026-01-19T00:29:42.724620519+01:00","close_reason":"Done: removed unused isDirectory from registry.ts and unused workerSession/nestingDepth fields and setWorkerSession method from sessions.ts.","dependencies":[{"issue_id":"tau-1si.5","depends_on_id":"tau-1si","type":"parent-child","created_at":"2026-01-18T22:10:33.476671749+01:00","created_by":"ribelo"}]}
{"id":"tau-1si.6","title":"docs: document task sandbox overrides","description":"Update:\n- `extensions/tau/skills/task-type-creation/SKILL.md`\n\nAdd:\n- Document `tasks.\u003ctype\u003e.sandbox` fields and that they are clamped to parent sandbox/approval.\n- Provide short example.\n\nDoD:\n- Skill docs match current behavior.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T22:10:38.554986966+01:00","updated_at":"2026-01-19T00:26:41.315227953+01:00","closed_at":"2026-01-19T00:26:41.315227953+01:00","close_reason":"Done: added sandbox configuration section to task-type-creation SKILL.md.","dependencies":[{"issue_id":"tau-1si.6","depends_on_id":"tau-1si","type":"parent-child","created_at":"2026-01-18T22:10:38.555424331+01:00","created_by":"ribelo"}]}
{"id":"tau-1vq","title":"Add padding line between worked-for separator and prompt","description":"After the worked-for separator widget, add a single empty row of vertical spacing before the editor/prompt renders.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:34:17.456419231+01:00","updated_at":"2026-01-16T00:34:46.135108646+01:00","closed_at":"2026-01-16T00:34:46.135108646+01:00","close_reason":"Closed"}
{"id":"tau-27u","title":"agent: worker doesn't have agent tool - cannot spawn nested agents","description":"Worker agents don't have the agent tool available, so they can't spawn nested agents. Since we have maxDepth limit, nested spawning should be allowed up to that depth.","status":"closed","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T17:08:24.051206451+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:28:55.756202688+01:00","closed_at":"2026-01-26T17:28:55.756202688+01:00","close_reason":"Fixed: Workers now receive agent tool via customTools. Created shared runtime (runtime.ts) and tool factory (tool.ts) to allow nested spawning."}
{"id":"tau-2bl","title":"task tool: return worker output to caller","description":"Fix task tool so the LLM receives actual text content (last assistant message or last tool result) as the tool result. Stop returning content blocks of type 'json' (they are not passed through). Include session_id in returned text for continuation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:44:55.909433488+01:00","updated_at":"2026-01-16T16:47:28.887229686+01:00","closed_at":"2026-01-16T16:47:28.887229686+01:00","close_reason":"task tool now returns text tool result (last assistant or tool output) and includes session_id; stopped returning json blocks","dependencies":[{"issue_id":"tau-2bl","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T16:44:55.918351468+01:00","created_by":"daemon"}]}
{"id":"tau-2c9","title":"Epic: Sandbox failure diagnostics for model clarity","description":"When commands fail inside sandbox, the model often sees cryptic errors like 'Could not resolve host' or 'Permission denied' without understanding these are sandbox restrictions, not real system issues.\n\nProblem:\n- ASRT removes network namespace, so network blocks surface as DNS failures\n- Model misdiagnoses sandbox denials as 'DNS broken' or 'system issue'\n- No structured way for model to know WHY a command failed\n\nSolution:\n- Classify sandbox failures by type (network/filesystem) and subtype (dns/blocked/write)\n- Gate diagnostics using known sandbox config (reduce false positives)\n- Emit clear diagnostic message into tool output stream\n- Optionally include machine-readable JSON blob\n\nRef: ASRT design uses proxies outside sandbox via Unix sockets, so network denial = no network namespace = DNS-like errors.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-18T02:32:18.667434158+01:00","updated_at":"2026-01-18T02:50:13.617045301+01:00","closed_at":"2026-01-18T02:50:13.617045301+01:00","close_reason":"Implemented sandbox failure diagnostics: structured classifier + human + JSON emission, verified ASRT allow-all semantics"}
{"id":"tau-2c9.1","title":"Add classifySandboxFailure() with structured failure types","description":"Replace boolean-only looksLikePolicyViolation() with richer classifier that returns structured failure info:\n\ntype SandboxFailure =\n  | { kind: 'network'; subtype: 'dns' | 'blocked' | 'connect'; evidence: string; confidence: 'high' | 'medium' }\n  | { kind: 'filesystem'; subtype: 'read' | 'write'; evidence: string; confidence: 'high' | 'medium' }\n  | { kind: 'unknown'; evidence: string; confidence: 'low' };\n\nPatterns to detect:\n- Network/blocked (high): 'connection blocked by network allowlist' (ASRT explicit)\n- Network/dns (medium): 'could not resolve host', 'temporary failure in name resolution', ENOTFOUND, EAI_AGAIN\n- Filesystem/write (high): 'read-only file system', 'permission denied', 'operation not permitted'\n\nKeep looksLikePolicyViolation() for approval prompt, use classifier for diagnostics.\n\nDoD: function + unit tests covering all patterns","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T02:32:34.751081319+01:00","updated_at":"2026-01-18T02:48:47.420288206+01:00","closed_at":"2026-01-18T02:48:47.420288206+01:00","close_reason":"Implemented classifySandboxFailure() with tests; wired looksLikePolicyViolation to classifier","dependencies":[{"issue_id":"tau-2c9.1","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:32:34.751494608+01:00","created_by":"ribelo"}]}
{"id":"tau-2c9.2","title":"Emit sandbox diagnostic into tool output on failure","description":"After runCommandCapture() returns with error, if usingSandbox \u0026\u0026 exitCode !== 0:\n\n1. Call classifySandboxFailure(result.output)\n2. Gate by config consistency:\n   - network failure → only if networkMode !== 'allow-all'\n   - filesystem failure → only if filesystemMode !== 'danger-full-access'\n3. Emit diagnostic via onData():\n   '[sandbox] Command failed likely due to sandbox restrictions (network/dns). (fs=workspace-write, net=deny). Evidence: \"Could not resolve host\". Network sandboxing on Linux can surface as DNS failures. If network is required, switch to allowlist/allow-all or re-run with escalate=true.'\n\nThis ensures model sees WHY command failed, not just cryptic error.\n\nDoD: integration into bash handler + manual QA with network-denied curl","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T02:32:50.478067311+01:00","updated_at":"2026-01-18T02:48:52.498035588+01:00","closed_at":"2026-01-18T02:48:52.498035588+01:00","close_reason":"Emit sandbox diagnostic + gating and guidance into bash tool output on sandbox failure","dependencies":[{"issue_id":"tau-2c9.2","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:32:50.479016242+01:00","created_by":"ribelo"},{"issue_id":"tau-2c9.2","depends_on_id":"tau-2c9.1","type":"blocks","created_at":"2026-01-18T02:33:25.641202573+01:00","created_by":"ribelo"}]}
{"id":"tau-2c9.3","title":"Add machine-readable SANDBOX_DIAGNOSTIC JSON line","description":"Optionally emit a single JSON line that model can parse reliably:\n\nSANDBOX_DIAGNOSTIC={\n  \"usingSandbox\": true,\n  \"filesystemMode\": \"workspace-write\",\n  \"networkMode\": \"deny\",\n  \"networkAllowlist\": null,\n  \"classification\": { \"kind\": \"network\", \"subtype\": \"dns\", \"evidence\": \"Could not resolve host\", \"confidence\": \"medium\" }\n}\n\nThis avoids model hallucinating why DNS failed.\n\nDoD: JSON emission + system prompt hint about parsing SANDBOX_DIAGNOSTIC","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T02:33:01.968450085+01:00","updated_at":"2026-01-18T02:48:57.573066566+01:00","closed_at":"2026-01-18T02:48:57.573066566+01:00","close_reason":"Emit SANDBOX_DIAGNOSTIC=\u003cjson\u003e machine-readable line in bash output","dependencies":[{"issue_id":"tau-2c9.3","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:33:01.968931674+01:00","created_by":"ribelo"},{"issue_id":"tau-2c9.3","depends_on_id":"tau-2c9.2","type":"blocks","created_at":"2026-01-18T02:33:30.714772293+01:00","created_by":"ribelo"}]}
{"id":"tau-2c9.4","title":"Verify ASRT allow-all semantics (empty allowedDomains)","description":"CRITICAL: Current code may have wrong semantics!\n\nIn wrapCommandWithSandbox(), for allow-all we currently have network config with empty arrays. But ASRT README says empty allowedDomains = NO network access (block all).\n\nNeed to verify:\n1. Check installed ASRT version behavior\n2. For true 'allow-all': either omit network field entirely OR use explicit wildcard\n3. Current code already omits network for allow-all - verify this is correct\n\nIf empty arrays block network, this explains confusing DNS failures in allow-all mode.\n\nDoD: verify behavior + fix if needed + add comment explaining correct semantics","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T02:33:15.112467762+01:00","updated_at":"2026-01-18T02:49:02.647505473+01:00","closed_at":"2026-01-18T02:49:02.647505473+01:00","close_reason":"Verified ASRT allow-all semantics and added coverage for allowlist→allow-all reset","dependencies":[{"issue_id":"tau-2c9.4","depends_on_id":"tau-2c9","type":"parent-child","created_at":"2026-01-18T02:33:15.11291178+01:00","created_by":"ribelo"}]}
{"id":"tau-2hj","title":"agent: worker doesn't inherit parent model","description":"When model is 'inherit' or undefined, worker uses discoverModels default (bedrock) instead of parent's model. Need to pass parent model explicitly.","status":"closed","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T17:02:54.085264869+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:05:48.522620184+01:00","closed_at":"2026-01-26T17:05:48.522620184+01:00","close_reason":"Fixed: worker now inherits parent model when policy.model is undefined"}
{"id":"tau-2lq","title":"pi: $skill marker autocomplete + skill injection extension","description":"Goal: Implement a pi extension that lets users type $skillname with autocomplete and injects the corresponding SKILL.md contents as a separate \u003cskill\u003e...\u003c/skill\u003e message before the agent starts (codex-style: marker + injected instructions, not inline expansion).nnKey code anchors (pi-mono):n- Input hook order: src/core/agent-session.ts (prompt(): input event -\u003e /skill expansion -\u003e before_agent_start)n- Autocomplete provider: src/modes/interactive/interactive-mode.ts (CombinedAutocompleteProvider)n- Custom editor injection: src/modes/interactive/interactive-mode.ts (setCustomEditorComponent)n- Skills discovery: src/core/skills.ts + src/core/sdk.ts (discoverSkills/loadSettings)nnDefinition of Done:n- Project-local extension (./.pi/extensions/*) provides $skill autocomplete and injects skill bodies before LLM turn.n- Works alongside existing / commands and @ file autocomplete.n- Documented usage and manual test steps.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-17T16:11:06.707164144+01:00","updated_at":"2026-01-17T16:42:27.566712635+01:00","closed_at":"2026-01-17T16:42:27.566712635+01:00","close_reason":"Implemented project-local skill-marker extension (autocomplete + before_agent_start injection). Optional upstream API improvement deferred in tau-2lq.7."}
{"id":"tau-2lq.1","title":"spec: define  marker semantics and injected \u003cskill\u003e format","description":"Decisions for $skill marker + injection (codex-style marker + separate injected instructions message).\n\n## Marker detection\n- Syntax: `$` + skill name\n- Name charset: `[a-z0-9][a-z0-9-]*` (lowercase + digits + hyphen).\n- Boundary rules:\n  - Marker must start at beginning of prompt or be preceded by whitespace.\n  - Name ends at the first non `[a-z0-9-]` char (punctuation ok after).\n  - Examples matched: `$beads`, `use $beads, please`, `\n$beads do X`\n  - Examples NOT matched: `$PATH` (uppercase), `foo$beads` (no whitespace boundary), `\\$beads` (escaped)\n\n## Escaping\n- Escape syntax: `\\$name` (a backslash immediately before `$`) disables injection and leaves literal text.\n\n## Multiple skills\n- Multiple markers may appear in one prompt.\n- Dedupe by skill name, keep the order of first occurrence.\n\n## Prompt text handling\n- Do NOT inline-expand the user prompt.\n- Keep the `$skill` markers unchanged in the user prompt text (transparent + harmless).\n\n## Injected payload\n- Inject a separate extension custom message before the LLM call containing one or more blocks:\n\n```\n\u003cskill\u003e\n\u003cname\u003ebeads\u003c/name\u003e\n\u003cpath\u003e/abs/path/to/SKILL.md\u003c/path\u003e\n\u003cinstructions\u003e\n...SKILL.md body (frontmatter stripped)...\n\u003c/instructions\u003e\n\u003c/skill\u003e\n```\n\n- Injected instructions use pi behavior: strip YAML frontmatter (same as `/skill:name` expansion).\n\n## Size limits\n- Apply truncation to injected instructions using pi defaults: max 2000 lines OR 50KB (whichever hits first).\n- If truncated, append a note inside `\u003cinstructions\u003e`: `[Skill content truncated; full content at: \u003cpath\u003e]`.\n\n## Error handling\n- Unknown skill name: do not inject; optionally notify user via UI (if available).\n- Unreadable SKILL.md: do not inject; notify user via UI (if available).\n\nDoD examples\n- `$beads do X` injects beads SKILL.md body as separate message.\n- `\\$beads` does not inject.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.779585404+01:00","updated_at":"2026-01-17T16:35:00.818137983+01:00","closed_at":"2026-01-17T16:35:00.818137983+01:00","close_reason":"Spec decisions captured in description","dependencies":[{"issue_id":"tau-2lq.1","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.779921829+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.2","title":"extension: scaffold project-local skill-marker extension","description":"Create a project-local pi extension skeleton under ./.pi/extensions/skill-marker/ (index.ts + README).\n\nImplementation notes:\n- Must be auto-discovered by pi (project-local).\n- No startup banners / console.log noise.\n- Provide minimal configuration knobs (e.g. enable/disable, marker char) via constants or env vars.\n\nDoD:\n- .pi/extensions/skill-marker/index.ts exists and loads in pi without errors.\n- README describes how to enable globally (copy to ~/.pi/agent/extensions/) if desired.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.800549346+01:00","updated_at":"2026-01-17T16:35:26.740761485+01:00","closed_at":"2026-01-17T16:35:26.740761485+01:00","close_reason":"Scaffolded project-local extension with README","dependencies":[{"issue_id":"tau-2lq.2","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.800876353+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.3","title":"extension: discover skills + build lookup index","description":"Implement skill discovery inside the extension using pi APIs (import from @mariozechner/pi-coding-agent):\n- loadSettings(cwd, agentDir) to respect existing skills settings\n- discoverSkills(cwd, agentDir, settings.skills) to get names/descriptions/paths\n- Build in-memory index: name -\u003e { path, description }\n- Cache SKILL.md contents on first use (strip frontmatter for injected body if we choose)\n\nCode anchors (pi-mono reference):\n- skills discovery logic: packages/coding-agent/src/core/skills.ts\n- sdk helpers: packages/coding-agent/src/core/sdk.ts (discoverSkills, loadSettings)\n\nDoD:\n- Given a known local skill, extension can resolve name -\u003e SKILL.md path reliably.\n- Handles missing/disabled/invalid skills gracefully (notify or ignore per spec).\n- No filesystem scanning on every keystroke (cache or debounce).\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.822095914+01:00","updated_at":"2026-01-17T16:36:12.945527135+01:00","closed_at":"2026-01-17T16:36:12.945527135+01:00","close_reason":"Implemented skill discovery + in-memory index and cached body loader","dependencies":[{"issue_id":"tau-2lq.3","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.82239641+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.3","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:29.98080527+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.4","title":"extension:  autocomplete in editor (wrap existing provider)","description":"Add $skill autocomplete while typing in pi interactive editor.\n\nApproach:\n- ctx.ui.setEditorComponent() install CustomEditor subclass that wraps the existing autocomplete provider injected by interactive-mode.\n- Implement AutocompleteProvider wrapper:\n  - If cursor is at token matching (start|whitespace) + \"$\" + partialName =\u003e return skill suggestions (fuzzy match).\n  - applyCompletion inserts \"$\" + skillName only (no expansion).\n  - Otherwise delegate to underlying provider so / commands and @file completion keep working.\n\nCode anchors (pi-mono reference):\n- Autocomplete provider: packages/coding-agent/src/modes/interactive/interactive-mode.ts (CombinedAutocompleteProvider)\n- Editor supports custom autocomplete providers: packages/tui/src/components/editor.ts + packages/tui/src/autocomplete.ts\n\nDoD:\n- Typing \"$be\" + Tab suggests beads (if available) and inserts \"$beads\".\n- Existing / and @ completion still works unchanged.\n- No noticeable lag while typing.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.842937862+01:00","updated_at":"2026-01-17T16:37:45.708017135+01:00","closed_at":"2026-01-17T16:37:45.708017135+01:00","close_reason":"Implemented $skill autocomplete by wrapping existing editor autocomplete provider","dependencies":[{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.843236264+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:29.998136193+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.2","type":"blocks","created_at":"2026-01-17T16:12:30.016243816+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.4","depends_on_id":"tau-2lq.3","type":"blocks","created_at":"2026-01-17T16:12:30.03395951+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.5","title":"extension: inject skill instructions before agent_start (codex-style)","description":"Implement skill injection at send-time.\n\nApproach:\n- Use before_agent_start event to detect explicit mentions of $skill tokens in the prompt.\n- For each resolved skill, read SKILL.md and inject a separate custom message into the turn context containing one or more \u003cskill\u003e blocks.\n- Do NOT inline-expand the user prompt text; keep marker or strip per spec task.\n\nInjected message format should include name + path + contents (codex-inspired), e.g.:\n\u003cskill\u003e\n\u003cname\u003ebeads\u003c/name\u003e\n\u003cpath\u003e/abs/.../SKILL.md\u003c/path\u003e\n...contents...\n\u003c/skill\u003e\n\nDoD:\n- With $skill mention, a custom message is added before the user message reaches the model.\n- Supports multiple $skills in one prompt (deduped)\n- Unknown skill leaves prompt unchanged + user notified (or silent) per spec.\n- Escaped \\$skill is not injected.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T16:12:16.862085184+01:00","updated_at":"2026-01-17T16:38:35.357668778+01:00","closed_at":"2026-01-17T16:38:35.357668778+01:00","close_reason":"Implemented before_agent_start skill injection as separate \u003cskill\u003e blocks","dependencies":[{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.862380019+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.1","type":"blocks","created_at":"2026-01-17T16:12:30.051487502+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.2","type":"blocks","created_at":"2026-01-17T16:12:30.06904926+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.5","depends_on_id":"tau-2lq.3","type":"blocks","created_at":"2026-01-17T16:12:30.086927194+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.6","title":"docs/qa: usage docs + manual test checklist","description":"Write concise docs and a manual QA checklist for the extension.\n\nDocs must cover:\n- How to install project-locally (./.pi/extensions/skill-marker/)\n- How to install globally (~/.pi/agent/extensions/)\n- Examples: $beads, multiple skills, escaping\n- Known limitations (context size, skill filtering vs --skills, etc.)\n\nQA checklist DoD:\n- Steps to verify autocomplete for $ / existing / commands / @ file refs\n- Steps to verify injected message appears in context (by observing model behavior or logs)\n- Error handling checks (missing skill, unreadable SKILL.md)\n","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-17T16:12:16.881456894+01:00","updated_at":"2026-01-17T16:42:24.433041158+01:00","closed_at":"2026-01-17T16:42:24.433041158+01:00","close_reason":"Docs and manual QA checklist added to extension README","dependencies":[{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.881784242+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq.4","type":"blocks","created_at":"2026-01-17T16:12:30.104153448+01:00","created_by":"daemon"},{"issue_id":"tau-2lq.6","depends_on_id":"tau-2lq.5","type":"blocks","created_at":"2026-01-17T16:12:30.127249369+01:00","created_by":"daemon"}]}
{"id":"tau-2lq.7","title":"optional: pi core API - expose discovered skills to extensions","description":"Optional upstream improvement (pi-mono): expose the discovered skills list (name/description/path) to extensions via ExtensionContext or ExtensionAPI.\n\nRationale:\n- Extension currently must re-run discoverSkills() and may not respect CLI --skills filtering.\n- A first-class API would make $skill autocomplete/injection consistent with pi core.\n\nDoD:\n- Proposed API shape documented in issue (and implemented if we choose to upstream).\n- If implemented: minimal tests + docs update in pi-mono.\n","notes":"Optional upstream pi-mono API improvement; extension works without it.","status":"deferred","priority":4,"issue_type":"task","created_at":"2026-01-17T16:12:16.900610928+01:00","updated_at":"2026-01-17T16:42:24.449241658+01:00","dependencies":[{"issue_id":"tau-2lq.7","depends_on_id":"tau-2lq","type":"parent-child","created_at":"2026-01-17T16:12:16.900933075+01:00","created_by":"daemon"}]}
{"id":"tau-2q6","title":"sandbox: move initial state from system prompt to user part[0]","description":"Adjust sandbox prompt strategy: system prompt (first turn) only describes sandbox semantics; current sandbox state must be injected as user message content[0] even on first message (SANDBOX_STATE). Avoid conflicting state between system and user channels.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T11:21:14.661255868+01:00","updated_at":"2026-01-18T11:23:30.670176838+01:00","closed_at":"2026-01-18T11:23:30.670176838+01:00","close_reason":"System prompt now describes sandbox semantics only; initial SANDBOX_STATE is injected into user message content[0], with SANDBOX_CHANGE used for mid-session updates"}
{"id":"tau-2xo","title":"Rename task_type 'general' to 'custom'","description":"The 'general' task type name is too vague. Rename to 'custom' to better indicate it's a user-configurable task type that accepts skills injection.nnChanges needed:n- Update task_type validationn- Update documentationn- Remove 'general' alias entirely (no backward compatibility)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T22:18:17.919781343+01:00","updated_at":"2026-01-16T22:21:50.26924761+01:00","closed_at":"2026-01-16T22:21:50.26924761+01:00","close_reason":"Renamed task_type general to custom and removed alias}"}
{"id":"tau-3a6","title":"Fix bd tool wrapper returning empty results","description":"The bd tool wrapper (used by pi for nice rendering) returns empty output while running bd CLI directly via bash works. Examples: 'bd ready', 'bd list', 'bd show tau-xxx' all return empty via the tool but work via bash. Need to investigate and fix the wrapper implementation.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-18T02:16:00.801953518+01:00","updated_at":"2026-01-18T11:43:47.786122441+01:00","closed_at":"2026-01-18T11:43:47.786122441+01:00","close_reason":"bd tool now returns a text summary alongside JSON for list/ready/show so clients that ignore JSON-only outputs still display results"}
{"id":"tau-46k","title":"editor-hub: compose editor contributions from multiple extensions","description":"Create an editor composition mechanism so multiple extensions can contribute editor behavior without overwriting each other via ctx.ui.setEditorComponent.nnMotivation: tau/terminal-prompt and skill-marker both need editor hooks (render + autocomplete). Only one extension can own the editor in pi, so we need a shared hub with a plugin registry.nnDoD:n- New extension package: extensions/editor-hub (package.json + src/index.ts + src/registry.ts).n- Other extensions register plugins instead of calling setEditorComponent directly.n- Works regardless of extension load order (hub sets editor on next tick).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:47:13.562347054+01:00","updated_at":"2026-01-17T17:48:00.039536681+01:00","closed_at":"2026-01-17T17:48:00.039536681+01:00","close_reason":"Added editor-hub extension package with plugin registry + composed editor (delayed install to avoid load-order issues)"}
{"id":"tau-5va","title":"Task tool batch input and concurrent execution","description":"Make task tool accept an array of task items, run them concurrently with Promise.all, return ordered results per item, and aggregate updates.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T23:42:39.224472647+01:00","updated_at":"2026-01-17T00:08:53.77784996+01:00","closed_at":"2026-01-17T00:08:53.77784996+01:00","close_reason":"Implemented batch task input with concurrent execution and ordered results."}
{"id":"tau-5vw","title":"Demo: render test","description":"Testing beads decorator rendering","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:00:02.9490764+01:00","updated_at":"2026-01-16T00:00:02.9490764+01:00","comments":[{"id":11,"issue_id":"tau-5vw","author":"ribelo","text":"Test comment","created_at":"2026-01-23T01:01:20Z"}]}
{"id":"tau-5xl","title":"task tui: improve task result rendering","description":"Adjust task tool rendering: hide separate call entry, show description inside result, show per-tool success/failure icons, and move usage line to bottom. Combine tool call+result into single line in the task cell.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:31:03.185562479+01:00","updated_at":"2026-01-16T17:33:37.708020437+01:00","closed_at":"2026-01-16T17:33:37.708020437+01:00","close_reason":"Updated task tool rendering: hide call view, show description in result, add per-tool status icons, move usage to footer","dependencies":[{"issue_id":"tau-5xl","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:31:03.197161976+01:00","created_by":"daemon"}]}
{"id":"tau-6jl","title":"Fix invalid tool names in TaskRegistry builtins","description":"TaskRegistry.builtins() references tools that don't exist: ls, find, grep.\n\nActual available tools: read, write, edit, bash, bd, task, web_search_exa, crawling_exa, get_code_context_exa, git_commit_with_user_approval\n\nCurrent broken config:\n- search: tools: ['read', 'ls', 'find', 'grep']  \n- review: tools: ['read', 'ls', 'find', 'grep', 'bash']\n- planning: tools: ['read', 'ls', 'find', 'grep']\n\nShould be:\n- search: tools: ['read', 'bash'] (or just read if truly read-only)\n- review: tools: ['read', 'bash']\n- planning: tools: ['read', 'bash'] (or just read)\n\nNote: read-only enforcement should be via skill guidance, not fake tool restrictions.\n\nRelated: tau-8oj (silent ignore of non-existent tools)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-17T02:42:57.887311017+01:00","updated_at":"2026-01-17T18:03:14.157980791+01:00","closed_at":"2026-01-17T18:03:14.157980791+01:00","close_reason":"Already fixed: extensions/task/src/registry.ts builtins use tools ['read','bash'] for search/review/planning (no ls/find/grep). No further changes needed."}
{"id":"tau-6wu","title":"agent: TUI widget showing active agents status","description":"Add a widget above the input showing active agents with their status. Format: [colored agent name] id: last event (truncated). Each agent type gets a distinct background color. Shows tool calls like '$ cat ... something.txt'. Widget updates on agent state changes.","status":"open","priority":3,"issue_type":"feature","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T17:13:51.832362481+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:13:51.832362481+01:00"}
{"id":"tau-8fd","title":"Port commit.ts extension","description":"Port mitsuhiko/agent-stuff pi-extensions/commit.ts into tau extensions.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T01:34:47.738221331+01:00","updated_at":"2026-01-16T01:36:48.185430791+01:00","closed_at":"2026-01-16T01:36:48.185430791+01:00","close_reason":"Implemented /commit command + git_commit_with_user_approval tool"}
{"id":"tau-8od","title":"Epic: Task-based delegation extension for pi","description":"Replace persona-based subagent extension with task-based delegation system.\n\n## Goals\n1. Task types with minimal contracts (policy, not persona)\n2. Difficulty-based model selection (small/medium/large)\n3. Skill injection into workers\n4. Session continuation via session_id\n5. No sandbox policies (for now)\n6. No personas - workers execute WHAT, not WHO they are\n\n## Architecture\n- **Task Type**: Policy (model, tools, thinking) + default skills\n- **Skill**: Injectable knowledge from ~/.pi/agent/skills/ or .pi/skills/\n- **Task Session**: Durable transcript, resumable via session_id\n- **Worker**: Executes task with context prompt (not identity persona)\n\n## Built-in Task Types\n- code: General implementation work\n- search: Find code, definitions, references (read-only tools)\n- review: Code review with review skill\n- planning: Architecture and design decisions\n- general: User-specified skills\n\n## Config (settings.json)\n```json\n{\n  \"tasks\": {\n    \"code\": {\n      \"difficulty\": {\n        \"small\": { \"model\": \"anthropic/claude-haiku-4\" },\n        \"medium\": { \"model\": \"anthropic/claude-sonnet-4\" },\n        \"large\": { \"model\": \"anthropic/claude-sonnet-4\", \"thinking\": \"high\" }\n      }\n    }\n  }\n}\n```\n\n## DoD\n- New extension in tau/extensions/task/\n- Old subagent extension removed from ~/.pi\n- task tool registered and working\n- Skill injection functional\n- Session continuation working\n- Custom TUI rendering for task results","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T16:06:21.183042058+01:00","updated_at":"2026-01-16T16:25:40.080749927+01:00","closed_at":"2026-01-16T16:25:40.080749927+01:00","close_reason":"Implemented task-based delegation extension and removed old subagent"}
{"id":"tau-8od.1","title":"Create extension scaffold: tau/extensions/task/","description":"Create the basic extension structure.\n\n## Files to create\n```\ntau/extensions/task/\n├── package.json          # Extension manifest with pi.extensions\n└── src/\n    ├── index.ts          # Extension entry point\n    └── types.ts          # TypeScript interfaces\n```\n\n## package.json structure\n```json\n{\n  \"name\": \"task\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"pi\": {\n    \"extensions\": [\"./src/index.ts\"]\n  }\n}\n```\n\n## index.ts minimal scaffold\n- Import ExtensionAPI from @mariozechner/pi-coding-agent\n- Export default function that takes pi: ExtensionAPI\n- Log 'task extension loaded' on session_start\n\n## DoD\n- Extension loads without errors when pi starts\n- session_start event fires and logs message","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:37.81537964+01:00","updated_at":"2026-01-16T16:25:37.274466645+01:00","closed_at":"2026-01-16T16:25:37.274466645+01:00","close_reason":"Created extensions/task scaffold","dependencies":[{"issue_id":"tau-8od.1","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:37.81573528+01:00","created_by":"daemon"}]}
{"id":"tau-8od.10","title":"Create review skill from old review agent","description":"Migrate review agent content to a proper skill.\n\n## Source\nCheck ~/.pi/agent/extensions/subagent/agents/ or ~/.pi/agent/agents/ for review.md\n\n## Target\n~/.pi/agent/skills/review/SKILL.md\n\n## Skill format\n```markdown\n---\nname: review\ndescription: Code review guidelines and output format\n---\n\n# Code Review Skill\n\n{extracted guidelines from old review.md}\n\n## Output Format\n{any structured output requirements}\n```\n\n## Key content to preserve\n- Review process guidelines\n- What to look for (bugs, security, style)\n- Output format/structure expectations\n\n## What to remove\n- Identity prompts ('You are a code reviewer...')\n- Persona language\n- Redundant instructions covered by task context\n\n## DoD\n- review skill exists at correct path\n- loadSkill('review', cwd) returns content\n- No persona language in skill content","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-16T16:08:24.985482274+01:00","updated_at":"2026-01-16T16:25:37.415559899+01:00","closed_at":"2026-01-16T16:25:37.415559899+01:00","close_reason":"Migrated review agent into review skill (plus planning/search skills)","dependencies":[{"issue_id":"tau-8od.10","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:24.986576165+01:00","created_by":"daemon"},{"issue_id":"tau-8od.10","depends_on_id":"tau-8od.8","type":"blocks","created_at":"2026-01-16T16:09:19.222513085+01:00","created_by":"daemon"}]}
{"id":"tau-8od.2","title":"Implement TaskRegistry: load built-in + user config","description":"Create TaskRegistry that manages task type definitions.\n\n## File: src/registry.ts\n\n## TaskType interface\n```typescript\ninterface TaskType {\n  name: string;\n  description: string;\n  tools?: string[];          // undefined = all tools\n  defaultModel?: string;     // 'inherit' or canonical ID\n  defaultThinking?: ThinkingLevel;\n  difficulty?: {\n    small?: { model?: string; thinking?: ThinkingLevel };\n    medium?: { model?: string; thinking?: ThinkingLevel };\n    large?: { model?: string; thinking?: ThinkingLevel };\n  };\n  skills?: string[];         // default skills to inject\n}\n```\n\n## Built-in task types\n- code: All tools, inherit model\n- search: read/ls/find/grep only\n- review: read-only + bash, skills: ['review']\n- planning: read-only tools\n- general: All tools, accepts skills param from caller\n\n## Config loading\n- Load from ~/.pi/agent/settings.json under 'tasks' key\n- Load from .pi/settings.json (project-local, higher priority)\n- Merge with built-ins: user config overrides built-in defaults\n\n## API\n- TaskRegistry.get(taskType): TaskType | undefined\n- TaskRegistry.resolve(taskType, difficulty): ResolvedPolicy\n- TaskRegistry.list(): TaskType[]\n\n## DoD\n- Built-in task types available without config\n- User config overrides work\n- Difficulty resolution returns correct model/thinking","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:49.472725849+01:00","updated_at":"2026-01-16T16:25:37.290224987+01:00","closed_at":"2026-01-16T16:25:37.290224987+01:00","close_reason":"Implemented TaskRegistry with config overrides and difficulty resolution","dependencies":[{"issue_id":"tau-8od.2","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:49.473861189+01:00","created_by":"daemon"},{"issue_id":"tau-8od.2","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:37.461313153+01:00","created_by":"daemon"}]}
{"id":"tau-8od.3","title":"Implement SkillLoader: load skills from disk","description":"Create SkillLoader that finds and loads skill content.\n\n## File: src/skills.ts\n\n## LoadedSkill interface\n```typescript\ninterface LoadedSkill {\n  name: string;\n  path: string;\n  contents: string;\n}\n```\n\n## Search paths (in order of priority)\n1. .pi/skills/{name}/SKILL.md (project-local)\n2. .pi/skills/{name}.md\n3. ~/.pi/agent/skills/{name}/SKILL.md (user)\n4. ~/.pi/agent/skills/{name}.md\n\n## API\n- loadSkill(name: string, cwd: string): LoadedSkill | null\n- loadSkills(names: string[], cwd: string): { loaded: LoadedSkill[], missing: string[] }\n\n## DoD\n- Can load beads skill from ~/.pi/agent/skills/beads/SKILL.md\n- Project-local skills take precedence\n- Returns null for missing skills without throwing","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:06:57.0292357+01:00","updated_at":"2026-01-16T16:25:37.306095795+01:00","closed_at":"2026-01-16T16:25:37.306095795+01:00","close_reason":"Implemented SkillLoader with project/user lookup","dependencies":[{"issue_id":"tau-8od.3","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:06:57.030363726+01:00","created_by":"daemon"},{"issue_id":"tau-8od.3","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:40.817028386+01:00","created_by":"daemon"}]}
{"id":"tau-8od.4","title":"Implement SessionManager: track active task sessions","description":"Create SessionManager for session continuation.\n\n## File: src/sessions.ts\n\n## TaskSession interface\n```typescript\ninterface TaskSession {\n  sessionId: string;\n  taskType: string;\n  difficulty: Difficulty;\n  process: ChildProcess;       // spawned pi process\n  createdAt: number;\n}\n```\n\n## In-memory storage\n- Map\u003csessionId, TaskSession\u003e\n- Sessions live for duration of parent pi process\n\n## API\n- getSession(sessionId): TaskSession | undefined\n- createSession(taskType, difficulty): TaskSession\n- hasSession(sessionId): boolean\n\n## Session ID generation\n- Use crypto.randomUUID() for new sessions\n- Accept existing sessionId for continuation\n\n## DoD\n- Can create new session and retrieve by ID\n- Can detect session_id mismatch (wrong task_type)\n- Sessions survive across multiple task tool calls","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:04.431335224+01:00","updated_at":"2026-01-16T16:25:37.322701746+01:00","closed_at":"2026-01-16T16:25:37.322701746+01:00","close_reason":"Implemented SessionManager for task session tracking","dependencies":[{"issue_id":"tau-8od.4","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:04.432434044+01:00","created_by":"daemon"},{"issue_id":"tau-8od.4","depends_on_id":"tau-8od.1","type":"blocks","created_at":"2026-01-16T16:08:43.678883381+01:00","created_by":"daemon"}]}
{"id":"tau-8od.5","title":"Implement TaskRunner: spawn and stream pi processes","description":"Create TaskRunner that spawns worker pi processes.\n\n## File: src/runner.ts\n\n## Core responsibilities\n1. Build worker system prompt (context, not persona)\n2. Spawn pi process with correct flags\n3. Stream JSON events back to parent\n4. Handle completion/error/interruption\n\n## Worker system prompt structure\n```\n# Task Execution Context\nYou are executing a delegated task from parent session: {parentSessionId}\n\n## Guidelines\n- Focus on the requested task\n- Use available tools as needed\n- If specific output format required, follow it exactly\n- Otherwise, summarize what you did and why\n\n{parallel_constraints if parallelCount \u003e 1}\n\n---\n\u003cskill name=\"{name}\" path=\"{path}\"\u003e\n{skill contents}\n\u003c/skill\u003e\n```\n\n## pi spawn arguments\n```bash\npi --mode json -p --no-session \\\n  --model {resolvedModel} \\\n  --thinking {resolvedThinking} \\\n  --tools {toolsList} \\\n  --append-system-prompt {tempPromptFile} \\\n  \"Task: {userPrompt}\"\n```\n\n## Event processing\n- Parse NDJSON from stdout\n- Emit updates via onUpdate callback\n- Accumulate messages for final result\n- Track usage stats (tokens, cost)\n\n## TaskResult\n```typescript\ntype TaskOutput =\n  | { type: 'completed'; message: string }\n  | { type: 'completed_tool'; toolOutput: string }\n  | { type: 'completed_empty' }\n  | { type: 'interrupted'; resumable: true }\n  | { type: 'failed'; reason: string; resumable: boolean };\n\ninterface TaskResult {\n  output: TaskOutput;\n  sessionId: string;\n  usage: UsageStats;\n}\n```\n\n## DoD\n- Can spawn pi process and capture output\n- Streams progress to parent via onUpdate\n- Handles all termination cases (success, error, abort)\n- Cleans up temp files on completion","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:27.836925606+01:00","updated_at":"2026-01-16T16:25:37.339045836+01:00","closed_at":"2026-01-16T16:25:37.339045836+01:00","close_reason":"Implemented TaskRunner to spawn pi workers and stream NDJSON","dependencies":[{"issue_id":"tau-8od.5","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:27.83802133+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.2","type":"blocks","created_at":"2026-01-16T16:08:46.773656622+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.3","type":"blocks","created_at":"2026-01-16T16:08:50.37576493+01:00","created_by":"daemon"},{"issue_id":"tau-8od.5","depends_on_id":"tau-8od.4","type":"blocks","created_at":"2026-01-16T16:08:53.269641373+01:00","created_by":"daemon"}]}
{"id":"tau-8od.6","title":"Register task tool with pi.registerTool()","description":"Register the task tool that LLM can call.\n\n## File: src/index.ts (main extension)\n\n## Tool schema\n```typescript\nconst TaskParams = Type.Object({\n  task_type: Type.String({\n    description: 'Type of work: code, search, review, planning, general'\n  }),\n  description: Type.String({\n    description: 'Short description of the task (for logging/UI)'\n  }),\n  prompt: Type.String({\n    description: 'The full prompt for the worker'\n  }),\n  difficulty: Type.Optional(StringEnum(['small', 'medium', 'large'] as const, {\n    description: 'Task complexity. small=trivial, medium=standard (default), large=complex',\n  })),\n  session_id: Type.Optional(Type.String({\n    description: 'Continue an existing task session instead of starting new',\n  })),\n  skills: Type.Optional(Type.Array(Type.String(), {\n    description: 'Skills to inject (only valid for task_type=general)',\n  })),\n});\n```\n\n## Tool registration\n```typescript\npi.registerTool({\n  name: 'task',\n  label: 'Task',\n  description: buildToolDescription(registry),\n  parameters: TaskParams,\n  execute: async (toolCallId, params, onUpdate, ctx, signal) =\u003e { ... },\n  renderCall: (args, theme) =\u003e { ... },\n  renderResult: (result, options, theme) =\u003e { ... },\n});\n```\n\n## Description generation\n- List available task types with descriptions\n- Show difficulty options\n- Explain session_id continuation\n- Explain skills parameter (general only)\n\n## Execute flow\n1. Validate task_type exists\n2. Validate skills param only for general\n3. Resolve policy from registry + difficulty\n4. Load skills\n5. Get or create session\n6. Run task via TaskRunner\n7. Return result with session_id\n\n## DoD\n- Tool appears in pi's tool list\n- LLM can call task tool successfully\n- Invalid task_type returns helpful error\n- skills validation works for general only","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T16:07:42.094950135+01:00","updated_at":"2026-01-16T16:25:37.354560444+01:00","closed_at":"2026-01-16T16:25:37.354560444+01:00","close_reason":"Registered task tool and wired registry/skills/sessions/runner","dependencies":[{"issue_id":"tau-8od.6","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:42.096485339+01:00","created_by":"daemon"},{"issue_id":"tau-8od.6","depends_on_id":"tau-8od.5","type":"blocks","created_at":"2026-01-16T16:08:56.127457658+01:00","created_by":"daemon"}]}
{"id":"tau-8od.7","title":"Implement custom TUI rendering for task results","description":"Add custom renderCall and renderResult for nice TUI display.\n\n## File: src/render.ts\n\n## renderCall display\nShow task being delegated:\n```\n• task review:medium\n  └ \"Review changes in src/foo.rs\"\n```\n\n## renderResult display (collapsed)\n```\n✓ task review:medium (session: abc-123)\n  └ 3 turns ↑1.2k ↓800 $0.0042 anthropic/claude-sonnet-4\n  └ Found 2 issues: missing error handling, unused import\n```\n\n## renderResult display (expanded)\nShow full message content with markdown rendering.\n\n## Streaming display (isPartial)\n```\n⏳ task review:medium (running...)\n  └ read src/foo.rs\n  └ grep \"error\" ./\n  └ ...\n```\n\n## Status indicators\n- ⏳ Running (blinking dot like current subagent)\n- ✓ Completed (green)\n- ✗ Failed (red)\n- ⚠ Interrupted (yellow)\n\n## DoD\n- renderCall shows task_type:difficulty and description\n- renderResult shows completion status and summary\n- Streaming updates show tool calls as they happen\n- Expanded view shows full output with markdown","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:07:53.736798049+01:00","updated_at":"2026-01-16T16:25:37.369850361+01:00","closed_at":"2026-01-16T16:25:37.369850361+01:00","close_reason":"Added custom TUI rendering for task call/result","dependencies":[{"issue_id":"tau-8od.7","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:07:53.737869336+01:00","created_by":"daemon"},{"issue_id":"tau-8od.7","depends_on_id":"tau-8od.6","type":"blocks","created_at":"2026-01-16T16:08:59.301271905+01:00","created_by":"daemon"}]}
{"id":"tau-8od.8","title":"Remove old subagent extension from ~/.pi","description":"Clean up the old persona-based subagent extension.\n\n## Files to remove\n```\n~/.pi/agent/extensions/subagent/\n├── agents.ts      # DELETE\n├── index.ts       # DELETE\n├── README.md      # DELETE\n├── agents/        # DELETE entire directory\n└── prompts/       # DELETE entire directory\n```\n\n## Files to keep (migrate if useful)\n- agents/*.md content → Consider migrating to skills if valuable\n  - review.md → ~/.pi/agent/skills/review/SKILL.md (if not already exists)\n  - Other agents: evaluate if content is useful as skills\n\n## Verification\n- pi starts without subagent tool\n- No errors about missing extension\n- task tool works as replacement\n\n## DoD\n- ~/.pi/agent/extensions/subagent/ directory removed\n- Old 'subagent' tool no longer available\n- Any useful agent content migrated to skills","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:08:02.524474729+01:00","updated_at":"2026-01-16T16:25:37.384867919+01:00","closed_at":"2026-01-16T16:25:37.384867919+01:00","close_reason":"Removed old subagent extension and installed task extension symlink","dependencies":[{"issue_id":"tau-8od.8","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:02.525545826+01:00","created_by":"daemon"},{"issue_id":"tau-8od.8","depends_on_id":"tau-8od.6","type":"blocks","created_at":"2026-01-16T16:09:02.33018006+01:00","created_by":"daemon"}]}
{"id":"tau-8od.9","title":"Add parallel worker detection and constraints","description":"Detect when multiple task calls are in same parent turn.\n\n## Purpose\nWhen LLM calls task() multiple times in parallel, inject constraints to prevent conflicts.\n\n## Detection\n- Track task tool invocations per parent turn\n- Count concurrent workers spawned\n\n## Parallel constraints prompt (injected when parallelCount \u003e 1)\n```\n## Parallel Execution ({parallelCount} workers)\nThis parent spawned {parallelCount} task sessions in parallel.\n- Assume other workers may be editing the repo at the same time.\n- Avoid editing the same files or shared contracts unless explicitly required.\n- Keep changes narrowly scoped to your assigned area.\n- If you detect overlap or a dependency on another worker, stop and report it.\n```\n\n## Implementation\n- Use atomic counter per turn context\n- Increment on each task tool call\n- Finalize count before spawning any workers\n- Inject constraints if count \u003e 1\n\n## DoD\n- Single task call: no parallel constraints injected\n- Multiple parallel calls: all workers see constraint prompt\n- Count is accurate even with concurrent calls","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:08:16.179324624+01:00","updated_at":"2026-01-16T16:25:37.400336488+01:00","closed_at":"2026-01-16T16:25:37.400336488+01:00","close_reason":"Added parallel worker detection and constraint prompt injection","dependencies":[{"issue_id":"tau-8od.9","depends_on_id":"tau-8od","type":"parent-child","created_at":"2026-01-16T16:08:16.180459102+01:00","created_by":"daemon"},{"issue_id":"tau-8od.9","depends_on_id":"tau-8od.5","type":"blocks","created_at":"2026-01-16T16:09:16.30511082+01:00","created_by":"daemon"}]}
{"id":"tau-8oj","title":"Error when task type config references non-existent tools","description":"Currently, if a task type config specifies tools that don't exist (e.g. tools: [\"read\", \"nonexistent_tool\"]), the non-existent tools are silently ignored.\n\nThis is a bug because:\n1. User expects the tools they configure to be available\n2. Typos in tool names go unnoticed (e.g. \"grepp\" instead of \"grep\")\n3. Makes debugging config issues difficult\n\nExpected behavior:\n- On TaskRegistry.load(), validate that all tools in task type configs exist\n- Produce clear error or warning listing unknown tools\n- Either fail fast or log warning at startup\n\nAffected code:\n- extensions/task/src/registry.ts - normalizeTaskType() or load()\n- Need access to list of available tools to validate against","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:27:39.197777683+01:00","updated_at":"2026-01-17T02:38:37.748384336+01:00","closed_at":"2026-01-17T02:38:37.748384336+01:00","close_reason":"Validate task tool configs and error on unknown tool names."}
{"id":"tau-8w6","title":"agent: spawned agent not found on wait","description":"Spawned agent with id returned, but wait immediately returns 'Not found' status. Agent disappears between spawn and wait.","status":"closed","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T16:55:02.136369424+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T16:57:41.210422656+01:00","closed_at":"2026-01-26T16:57:41.210422656+01:00","close_reason":"Fixed with ManagedRuntime to persist state across tool calls"}
{"id":"tau-8wx","title":"DemoGraph: Beads renderer demo","description":"Synthetic issue graph to test the beads tool rendering (statuses + deps).","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-16T00:49:49.880630432+01:00","updated_at":"2026-01-16T00:49:49.880630432+01:00","labels":["demo-render"]}
{"id":"tau-8wx.1","title":"DemoGraph: Base renderer","description":"A completed task to show ✔ rendering.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.903399709+01:00","updated_at":"2026-01-16T00:49:49.990045144+01:00","closed_at":"2026-01-16T00:49:49.990045144+01:00","close_reason":"Demo complete","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.1","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.904387717+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.2","title":"DemoGraph: Blocking dependency","description":"Blocks other tasks to demonstrate blocked/ready lists.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-16T00:49:49.918227786+01:00","updated_at":"2026-01-16T00:49:49.918227786+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.2","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.918495047+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.3","title":"DemoGraph: Dep tree directions","description":"This task is blocked by another task.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.931698812+01:00","updated_at":"2026-01-16T00:49:49.931698812+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.3","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.931971723+01:00","created_by":"daemon"},{"issue_id":"tau-8wx.3","depends_on_id":"tau-8wx.2","type":"blocks","created_at":"2026-01-16T00:49:49.932425851+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.4","title":"DemoGraph: Polish output style","description":"In-progress task to show status variance.","status":"in_progress","priority":3,"issue_type":"task","created_at":"2026-01-16T00:49:49.961301754+01:00","updated_at":"2026-01-16T00:49:50.002032384+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.4","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.961563223+01:00","created_by":"daemon"}]}
{"id":"tau-8wx.5","title":"DemoGraph: Release checklist","description":"Blocked by an open bug.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-16T00:49:49.97631254+01:00","updated_at":"2026-01-16T00:49:49.97631254+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-8wx.5","depends_on_id":"tau-8wx","type":"parent-child","created_at":"2026-01-16T00:49:49.976633223+01:00","created_by":"daemon"},{"issue_id":"tau-8wx.5","depends_on_id":"tau-tgp","type":"blocks","created_at":"2026-01-16T00:49:49.977205606+01:00","created_by":"daemon"}]}
{"id":"tau-90x","title":"exa extension: improve tool schemas and rendering","description":"Update extensions/exa to match exa.* tool schemas (web_search_exa/crawling_exa/get_code_context_exa) and add rich TUI rendering.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:28:44.485293555+01:00","updated_at":"2026-01-16T16:31:37.769755395+01:00","closed_at":"2026-01-16T16:31:37.769755395+01:00","close_reason":"Updated exa extension tool schemas and added custom rendering"}
{"id":"tau-99b","title":"Another dummy","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-23T02:05:55.766672752+01:00","updated_at":"2026-01-23T02:06:03.784686357+01:00","deleted_at":"2026-01-23T02:06:03.784686357+01:00","deleted_by":"ribelo","delete_reason":"manual delete","original_type":"task"}
{"id":"tau-9h5","title":"Add default result_schema to TaskType config","description":"Allow task types to specify a default result_schema in settings.json.\n\nUse case: The review task type should always return structured JSON output (findings, overall_correctness, etc.) without requiring the caller to specify result_schema every time.\n\nChanges needed:\n- Add result_schema field to TaskType interface\n- Merge with per-call result_schema (per-call overrides default)\n- Update normalization in registry.ts\n- Update task-type-creation skill with example","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-17T02:24:52.760021271+01:00","updated_at":"2026-01-17T02:24:52.760021271+01:00"}
{"id":"tau-9ka","title":"agent: worker sandbox not inheriting/clamping parent restrictions","description":"Worker agents bypass tau's sandbox enforcement entirely. Workers use createAgentSession() which doesn't load extensions. The sandbox config is computed and stored but not enforced. Proper fix requires either: (1) loading tau extension in workers, (2) providing sandboxed tool wrappers to workers, or (3) hooking into worker session tool execution. This is a security issue for production use.","status":"open","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T17:07:07.167187847+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:25:08.834802275+01:00"}
{"id":"tau-9kr","title":"Epic: tau hardening (typescript strict, ban any)","description":"Goal: make `extensions/tau` TypeScript safety feel like Rust: strict types, no `any`, and no silent unsafe casts.\n\nRules:\n- `any` is forbidden (including `as any` and `Record\u003cstring, any\u003e`).\n- The only allowed relaxation: unused locals/params should be warnings (not CI-breaking errors).\n\nNotes:\n- TS compiler cannot make unused vars warnings (tsc treats them as errors), so we will use linting to keep them as warnings while keeping typechecking strict.\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-18T22:15:48.585697827+01:00","updated_at":"2026-01-19T00:59:29.725787449+01:00","closed_at":"2026-01-19T00:59:29.725787449+01:00","close_reason":"Done: removed almost all any/as any from extensions/tau, added eslint with strict rules (no-explicit-any error), and added typecheck script. All any types are gone."}
{"id":"tau-9kr.1","title":"tsconfig + agents: strict baseline (noImplicitAny etc)","description":"Implement baseline strict TS config for `extensions/tau` and codify rules in `AGENTS.md`.\n\nChanges:\n- Add `extensions/tau/tsconfig.json` with strict options (noEmit).\n- Update `AGENTS.md` with non-negotiable policy: no `any`.\n- Keep unused locals/params non-fatal (warnings via lint; do not enable tsc unused-as-error gating).\n\nDoD:\n- `extensions/tau/tsconfig.json` exists and is strict.\n- `AGENTS.md` includes tau hardening rules.\n- No behavior changes.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T22:16:06.801491451+01:00","updated_at":"2026-01-18T22:16:52.039826256+01:00","closed_at":"2026-01-18T22:16:52.039826256+01:00","close_reason":"Added strict extensions/tau tsconfig baseline and documented no-any policy in AGENTS.md","dependencies":[{"issue_id":"tau-9kr.1","depends_on_id":"tau-9kr","type":"parent-child","created_at":"2026-01-18T22:16:06.801984772+01:00","created_by":"ribelo"}]}
{"id":"tau-9kr.2","title":"lint: enforce no-explicit-any (error) + unused vars (warn)","description":"Add lint enforcement so explicit `any` is impossible to merge, while unused variables remain warnings.\n\nDoD:\n- Lint rule: explicit any is error.\n- Lint rule: unused locals/params are warnings.\n- Document how to run lint.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T22:16:11.878316365+01:00","updated_at":"2026-01-19T00:56:21.745390527+01:00","closed_at":"2026-01-19T00:56:21.745390527+01:00","close_reason":"Done: added eslint.config.js with no-explicit-any error and no-unused-vars warning. Lint now passes.","dependencies":[{"issue_id":"tau-9kr.2","depends_on_id":"tau-9kr","type":"parent-child","created_at":"2026-01-18T22:16:11.878740484+01:00","created_by":"ribelo"}]}
{"id":"tau-9kr.3","title":"cleanup: remove existing any/as any from extensions/tau","description":"Remove existing `any` and `as any` from `extensions/tau/src/**` (may require splitting by feature area: sandbox/task/beads).\n\nDoD:\n- `rg \"\\bany\\b\" extensions/tau/src` returns 0 (excluding comments/strings if needed).\n- No behavior change.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T22:16:16.952066441+01:00","updated_at":"2026-01-19T00:56:30.233632407+01:00","closed_at":"2026-01-19T00:56:30.233632407+01:00","close_reason":"Done: removed all any/as any usage from core src/ directory.","dependencies":[{"issue_id":"tau-9kr.3","depends_on_id":"tau-9kr","type":"parent-child","created_at":"2026-01-18T22:16:16.952460223+01:00","created_by":"ribelo"}]}
{"id":"tau-9kr.4","title":"ci/typecheck: add strict typecheck gate (noEmit)","description":"Add `typescript` + `@types/node` dev deps and a `typecheck` script (`tsc -p extensions/tau/tsconfig.json --noEmit`).\n\nImportant:\n- Do NOT fail builds on unused vars (keep warnings via lint).\n\nDoD:\n- `npm -C extensions/tau run typecheck` passes.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T22:16:22.030469332+01:00","updated_at":"2026-01-19T00:59:18.899607729+01:00","closed_at":"2026-01-19T00:59:18.899607729+01:00","close_reason":"Done: added typecheck script to package.json. Removed all any usage so tsc can now actually see and report real type issues.","dependencies":[{"issue_id":"tau-9kr.4","depends_on_id":"tau-9kr","type":"parent-child","created_at":"2026-01-18T22:16:22.03098673+01:00","created_by":"ribelo"}]}
{"id":"tau-bfu","title":"Refactor tau agents: replace skill injection with prompt.md definitions","description":"Port codex-rs subagent architecture to tau. Replace skill injection with self-contained .md files containing YAML frontmatter + system prompt (like codex oracle.md).\n\n## Goals\n- Remove skill injection from agent workers\n- Define agents via prompt.md files (YAML frontmatter + system prompt body)\n- Port all codex-rs agents: oracle, finder, librarian, painter, review, rush, general\n- Keep existing sandbox enforcement\n- Keep agents async\n\n## Non-goals\n- session_reader (internal codex tool, not needed)\n- allowed_subagents nesting control (defer)\n\n## Current state\n- Tau uses TaskType + skill injection via buildWorkerSystemPrompt()\n- Skills loaded from extensions/tau/skills/ or ~/.pi/agent/skills/\n- Codex uses .md files with frontmatter: name, description, model, reasoning_effort, sandbox_policy, approval_policy\n\n## Target state\n- Agent definitions in extensions/tau/agents/*.md (or similar)\n- Frontmatter parsed for metadata (sandbox, model, etc)\n- Body used as system prompt\n- TaskRegistry loads agent definitions from .md files","status":"open","priority":1,"issue_type":"epic","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:01.26296339+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:01.26296339+01:00"}
{"id":"tau-bfu.1","title":"Define AgentDefinition type and .md parser","description":"Create TypeScript types and parser for agent .md files.\n\n## Deliverables\n1. AgentDefinition interface with fields from codex frontmatter:\n   - name: string\n   - description: string  \n   - model?: string (inherit | explicit)\n   - thinking?: ThinkingLevel\n   - sandbox: SandboxConfig (filesystemMode, networkMode, approvalPolicy)\n   \n2. Parser function: parseAgentDefinition(content: string) -\u003e AgentDefinition\n   - Extract YAML frontmatter (--- delimited)\n   - Parse frontmatter as metadata\n   - Body after frontmatter is systemPrompt\n\n3. Loader function: loadAgentDefinition(name: string, cwd: string)\n   - Search paths: project .pi/agents/, user ~/.pi/agent/agents/, extension bundled\n   \n## Reference\n- Codex frontmatter: name, description, model, reasoning_effort, sandbox_policy, approval_policy, allowed_subagents\n- Tau sandbox config: filesystemMode, networkMode, approvalPolicy","status":"open","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:09.707103724+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:09.707103724+01:00","dependencies":[{"issue_id":"tau-bfu.1","depends_on_id":"tau-bfu","type":"parent-child","created_at":"2026-01-26T23:12:09.71925806+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-bfu.2","title":"Refactor AgentWorker to use AgentDefinition instead of skills","description":"Modify AgentWorker.make() and buildWorkerSystemPrompt() to use AgentDefinition.\n\n## Changes\n1. AgentWorker.make() accepts AgentDefinition instead of LoadedSkill[]\n2. buildWorkerSystemPrompt() uses definition.systemPrompt directly (no skill injection)\n3. Sandbox config comes from definition.sandbox (merged with parent clamp)\n4. Model/thinking from definition (with inherit fallback)\n\n## Remove\n- skills parameter from worker creation\n- skill loading in worker flow\n- buildWorkerSystemPrompt skill injection loop\n\n## Keep\n- Async worker execution\n- Status tracking (SubscriptionRef)\n- Structured output (submit_result tool)\n- Sandbox clamping logic","status":"open","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:22.003529639+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:22.003529639+01:00","dependencies":[{"issue_id":"tau-bfu.2","depends_on_id":"tau-bfu","type":"parent-child","created_at":"2026-01-26T23:12:22.004046984+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.2","depends_on_id":"tau-bfu.1","type":"blocks","created_at":"2026-01-26T23:12:22.004892594+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-bfu.3","title":"Update TaskRegistry to load agent definitions from .md files","description":"Refactor TaskRegistry to discover and load agent .md files.\n\n## Changes\n1. Add AgentRegistry class (or merge into TaskRegistry)\n2. Discover .md files from:\n   - extensions/tau/agents/*.md (bundled)\n   - ~/.pi/agent/agents/*.md (user)\n   - .pi/agents/*.md (project)\n3. builtins() returns agent names, loads definitions on demand\n4. resolve() loads full AgentDefinition\n\n## API\n- get(name: string): AgentDefinition | undefined\n- list(): AgentDefinition[]\n- resolve(name: string, complexity: Complexity): ResolvedPolicy (includes systemPrompt)","status":"open","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:28.400191878+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:28.400191878+01:00","dependencies":[{"issue_id":"tau-bfu.3","depends_on_id":"tau-bfu","type":"parent-child","created_at":"2026-01-26T23:12:28.400625093+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.3","depends_on_id":"tau-bfu.1","type":"blocks","created_at":"2026-01-26T23:12:28.40144756+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-bfu.4","title":"Port codex-rs agent definitions to tau","description":"Copy and adapt codex-rs subagent .md files to tau format.\n\n## Agents to port\nFrom /home/ribelo/projects/ribelo/codex/codex-rs/core/src/subagents/:\n\n1. **oracle.md** → agents/oracle.md\n   - Expert reasoning, planning, code review\n   - read-only sandbox\n   \n2. **finder.md** → agents/finder.md  \n   - Fast code search\n   - read-only sandbox\n   \n3. **general.md** → agents/general.md\n   - General-purpose task execution\n   - workspace-write sandbox\n   \n4. **librarian.md** → agents/librarian.md\n   - Deep multi-repo codebase analysis\n   - read-only sandbox\n   \n5. **painter.md** → agents/painter.md\n   - Frontend specialist\n   - workspace-write sandbox\n   \n6. **review.md** → agents/review.md\n   - Code review\n   - read-only sandbox\n   \n7. **rush.md** → agents/rush.md\n   - Fast/cheap for trivial tasks\n   - workspace-write sandbox\n\n## Adaptations needed\n- Update YAML frontmatter to match tau's SandboxConfig format\n- reasoning_effort → thinking\n- Keep system prompts mostly unchanged","status":"open","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:36.835055035+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:36.835055035+01:00","dependencies":[{"issue_id":"tau-bfu.4","depends_on_id":"tau-bfu","type":"parent-child","created_at":"2026-01-26T23:12:36.835490424+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.4","depends_on_id":"tau-bfu.1","type":"blocks","created_at":"2026-01-26T23:12:36.836331977+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-bfu.5","title":"Update agent tool to use agent names instead of task types + skills","description":"Update createWorkerAgentTool to spawn agents by name from AgentRegistry.\n\n## Changes\n1. Tool parameter: type → agent (references agent name from .md file)\n2. Remove skills parameter (no longer needed)\n3. Load AgentDefinition by name\n4. Pass definition to AgentWorker.make()\n\n## Tool schema update\nBefore:\n- type: task type (code, search, etc)\n- complexity: low/medium/high\n- skills: string[] (for custom task type)\n\nAfter:\n- agent: agent name (oracle, finder, rush, etc)\n- complexity: low/medium/high (model routing only)","status":"open","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:43.865416614+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:43.865416614+01:00","dependencies":[{"issue_id":"tau-bfu.5","depends_on_id":"tau-bfu","type":"parent-child","created_at":"2026-01-26T23:12:43.865836164+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.5","depends_on_id":"tau-bfu.2","type":"blocks","created_at":"2026-01-26T23:12:43.866648962+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.5","depends_on_id":"tau-bfu.3","type":"blocks","created_at":"2026-01-26T23:12:43.867393019+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-bfu.6","title":"Remove skill injection code and old skill files","description":"Clean up skill-related code after agent refactor is complete.\n\n## Remove\n1. src/agent/skills.ts (LoadedSkill, loadSkill, loadSkills)\n2. skills/ directory from extension (or repurpose for user-facing skills only)\n3. Skill references from TaskType interface\n4. Skill loading from TaskRegistry\n\n## Keep (if needed for other purposes)\n- User-facing skill loading for main agent (not workers)\n- ~/.pi/agent/skills/ discovery for main agent context\n\n## Verify\n- npm run gate passes\n- Agent spawning still works\n- No dead code","status":"open","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T23:12:51.109224896+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T23:12:51.109224896+01:00","dependencies":[{"issue_id":"tau-bfu.6","depends_on_id":"tau-bfu","type":"parent-child","created_at":"2026-01-26T23:12:51.109710611+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.6","depends_on_id":"tau-bfu.2","type":"blocks","created_at":"2026-01-26T23:12:51.110644039+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-bfu.6","depends_on_id":"tau-bfu.5","type":"blocks","created_at":"2026-01-26T23:12:51.111447179+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-bq3","title":"Rename task size to complexity","description":"Rename task size to complexity with low/medium/high values, update config schema, resolution fallback, and tool/skill docs. Make model exclusive with complexity.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T01:43:19.993083118+01:00","updated_at":"2026-01-17T01:46:47.044917942+01:00","closed_at":"2026-01-17T01:46:47.044917942+01:00","close_reason":"Renamed size to complexity with low/medium/high values, updated resolution fallback and docs."}
{"id":"tau-dck","title":"task: remove startup log and rely on pi reporting","description":"Remove the 'task extension loaded' session_start console.log from extensions/task. Add a requirement to AGENTS.md: extensions must not print startup banners/logging and should rely on pi's reporting/UI.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T16:38:22.929505157+01:00","updated_at":"2026-01-16T16:38:58.691700834+01:00","closed_at":"2026-01-16T16:38:58.691700834+01:00","close_reason":"Removed session_start console.log from task extension and documented no-startup-logging requirement in AGENTS.md","dependencies":[{"issue_id":"tau-dck","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T16:38:22.929946991+01:00","created_by":"daemon"}]}
{"id":"tau-dtk","title":"Skill resolution fallback: global path then extension-bundled","description":"Skills for builtin task types (code, search, review, planning) should be bundled with the task extension, not require users to install them globally.\n\nCurrent behavior:\n- Skills are discovered from global paths only (~/.pi/agent/skills/, ~/.codex/skills/, etc.)\n- Builtin task types reference skills (e.g. search type has skills: [\"search\"])\n- If user doesn't have these skills installed globally, they're missing\n\nExpected behavior:\n1. First check normal skill discovery path (user/global skills)\n2. If not found, fallback to extension-bundled skills (extensions/task/skills/)\n3. User skills override extension-bundled skills (allows customization)\n\nThis allows:\n- Task extension to ship with working default skills\n- Users to override with their own versions\n- No manual skill installation required for builtins\n\nBundled skills location: extensions/task/skills/\n- code/SKILL.md\n- search/SKILL.md\n- review/SKILL.md\n- planning/SKILL.md\n- task-delegation/SKILL.md\n- task-type-creation/SKILL.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:30:26.027018425+01:00","updated_at":"2026-01-17T02:38:37.789898229+01:00","closed_at":"2026-01-17T02:38:37.789898229+01:00","close_reason":"Added bundled skills and extension fallback for task types."}
{"id":"tau-fme","title":"sandbox: adjust permissions instructions (no tool list)","description":"Update first-turn \u003cpermissions instructions\u003e injection to avoid listing specific tools as sandboxed; instruct model to assume all tool calls are subject to sandbox restrictions and not attempt bypass.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T11:17:00.409271062+01:00","updated_at":"2026-01-18T11:17:47.598922962+01:00","closed_at":"2026-01-18T11:17:47.598922962+01:00","close_reason":"Updated first-turn \u003cpermissions instructions\u003e to avoid listing specific tools; instruct model to assume all tool calls are sandboxed and include mode semantics"}
{"id":"tau-fo6","title":"Enable nested task tool in worker sessions","description":"Initialize extension runtime for worker AgentSessions so nested task calls work (respect depth).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T02:05:09.521078863+01:00","updated_at":"2026-01-17T02:05:39.74193816+01:00","closed_at":"2026-01-17T02:05:39.74193816+01:00","close_reason":"Initialized extension runtime for worker sessions and added task-type-creation skill."}
{"id":"tau-fw1","title":"Fix empty Exa tool results for agent","description":"The Exa tools (web_search, crawl, code_context) were only returning JSON blocks, which resulted in empty output for the agent. Added text blocks to ensure results are visible to the LLM.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T20:03:19.998423931+01:00","updated_at":"2026-01-16T20:03:52.343830876+01:00","closed_at":"2026-01-16T20:03:52.343830876+01:00","close_reason":"Implemented text content blocks for all Exa tools."}
{"id":"tau-hmp","title":"Rewrite task delegation as non-blocking agent system","description":"Replace current blocking task-based delegation with codex-style non-blocking agent system.\n\n## Goal\nMatch codex's collab architecture (non-blocking spawn/send/wait/close) with tau's registry design (task types with skills/tools/models).\n\n## Key Changes\n- Single `agent` tool with actions: spawn, send, wait, close, list\n- Non-blocking: spawn returns immediately, explicit wait\n- Inter-agent communication via send (with optional interrupt)\n- Keep TaskRegistry for type→policy resolution\n- Keep skill injection, complexity routing, structured output\n\n## New API\n```typescript\nagent({\n  action: 'spawn' | 'send' | 'wait' | 'close' | 'list',\n  type?, message?, complexity?, skills?, result_schema?,  // spawn\n  id?, interrupt?,                                         // send/close\n  ids?, timeout_ms?                                        // wait\n})\n```\n\n## Config\n- max_threads: max concurrent agents (default from codex)\n- max_depth: 3 (nesting limit)\n- Task registry unchanged (code/search/review/planning/etc.)","status":"closed","priority":1,"issue_type":"epic","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:17:29.783907183+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:42.269337656+01:00","closed_at":"2026-01-26T15:02:42.269337656+01:00","close_reason":"Rewrite task delegation as non-blocking agent system complete"}
{"id":"tau-hmp.1","title":"Core types and status definitions","description":"Define core types for the agent system.\n\n## Deliverables\n- src/agent/types.ts: AgentId, Complexity, ResolvedPolicy\n- src/agent/status.ts: Status type, is_final(), status transitions\n\n## Types\n```typescript\ntype AgentId = string; // UUID\n\ntype Status =\n  | { state: 'pending' }\n  | { state: 'running' }\n  | { state: 'completed', message?: string, structured_output?: unknown }\n  | { state: 'failed', reason: string }\n  | { state: 'shutdown' };\n\ntype Complexity = 'low' | 'medium' | 'high';\n\ninterface ResolvedPolicy {\n  taskType: string;\n  complexity: Complexity;\n  model?: string;\n  thinking?: ThinkingLevel;\n  tools?: string[];\n  skills: string[];\n  sandbox?: SandboxConfig;\n}\n```\n\n## Acceptance Criteria\n- [ ] All types exported from src/agent/types.ts\n- [ ] is_final(status) returns true for completed/failed/shutdown\n- [ ] Status type matches codex AgentStatus semantics\n- [ ] No runtime dependencies (pure type definitions)","notes":"Must use Effect types. Status as branded type or Schema. is_final as pure function.","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:17:43.438974778+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.777708664+01:00","closed_at":"2026-01-26T15:02:26.777708664+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.1","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:17:43.439600583+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.1","depends_on_id":"tau-hmp.7","type":"blocks","created_at":"2026-01-26T14:20:21.733159964+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.10","title":"Update agent delegation skill documentation","description":"Update the task-delegation skill to reflect new agent API.\n\n## Deliverables\n- Update skills/task-delegation/SKILL.md → skills/agent/SKILL.md (or rename)\n\n## Content Updates\n- New API: single agent tool with actions\n- Non-blocking semantics explanation\n- spawn/send/wait/close/list examples\n- Inter-agent communication patterns\n- Remove batch task array syntax\n- Update coordination patterns for non-blocking\n\n## Example Patterns\n\n**Fan-out with explicit wait:**\n```typescript\n// Spawn workers\nagent({ action: 'spawn', type: 'search', message: 'Find auth files' })  // → id1\nagent({ action: 'spawn', type: 'search', message: 'Find API routes' })  // → id2\n// Do other work...\n// Wait for results\nagent({ action: 'wait', ids: [id1, id2] })\n```\n\n**Interactive refinement:**\n```typescript\nagent({ action: 'spawn', type: 'code', message: 'Draft the function' })  // → id\nagent({ action: 'wait', ids: [id] })  // Wait for draft\nagent({ action: 'send', id, message: 'Add error handling' })  // Refine\nagent({ action: 'wait', ids: [id] })  // Wait for update\nagent({ action: 'close', id })  // Cleanup\n```\n\n## Acceptance Criteria\n- [ ] All examples use new agent API\n- [ ] Non-blocking semantics clearly explained\n- [ ] spawn/send/wait/close/list all documented\n- [ ] Inter-agent communication documented\n- [ ] Old batch syntax removed\n- [ ] Skill name updated if renamed","status":"closed","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:21:47.28539003+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.791786793+01:00","closed_at":"2026-01-26T15:02:26.791786793+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.10","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:21:47.286056612+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.10","depends_on_id":"tau-hmp.8","type":"blocks","created_at":"2026-01-26T14:22:22.769900929+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.11","title":"Remove old task module after agent migration","description":"Remove the old task/ module after agent system is complete.\n\n## Files to Remove\n- src/task/index.ts\n- src/task/runner.ts\n- src/task/render.ts\n- src/task/sessions.ts\n- src/task/types.ts (if not reused)\n- src/task/approval-broker.ts (if not reused)\n- src/task/worker-sandbox.ts (if not reused)\n- src/task/sandbox-policy.ts (moved to agent/)\n- src/services/task.ts\n\n## Files to Keep/Migrate\n- src/task/registry.ts → src/agent/registry.ts\n- src/task/skills.ts → src/agent/skills.ts\n\n## Updates Required\n- Remove task tool registration from app.ts\n- Update any imports referencing task/\n- Remove task-related types from services\n\n## Acceptance Criteria\n- [ ] All task/ files removed or migrated\n- [ ] No dangling imports to task/\n- [ ] app.ts updated to use agent module\n- [ ] Build passes with no task references\n- [ ] Old 'task' tool no longer registered","status":"closed","priority":2,"issue_type":"chore","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:22:00.74868326+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.79248783+01:00","closed_at":"2026-01-26T15:02:26.79248783+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.11","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:22:00.749434775+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.11","depends_on_id":"tau-hmp.8","type":"blocks","created_at":"2026-01-26T14:22:27.862836959+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.11","depends_on_id":"tau-hmp.9","type":"blocks","created_at":"2026-01-26T14:22:32.953507094+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.11","depends_on_id":"tau-hmp.10","type":"blocks","created_at":"2026-01-26T14:22:38.040519576+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.2","title":"Migrate registry and skills to agent module","description":"Move TaskRegistry and skill loading from task/ to agent/ with minimal changes.\n\n## Deliverables\n- src/agent/registry.ts (from task/registry.ts)\n- src/agent/skills.ts (from task/skills.ts)\n\n## Changes\n- Update import paths\n- Keep all existing functionality\n- Registry resolves type + complexity → ResolvedPolicy\n\n## Acceptance Criteria\n- [ ] TaskRegistry.load() works unchanged\n- [ ] TaskRegistry.resolve(type, complexity) returns ResolvedPolicy\n- [ ] loadSkills() finds skills from all paths (project, user, extension)\n- [ ] Builtin task types preserved (code, search, review, planning, advisor, refactor, bash, custom)\n- [ ] User config overrides work\n- [ ] Complexity routing works (low/medium/high → different models)\n- [ ] No breaking changes to registry API","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:17:57.24037527+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.782751555+01:00","closed_at":"2026-01-26T15:02:26.782751555+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.2","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:17:57.241114251+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.2","depends_on_id":"tau-hmp.1","type":"blocks","created_at":"2026-01-26T14:20:26.834356023+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.3","title":"Implement AgentManager singleton","description":"Create AgentManager that holds all spawned agents.\n\n## Deliverables\n- src/agent/manager.ts\n\n## Design (matching codex ThreadManager)\n```typescript\nclass AgentManager {\n  private agents: Map\u003cAgentId, Agent\u003e;\n  private config: AgentConfig; // max_threads, max_depth\n\n  spawn(options: SpawnOptions): Promise\u003cAgentId\u003e;\n  get(id: AgentId): Agent | undefined;\n  remove(id: AgentId): Agent | undefined;\n  list(): AgentInfo[];\n  \n  // For AgentControl\n  getState(): AgentManagerState;\n}\n\ninterface AgentConfig {\n  maxThreads: number;  // default 4\n  maxDepth: number;    // default 3\n}\n```\n\n## Acceptance Criteria\n- [ ] Singleton instance per extension lifecycle\n- [ ] agents Map stores Agent by AgentId\n- [ ] spawn() creates agent, stores in map, returns ID\n- [ ] spawn() enforces maxThreads limit\n- [ ] spawn() tracks depth, enforces maxDepth\n- [ ] get() returns agent or undefined\n- [ ] remove() removes from map, releases thread slot\n- [ ] list() returns all agents with id/type/status\n- [ ] Config loaded from tau settings","notes":"Implement as Effect service with Context.Tag. Use Ref\u003cHashMap\u003cAgentId, Agent\u003e\u003e for state. Typed errors for limit/depth exceeded.","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:18:10.561997341+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.784393337+01:00","closed_at":"2026-01-26T15:02:26.784393337+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.3","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:18:10.562653524+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.3","depends_on_id":"tau-hmp.7","type":"blocks","created_at":"2026-01-26T14:20:31.926503646+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.4","title":"Implement AgentControl (control plane)","description":"Create AgentControl handle for agent operations (codex pattern).\n\n## Deliverables\n- src/agent/control.ts\n\n## Design (matching codex AgentControl)\n```typescript\nclass AgentControl {\n  // Weak ref to manager to avoid cycles\n  private manager: WeakRef\u003cAgentManagerState\u003e;\n\n  spawn(config, message, sessionSource?): Promise\u003cAgentId\u003e;\n  send(id, message, interrupt?): Promise\u003cstring\u003e;  // submission_id\n  interrupt(id): Promise\u003cvoid\u003e;\n  shutdown(id): Promise\u003cvoid\u003e;\n  getStatus(id): Promise\u003cStatus\u003e;\n  subscribeStatus(id): Observable\u003cStatus\u003e;\n  list(): AgentInfo[];\n}\n```\n\n## Acceptance Criteria\n- [ ] Weak reference pattern prevents memory cycles\n- [ ] spawn() delegates to manager, returns agent_id\n- [ ] send() queues message to agent, returns submission_id\n- [ ] send() with interrupt=true interrupts current work first\n- [ ] interrupt() stops agent's current turn\n- [ ] shutdown() sends shutdown, removes from manager\n- [ ] getStatus() returns current status (NotFound if missing)\n- [ ] subscribeStatus() returns observable for status changes\n- [ ] list() returns all agents with status\n- [ ] Errors propagate correctly (AgentNotFound, ManagerDropped, etc.)","notes":"Effect service wrapping AgentManager. All methods return Effect with typed errors. WeakRef pattern may need adaptation for Effect.","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:18:23.999429292+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.785854715+01:00","closed_at":"2026-01-26T15:02:26.785854715+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.4","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:18:24.000074594+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.4","depends_on_id":"tau-hmp.3","type":"blocks","created_at":"2026-01-26T14:20:37.014919606+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.5","title":"Implement Agent worker class","description":"Create Agent class that wraps a pi AgentSession.\n\n## Deliverables\n- src/agent/worker.ts\n\n## Design\n```typescript\nclass Agent {\n  readonly id: AgentId;\n  readonly type: string;\n  readonly depth: number;\n  \n  private session: AgentSession;\n  private status$: BehaviorSubject\u003cStatus\u003e;\n  private structuredOutput?: unknown;\n\n  constructor(options: AgentOptions);\n  \n  prompt(message: string): Promise\u003cstring\u003e;  // submission_id\n  interrupt(): Promise\u003cvoid\u003e;\n  shutdown(): Promise\u003cvoid\u003e;\n  \n  get status(): Status;\n  subscribeStatus(): Observable\u003cStatus\u003e;\n}\n```\n\n## Key Behaviors\n- Wraps pi-coding-agent's createAgentSession\n- Status updates on session events (turn_start → running, turn_complete → completed, etc.)\n- Handles structured output via submit_result tool injection\n- tool_choice forced to 'any' when result_schema provided\n- Skills injected into system prompt\n\n## Acceptance Criteria\n- [ ] Creates AgentSession with resolved policy (model, tools, thinking)\n- [ ] Status observable emits on state changes\n- [ ] prompt() sends user message, returns submission_id\n- [ ] interrupt() aborts current streaming\n- [ ] shutdown() cleanly terminates session\n- [ ] Structured output captured when submit_result called\n- [ ] tool_choice='any' when result_schema provided\n- [ ] Skills injected into system prompt\n- [ ] Sandbox config clamped to parent's config\n- [ ] Depth tracked from parent","notes":"Agent as Effect-managed resource. Use SubscriptionRef\u003cStatus\u003e for reactive status. Scope for cleanup. Fiber for background execution.","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:18:39.217471461+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.787320782+01:00","closed_at":"2026-01-26T15:02:26.787320782+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.5","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:18:39.218022633+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.5","depends_on_id":"tau-hmp.2","type":"blocks","created_at":"2026-01-26T14:20:42.108050782+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.5","depends_on_id":"tau-hmp.3","type":"blocks","created_at":"2026-01-26T14:20:47.195787059+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.6","title":"Implement wait mechanism","description":"Implement wait action that blocks until agents reach final state.\n\n## Deliverables\n- src/agent/wait.ts (or integrate into control.ts)\n\n## Design (matching codex wait handler)\n```typescript\nasync function wait(options: {\n  control: AgentControl;\n  ids: AgentId[];\n  timeoutMs: number;  // default 30_000, max 300_000\n  signal?: AbortSignal;\n}): Promise\u003cWaitResult\u003e;\n\ninterface WaitResult {\n  status: Record\u003cAgentId, Status\u003e;\n  timedOut: boolean;\n}\n```\n\n## Behavior\n1. Subscribe to status for all ids\n2. If any already final → return immediately with those\n3. Otherwise wait until first reaches final OR timeout\n4. Return status map + timed_out flag\n\n## Acceptance Criteria\n- [ ] Returns immediately if any agent already in final state\n- [ ] Waits for first agent to reach final state\n- [ ] Respects timeout (default 30s, max 300s)\n- [ ] timedOut=true if no agent finished before timeout\n- [ ] Status map includes all requested ids\n- [ ] Missing agents return status 'not_found' (or error)\n- [ ] Handles concurrent status changes correctly\n- [ ] Cleans up subscriptions on completion/timeout\n- [ ] Respects abort signal","notes":"Use Effect.race or Deferred for timeout. Stream from SubscriptionRef for status changes. Effect.interrupt for abort.","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:18:52.812651059+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.78865604+01:00","closed_at":"2026-01-26T15:02:26.78865604+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.6","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:18:52.813410319+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.6","depends_on_id":"tau-hmp.4","type":"blocks","created_at":"2026-01-26T14:20:52.286003855+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.6","depends_on_id":"tau-hmp.5","type":"blocks","created_at":"2026-01-26T14:20:57.380891492+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.7","title":"Define Effect services architecture for agent system","description":"Design and implement the Effect service layer for the agent system.\n\n## Pattern (matching existing tau services)\n```typescript\n// Service tag\nexport class AgentManager extends Context.Tag('AgentManager')\u003c\n  AgentManager,\n  {\n    readonly spawn: (opts: SpawnOptions) =\u003e Effect.Effect\u003cAgentId, AgentError\u003e;\n    readonly get: (id: AgentId) =\u003e Effect.Effect\u003cAgent, AgentNotFound\u003e;\n    readonly list: Effect.Effect\u003cAgentInfo[]\u003e;\n    readonly shutdown: (id: AgentId) =\u003e Effect.Effect\u003cvoid, AgentNotFound\u003e;\n  }\n\u003e() {}\n\n// Live implementation\nexport const AgentManagerLive = Layer.effect(\n  AgentManager,\n  Effect.gen(function* () {\n    const pi = yield* PiAPI;\n    const config = yield* AgentConfig;\n    const agents = yield* Ref.make(HashMap.empty\u003cAgentId, Agent\u003e());\n    // ...\n  })\n);\n```\n\n## Services to Define\n- AgentConfig: max_threads, max_depth from settings\n- AgentManager: spawn/get/list/remove agents\n- AgentControl: spawn/send/wait/close/list operations\n- Agent: individual worker state and operations\n\n## Error Types\n```typescript\nclass AgentNotFound extends Data.TaggedError('AgentNotFound')\u003c{ id: AgentId }\u003e {}\nclass AgentLimitReached extends Data.TaggedError('AgentLimitReached')\u003c{ max: number }\u003e {}\nclass AgentDepthExceeded extends Data.TaggedError('AgentDepthExceeded')\u003c{ max: number }\u003e {}\nclass AgentAlreadyShutdown extends Data.TaggedError('AgentAlreadyShutdown')\u003c{ id: AgentId }\u003e {}\n```\n\n## State Management\n- Use Ref/SubscriptionRef for agent map\n- Use SubscriptionRef for agent status (reactive)\n- Proper cleanup with Scope\n\n## Acceptance Criteria\n- [ ] All services defined with Context.Tag pattern\n- [ ] Typed errors using Data.TaggedError\n- [ ] SubscriptionRef for reactive status updates\n- [ ] Layer composition for dependency injection\n- [ ] No any types anywhere\n- [ ] Proper resource cleanup with Scope/finalizers\n- [ ] Effect.gen for all effectful code\n- [ ] Match existing tau service patterns","status":"closed","priority":0,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:19:29.232175162+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.789603447+01:00","closed_at":"2026-01-26T15:02:26.789603447+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.7","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:19:29.233012832+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.8","title":"Implement agent tool registration and action dispatch","description":"Register the agent tool and dispatch actions.\n\n## Deliverables\n- src/agent/index.ts (tool entry point)\n- src/agent/actions.ts (action handlers)\n\n## Tool Schema\n```typescript\nconst AgentParams = Type.Object({\n  action: StringEnum(['spawn', 'send', 'wait', 'close', 'list']),\n  // spawn\n  type: Type.Optional(Type.String()),\n  message: Type.Optional(Type.String()),\n  complexity: Type.Optional(StringEnum(['low', 'medium', 'high'])),\n  skills: Type.Optional(Type.Array(Type.String())),\n  result_schema: Type.Optional(Type.Any()),\n  // send/close\n  id: Type.Optional(Type.String()),\n  interrupt: Type.Optional(Type.Boolean()),\n  // wait\n  ids: Type.Optional(Type.Array(Type.String())),\n  timeout_ms: Type.Optional(Type.Number()),\n});\n```\n\n## Action Dispatch\nEach action validates required params and delegates to AgentControl:\n- spawn → control.spawn()\n- send → control.send()\n- wait → wait()\n- close → control.shutdown()\n- list → control.list()\n\n## Acceptance Criteria\n- [ ] Tool registered with pi.registerTool()\n- [ ] Action dispatch validates required params per action\n- [ ] spawn requires: type, message\n- [ ] send requires: id, message\n- [ ] wait requires: ids (non-empty)\n- [ ] close requires: id\n- [ ] list requires: nothing\n- [ ] Errors returned as isError: true with clear message\n- [ ] Effect errors mapped to tool errors\n- [ ] Layer provided/run at tool execute time","notes":"Bridge between pi tool API and Effect services. Effect.runPromise at boundary.","status":"closed","priority":1,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:21:14.895928242+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.790426117+01:00","closed_at":"2026-01-26T15:02:26.790426117+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.8","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:21:14.896547665+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.8","depends_on_id":"tau-hmp.6","type":"blocks","created_at":"2026-01-26T14:22:12.588858729+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-hmp.9","title":"Implement TUI rendering for agent tool","description":"Create renderCall and renderResult for the agent tool.\n\n## Deliverables\n- src/agent/render.ts\n\n## Render Requirements\n\n### renderCall\nMinimal - hide like current task tool (return empty Text)\n\n### renderResult\nShow based on action:\n\n**spawn:**\n```\n✔ agent spawn code:medium → abc-123\n```\n\n**send:**\n```\n✔ agent send abc-123 (submission: sub-456)\n```\n\n**wait:**\n```\n✔ agent wait (2 agents)\n  abc-123: completed - \"Done implementing feature\"\n  def-456: running\n```\n\n**close:**\n```\n✔ agent close abc-123 → shutdown\n```\n\n**list:**\n```\n✔ agent list (3 agents)\n  abc-123 code:medium    running\n  def-456 search:low     completed\n  ghi-789 review:high    pending\n```\n\n## Acceptance Criteria\n- [ ] renderCall returns minimal/empty output\n- [ ] renderResult shows action-appropriate summary\n- [ ] Status shown with color (success=green, error=red, running=yellow)\n- [ ] Structured output shown truncated in wait result\n- [ ] Expanded view shows full details\n- [ ] Matches existing tau render patterns","notes":"Simpler than current task/render.ts - no batch complexity.","status":"closed","priority":2,"issue_type":"task","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T14:21:31.128192422+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T15:02:26.791113799+01:00","closed_at":"2026-01-26T15:02:26.791113799+01:00","close_reason":"Implemented and migrated non-blocking agent system","dependencies":[{"issue_id":"tau-hmp.9","depends_on_id":"tau-hmp","type":"parent-child","created_at":"2026-01-26T14:21:31.128800994+01:00","created_by":"Rafał Krzyważnia"},{"issue_id":"tau-hmp.9","depends_on_id":"tau-hmp.8","type":"blocks","created_at":"2026-01-26T14:22:17.677405122+01:00","created_by":"Rafał Krzyważnia"}]}
{"id":"tau-i3c","title":"Consolidate tau extensions into single vertical-slice architecture","description":"Refactor tau from 8 separate pi extensions into a single unified extension with vertical-slice architecture.\n\n## Current State\n- 8 separate extensions: beads, editor-hub, exa, sandbox, skill-marker, task, tau (misc)\n- Each with own package.json and pi.extensions entry\n- editor-hub is a workaround for cross-extension editor coordination\n- Extensions can't easily share state or call each other\n\n## Target State\n- Single extensions/tau/ with vertical-slice folder structure\n- Each feature in its own folder with index.ts (Rust mod.rs pattern)\n- Shared state in shared/ folder\n- Single TauEditor with all customizations baked in\n- No runtime plugin registry - compile-time composition\n\n## Structure\n```\nextensions/tau/src/\n├── index.ts           # only file in root\n├── shared/            # state.ts, config.ts\n├── editor/            # TauEditor\n├── beads/\n├── exa/\n├── skill-marker/\n├── terminal-prompt/\n├── worked-for/\n├── status/\n├── commit/\n├── sandbox/\n└── task/\n```\n\n## Dependencies to merge\n- ajv, ajv-formats (from task)\n- @anthropic-ai/sandbox-runtime (from sandbox)\n\n## DoD\n- Single tau extension in extensions/tau/\n- All features working as before\n- Old extension folders deleted\n- install-extensions.sh updated\n- Tool names unchanged (bd, bash, edit, write, task, web_search_exa, etc.)","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-17T19:46:42.336935846+01:00","updated_at":"2026-01-18T14:31:36.927402592+01:00","closed_at":"2026-01-18T14:31:36.927402592+01:00","close_reason":"Completed consolidation into single extensions/tau with vertical-slice structure; removed legacy extensions and updated installer"}
{"id":"tau-i3c.1","title":"Create scaffolding: package.json, index.ts, shared/","description":"Create the new tau extension structure with scaffolding files.\n\n## Files to create\n\n### extensions/tau/package.json\n- Merge dependencies from task (ajv, ajv-formats) and sandbox (@anthropic-ai/sandbox-runtime)\n- Single pi.extensions entry pointing to ./src/index.ts\n\n### extensions/tau/src/index.ts\n- Import all feature init functions\n- Create shared state\n- Wire up session_start for TauEditor\n- Skeleton with TODO comments for each feature\n\n### extensions/tau/src/shared/index.ts\n- Re-export from state.ts and config.ts\n\n### extensions/tau/src/shared/state.ts\n- TauState type definition\n- createState() function\n- Placeholder sections for each feature's state\n\n### extensions/tau/src/shared/config.ts\n- TauConfig type for pi settings.json\n- Single 'tau' key namespace\n\n## DoD\n- npm install works in extensions/tau/\n- pi can load the extension (empty but no errors)\n- Folder structure matches agreed design","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:09.023625002+01:00","updated_at":"2026-01-18T13:29:17.244767084+01:00","closed_at":"2026-01-18T13:29:17.244767084+01:00","close_reason":"Created tau extension scaffolding (single entrypoint + shared state/config) and verified npm install","dependencies":[{"issue_id":"tau-i3c.1","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:09.024167278+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.10","title":"Migrate status/ feature","description":"Move status to tau/src/status/\n\n## Source\n- extensions/tau/src/status.ts\n\n## Target\n- extensions/tau/src/status/index.ts\n\n## Changes\n- Export initStatus(pi, state) function\n- Keep /status command\n- Keep StatusCard rendering\n- Can access sandbox config via state (for future enhancement)\n\n## DoD\n- /status command shows OpenAI, Gemini CLI, Antigravity quotas\n- StatusCard renders correctly\n- Burn rate calculations work","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:59.298453304+01:00","updated_at":"2026-01-18T13:36:53.853496181+01:00","closed_at":"2026-01-18T13:36:53.853496181+01:00","close_reason":"Moved status into vertical slice (initStatus(pi, state))","dependencies":[{"issue_id":"tau-i3c.10","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:59.298871714+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.10","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:51:03.300204095+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.11","title":"Migrate commit/ feature","description":"Move commit to tau/src/commit/\n\n## Source\n- extensions/tau/src/commit.ts\n\n## Target\n- extensions/tau/src/commit/index.ts\n\n## Changes\n- Export initCommit(pi, state) function\n- Keep tool name 'git_commit_with_user_approval'\n- Keep custom renderers\n\n## DoD\n- git_commit_with_user_approval tool works\n- User can edit commit message\n- Renders correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:09.054401024+01:00","updated_at":"2026-01-18T13:36:58.928159112+01:00","closed_at":"2026-01-18T13:36:58.928159112+01:00","close_reason":"Moved commit into vertical slice (initCommit(pi, state)); kept tool name and renderers","dependencies":[{"issue_id":"tau-i3c.11","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:09.054818652+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.11","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:51:08.37349453+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.12","title":"Unify state persistence to tau:state","description":"Consolidate all feature state into single tau:state entry type.\n\n## Current state types (to merge)\n- tau-state (terminal-prompt)\n- tau:worked-for-state\n- tau:status-state  \n- sandbox_state\n\n## Target\n- Single 'tau:state' custom entry type\n- All features read/write to unified state object\n\n## Implementation\n- Update state.ts with persistence helpers\n- Each feature uses state.persist() to save\n- On session_start, load and distribute to features\n\n## Backward compatibility\n- Migration: read old state types on first load\n- Write only new format going forward\n\n## DoD\n- All state persists correctly\n- Session resume works\n- Old sessions migrate cleanly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:21.715485517+01:00","updated_at":"2026-01-18T13:47:41.250691559+01:00","closed_at":"2026-01-18T13:47:41.250691559+01:00","close_reason":"Added unified tau:state persisted object + migration from legacy state types; updated terminal-prompt/worked-for/status/sandbox to read/write via tau:state","dependencies":[{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:21.715918454+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.2","type":"blocks","created_at":"2026-01-17T19:51:33.117564366+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.3","type":"blocks","created_at":"2026-01-17T19:51:38.191581677+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.4","type":"blocks","created_at":"2026-01-17T19:51:43.274348607+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.5","type":"blocks","created_at":"2026-01-17T19:51:48.353267429+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.6","type":"blocks","created_at":"2026-01-17T19:51:53.431271639+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.9","type":"blocks","created_at":"2026-01-17T19:51:58.508372286+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.10","type":"blocks","created_at":"2026-01-17T19:52:03.588532023+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.11","type":"blocks","created_at":"2026-01-17T19:52:08.667950699+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.12","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:26:36.63683515+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.13","title":"Delete old extensions and update install script","description":"Clean up old extension folders and update deployment.\n\n## Delete\n- extensions/beads/\n- extensions/editor-hub/\n- extensions/exa/\n- extensions/sandbox/\n- extensions/skill-marker/\n- extensions/task/\n\n## Keep (but now has new structure)\n- extensions/tau/\n\n## Update scripts/pi/install-extensions.sh\n- Remove: beads, exa, task, editor-hub, sandbox, skill-marker from EXTS array\n- Keep only: tau\n\n## Update AGENTS.md\n- Remove references to separate extensions\n- Update any paths\n\n## DoD\n- Only extensions/tau/ exists\n- install-extensions.sh only installs tau\n- No broken symlinks in ~/.pi/agent/extensions/","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:35.045442391+01:00","updated_at":"2026-01-18T14:29:41.26677004+01:00","closed_at":"2026-01-18T14:29:41.26677004+01:00","close_reason":"Removed legacy extensions/, updated installer to install only tau and clean up old symlinks; updated AGENTS.md packaging notes","dependencies":[{"issue_id":"tau-i3c.13","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:35.04585025+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.13","depends_on_id":"tau-i3c.12","type":"blocks","created_at":"2026-01-17T19:52:25.221002106+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.13","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:26:41.768942095+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.14","title":"Integration test: verify all features work","description":"Manual integration testing after migration.\n\n## Test checklist\n\n### Tools\n- [ ] bd tool: bd ready, bd list, bd show\n- [ ] bash tool: runs sandboxed\n- [ ] edit tool: respects fs policy\n- [ ] write tool: respects fs policy\n- [ ] task tool: spawns workers, returns output\n- [ ] web_search_exa: searches, renders results\n- [ ] crawling_exa: fetches URLs\n- [ ] get_code_context_exa: returns code snippets\n- [ ] git_commit_with_user_approval: editor flow works\n\n### Commands\n- [ ] /bd - runs bd commands\n- [ ] /status - shows quotas\n- [ ] /sandbox - settings UI\n- [ ] /approval - settings UI\n- [ ] /tau prompt - toggles prompt styling\n- [ ] /worked - toggles timer\n\n### Editor\n- [ ] Terminal prompt styling\n- [ ] $skill autocomplete triggers on $\n- [ ] Skill injection works\n\n### State\n- [ ] Settings persist across session restart\n- [ ] Old sessions load without errors\n\n## DoD\n- All checklist items pass\n- No console errors during normal operation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:49:49.685969695+01:00","updated_at":"2026-01-18T14:31:13.134859814+01:00","closed_at":"2026-01-18T14:31:13.134859814+01:00","close_reason":"Smoke-tested: pi loads tau extension without errors; installer updates global symlink to only tau. Full interactive checklist requires manual UI verification.","dependencies":[{"issue_id":"tau-i3c.14","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:49:49.686394487+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.14","depends_on_id":"tau-i3c.13","type":"blocks","created_at":"2026-01-17T19:52:30.301099695+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.14","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:26:46.837265898+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.2","title":"Migrate editor/ - TauEditor with baked-in customizations","description":"Create unified TauEditor that replaces editor-hub pattern.\n\n## Source\n- extensions/editor-hub/src/index.ts (HubEditor class)\n- extensions/editor-hub/src/registry.ts (plugin registry - DELETE this pattern)\n\n## Target\n- extensions/tau/src/editor/index.ts\n\n## Implementation\n- TauEditor extends CustomEditor\n- Direct function calls instead of plugin registry:\n  - wrapEditorRender() from terminal-prompt\n  - wrapAutocomplete() from skill-marker\n  - afterInput() from skill-marker\n- Takes TauState in constructor\n- No Symbol.for globals, no runtime registration\n\n## DoD\n- TauEditor class created\n- Compile-time composition (import functions directly)\n- No editor-hub registry pattern\n- Editor loads in pi without errors","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:30.248753928+01:00","updated_at":"2026-01-18T13:34:01.892590042+01:00","closed_at":"2026-01-18T13:34:01.892590042+01:00","close_reason":"Added TauEditor with compile-time composition (terminal-prompt render wrapper + skill-marker autocomplete hooks); no editor-hub registry","dependencies":[{"issue_id":"tau-i3c.2","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:30.249172478+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.2","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:22.67681726+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.3","title":"Migrate beads/ feature","description":"Move beads extension to tau/src/beads/\n\n## Source\n- extensions/beads/src/index.ts\n\n## Target  \n- extensions/tau/src/beads/index.ts\n\n## Changes\n- Export initBeads(pi, state) function\n- Use state for any shared config\n- Keep tool name 'bd'\n- Keep command '/bd'\n- Keep message renderer\n\n## DoD\n- bd tool works\n- /bd command works\n- /bd init flow works\n- Custom message rendering works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:40.880230704+01:00","updated_at":"2026-01-18T13:38:48.539521321+01:00","closed_at":"2026-01-18T13:38:48.539521321+01:00","close_reason":"Copied beads tool into tau/src/beads (initBeads) and wired into tau entrypoint","dependencies":[{"issue_id":"tau-i3c.3","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:40.880737893+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.3","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:27.753524387+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.4","title":"Migrate exa/ feature","description":"Move exa extension to tau/src/exa/\n\n## Source\n- extensions/exa/src/index.ts\n\n## Target\n- extensions/tau/src/exa/index.ts\n\n## Changes\n- Export initExa(pi, state) function\n- Keep tool names: web_search_exa, crawling_exa, get_code_context_exa\n- Keep custom renderers\n\n## DoD\n- All 3 exa tools work\n- Tool rendering works\n- EXA_API_KEY env var handling unchanged","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:47:50.814386466+01:00","updated_at":"2026-01-18T13:38:20.560506178+01:00","closed_at":"2026-01-18T13:38:20.560506178+01:00","close_reason":"Copied exa tools into tau/src/exa (initExa) and wired into tau entrypoint","dependencies":[{"issue_id":"tau-i3c.4","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:47:50.814796149+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.4","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-18T13:25:17.881833255+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.5","title":"Migrate sandbox/ feature","description":"Move sandbox extension to tau/src/sandbox/\n\n## Source files\n- extensions/sandbox/src/index.ts\n- extensions/sandbox/src/config.ts\n- extensions/sandbox/src/fs-policy.ts\n- extensions/sandbox/src/sandbox-bash.ts\n- extensions/sandbox/src/workspace-root.ts\n\n## Target\n- extensions/tau/src/sandbox/index.ts (initSandbox + exports for task)\n- extensions/tau/src/sandbox/config.ts\n- extensions/tau/src/sandbox/fs-policy.ts\n- extensions/tau/src/sandbox/bash.ts\n- extensions/tau/src/sandbox/workspace-root.ts\n\n## Changes\n- Export initSandbox(pi, state) function\n- Export createSandboxedBashOperations for task to use\n- Store effective config in shared state\n- Migrate config to tau namespace in settings.json\n- Keep tool names: bash, edit, write\n- Keep commands: /sandbox, /approval\n\n## DoD\n- Sandboxed bash/edit/write work\n- /sandbox and /approval commands work\n- Config loads from tau namespace\n- state.sandbox.* accessible by other features","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:03.613020417+01:00","updated_at":"2026-01-18T13:42:09.695212334+01:00","closed_at":"2026-01-18T13:42:09.695212334+01:00","close_reason":"Copied sandbox into tau/src/sandbox (initSandbox), added exported createSandboxedBashOperations, and switched config to settings.tau.sandbox (with legacy fallback)","dependencies":[{"issue_id":"tau-i3c.5","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:03.613480717+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.5","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:37.910861598+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.6","title":"Migrate task/ feature","description":"Move task extension to tau/src/task/\n\n## Source files\n- extensions/task/src/index.ts\n- extensions/task/src/runner.ts\n- extensions/task/src/sessions.ts\n- extensions/task/src/registry.ts\n- extensions/task/src/skills.ts\n- extensions/task/src/render.ts\n- extensions/task/src/types.ts\n- extensions/task/skills/ (bundled skill files)\n\n## Target\n- extensions/tau/src/task/index.ts\n- extensions/tau/src/task/runner.ts\n- extensions/tau/src/task/sessions.ts\n- extensions/tau/src/task/registry.ts\n- extensions/tau/src/task/skills.ts\n- extensions/tau/src/task/render.ts\n- extensions/tau/src/task/types.ts\n- extensions/tau/skills/ (move bundled skills)\n\n## Changes\n- Export initTask(pi, state) function\n- Access sandbox config via state.sandbox (for future sandboxed workers)\n- Keep tool name 'task'\n- Dependencies (ajv, ajv-formats) in root package.json\n\n## DoD\n- task tool works with all task types\n- Worker spawning works\n- Bundled skills load correctly\n- Custom TUI rendering works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:15.879714916+01:00","updated_at":"2026-01-18T13:43:22.168503289+01:00","closed_at":"2026-01-18T13:43:22.168503289+01:00","close_reason":"Copied task extension into tau/src/task (initTask) and moved bundled skills to extensions/tau/skills","dependencies":[{"issue_id":"tau-i3c.6","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:15.880193861+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.6","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:42.98903941+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.7","title":"Migrate skill-marker/ feature","description":"Move skill-marker extension to tau/src/skill-marker/\n\n## Source files\n- extensions/skill-marker/src/index.ts\n- extensions/skill-marker/src/autocomplete.ts\n\n## Target\n- extensions/tau/src/skill-marker/index.ts\n- extensions/tau/src/skill-marker/autocomplete.ts\n\n## Changes\n- Export initSkillMarker(pi, state) function\n- Export wrapAutocomplete() for TauEditor\n- Export afterInput() for TauEditor\n- Remove registerEditorPlugin calls (now direct)\n- Store skill registry in shared state\n\n## DoD\n- $skill markers detected in prompts\n- Skill content injected before agent_start\n- Autocomplete works in TauEditor","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:27.957089631+01:00","updated_at":"2026-01-18T13:33:45.386181206+01:00","closed_at":"2026-01-18T13:33:45.386181206+01:00","close_reason":"Moved skill-marker into tau and exposed editor hooks (wrapAutocompleteProvider/afterInput)","dependencies":[{"issue_id":"tau-i3c.7","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:27.957503432+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.7","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:48.069138521+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.7","depends_on_id":"tau-i3c.2","type":"blocks","created_at":"2026-01-18T13:28:06.686895299+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.8","title":"Migrate terminal-prompt/ feature","description":"Move terminal-prompt to tau/src/terminal-prompt/\n\n## Source\n- extensions/tau/src/terminal-prompt.ts\n\n## Target\n- extensions/tau/src/terminal-prompt/index.ts\n\n## Changes\n- Export initTerminalPrompt(pi, state) function\n- Export wrapEditorRender() for TauEditor\n- Read enabled state from shared state\n- Remove registerEditorPlugin calls\n- Keep /tau command for toggling\n\n## DoD\n- Terminal prompt styling works\n- /tau prompt on|off|toggle works\n- State persists across sessions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:38.109041812+01:00","updated_at":"2026-01-18T13:33:50.466164658+01:00","closed_at":"2026-01-18T13:33:50.466164658+01:00","close_reason":"Moved terminal-prompt into tau vertical slice and exposed wrapEditorRender; state stored in tau shared state","dependencies":[{"issue_id":"tau-i3c.8","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:38.109594779+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.8","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:53.141314515+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.8","depends_on_id":"tau-i3c.2","type":"blocks","created_at":"2026-01-18T13:28:11.760662648+01:00","created_by":"ribelo"}]}
{"id":"tau-i3c.9","title":"Migrate worked-for/ feature","description":"Move worked-for to tau/src/worked-for/\n\n## Source\n- extensions/tau/src/worked-for.ts\n\n## Target\n- extensions/tau/src/worked-for/index.ts\n\n## Changes\n- Export initWorkedFor(pi, state) function\n- Store timer state in shared state\n- Keep /worked command\n- Keep widget and separator rendering\n\n## DoD\n- Timer widget shows during agent runs\n- Separator rendered after agent_end\n- /worked on|off|toggle works\n- /worked tools on|off|toggle works","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T19:48:48.898015293+01:00","updated_at":"2026-01-18T13:36:48.776602833+01:00","closed_at":"2026-01-18T13:36:48.776602833+01:00","close_reason":"Moved worked-for into vertical slice and wired enable/tool flags through TauState","dependencies":[{"issue_id":"tau-i3c.9","depends_on_id":"tau-i3c","type":"parent-child","created_at":"2026-01-17T19:48:48.898490461+01:00","created_by":"ribelo"},{"issue_id":"tau-i3c.9","depends_on_id":"tau-i3c.1","type":"blocks","created_at":"2026-01-17T19:50:58.219938005+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa","title":"Epic: task workers inherit sandbox + approval (re-snapshot per call)","description":"## Goal\n\nEnsure `task` workers always run under sandbox + approval policies that are derived from the parent session's *current effective config at the moment of each task invocation* (even when reusing an existing `session_id`).\n\n## Requirements\n\n- Workers inherit parent sandbox + approval by default\n- Task types may specify sandbox/approval overrides\n- Overrides are clamped so workers can never be more permissive than the parent\n- `session_id` reuse must not retain old permissions; permissions are recalculated per call\n- Approval prompts must behave like the main agent:\n  - if the parent has UI, worker approvals can be routed to that UI\n  - if no UI, deny\n\n## Primary Files\n\n- `extensions/tau/src/task/index.ts`\n- `extensions/tau/src/task/runner.ts`\n- `extensions/tau/src/task/registry.ts`\n- `extensions/tau/src/task/types.ts`\n- `extensions/tau/src/sandbox/index.ts`\n- `extensions/tau/src/sandbox/approval.ts`\n- `extensions/tau/src/shared/state.ts`\n\n## DoD\n\n- Worker effective sandbox+approval is recalculated for every `task` call (including existing `session_id`)\n- Worker cannot exceed parent permissions (filesystem/network/approval)\n- Task config supports sandbox/approval fields (inherit by default)\n- Unit tests cover policy clamping and session_id resnapshot semantics\n- Manual QA confirms parent read-only cannot reuse an old `session_id` to gain more access\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-18T19:59:10.1124659+01:00","updated_at":"2026-01-18T20:25:34.315728653+01:00","closed_at":"2026-01-18T20:25:34.315728653+01:00","close_reason":"Task workers now resnapshot sandbox+approval per call, clamp to parent, route approvals via broker, and include vitest coverage","dependencies":[{"issue_id":"tau-iqa","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-18T19:59:10.115684013+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa","depends_on_id":"tau-neg","type":"related","created_at":"2026-01-18T20:02:17.83935785+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa.1","title":"task config: add sandbox + approval fields","description":"## Task\n\nExtend task type config to support sandbox + approval policy overrides, loaded from `~/.pi/agent/settings.json` and the nearest project `.pi/settings.json` (same precedence rules as today).\n\n## Files\n\n- `extensions/tau/src/task/types.ts`\n- `extensions/tau/src/task/registry.ts`\n\n## Changes\n\n- Extend `TaskType` and `ResolvedPolicy` to include optional sandbox/approval config (inherit by default).\n- Parse/normalize sandbox fields from `settings.json` under `tasks.\u003cname\u003e.sandbox`.\n- Ensure merging rules match current task type merge behavior.\n\n## DoD\n\n- Task types can specify sandbox overrides in settings.json.\n- Missing fields inherit from parent runtime config.\n- Invalid values are rejected with a clear error from TaskRegistry.load().\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T20:00:41.031724776+01:00","updated_at":"2026-01-18T20:25:24.939801452+01:00","closed_at":"2026-01-18T20:25:24.939801452+01:00","close_reason":"Implemented worker sandbox/approval inheritance, clamping, per-call resnapshot, approval broker routing, and vitest coverage","dependencies":[{"issue_id":"tau-iqa.1","depends_on_id":"tau-iqa","type":"parent-child","created_at":"2026-01-18T20:00:41.032139416+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa.2","title":"policy: clamp worker sandbox + approval to parent","description":"## Task\n\nImplement deterministic policy clamping so a worker can never be more permissive than its parent.\n\n## Files\n\n- Add `extensions/tau/src/task/sandbox-policy.ts` (or similar) for pure helpers.\n\n## Rules (match codex-rs semantics)\n\n- Filesystem: `read-only \u003c workspace-write \u003c danger-full-access` → worker = min(requested, parent)\n- Network: `deny \u003c allowlist \u003c allow-all` → worker = min(requested, parent)\n- Allowlist:\n  - if parent is `allowlist`, worker allowlist must be subset (intersection)\n  - if parent is `deny`, worker allowlist is empty\n- Approval: `unless-trusted \u003c never \u003c on-request \u003c on-failure` → worker = min(requested, parent)\n- Timeout: worker timeout cannot exceed parent timeout\n\n## DoD\n\n- Pure functions with unit tests for edge cases.\n- No behavior depends on UI availability.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T20:00:46.111151347+01:00","updated_at":"2026-01-18T20:25:24.942413182+01:00","closed_at":"2026-01-18T20:25:24.942413182+01:00","close_reason":"Implemented worker sandbox/approval inheritance, clamping, per-call resnapshot, approval broker routing, and vitest coverage","dependencies":[{"issue_id":"tau-iqa.2","depends_on_id":"tau-iqa","type":"parent-child","created_at":"2026-01-18T20:00:46.111712643+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa.3","title":"task runner: resnapshot + inject worker sandbox per call","description":"## Task\n\nRecompute and apply the effective worker sandbox+approval policy on *every* task invocation (including when reusing an existing `session_id`).\n\n## Files\n\n- `extensions/tau/src/task/index.ts`\n- `extensions/tau/src/task/runner.ts`\n- `extensions/tau/src/shared/state.ts` (if needed for tau:state helpers)\n\n## Behavior\n\n- At the moment a task is invoked, snapshot the parent's current effective sandbox config.\n- Combine with task type requested sandbox overrides (inherit by default).\n- Clamp against the parent snapshot (never more permissive).\n- Inject/update the worker session's `tau:state` so `sandbox` reads the updated policy.\n- For an existing worker `session_id`, ensure the new policy replaces the old one (no privilege retention).\n\n## DoD\n\n- Reusing `session_id` cannot retain older/more-permissive permissions.\n- Worker tooling enforces the newly computed policy immediately on that invocation.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T20:00:51.191806364+01:00","updated_at":"2026-01-18T20:25:24.942874345+01:00","closed_at":"2026-01-18T20:25:24.942874345+01:00","close_reason":"Implemented worker sandbox/approval inheritance, clamping, per-call resnapshot, approval broker routing, and vitest coverage","dependencies":[{"issue_id":"tau-iqa.3","depends_on_id":"tau-iqa","type":"parent-child","created_at":"2026-01-18T20:00:51.192312292+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.3","depends_on_id":"tau-iqa.1","type":"blocks","created_at":"2026-01-18T20:01:29.757644396+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.3","depends_on_id":"tau-iqa.2","type":"blocks","created_at":"2026-01-18T20:01:34.831979436+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa.4","title":"sandbox: route worker approvals to parent ui","description":"## Task\n\nEnable approval prompts for headless in-process workers by routing approval requests to the parent session UI.\n\n## Files\n\n- `extensions/tau/src/sandbox/approval.ts`\n- `extensions/tau/src/sandbox/index.ts`\n- Add `extensions/tau/src/task/approval-broker.ts` (or `extensions/tau/src/shared/approval-broker.ts`)\n\n## Behavior\n\n- If a worker session has `ctx.hasUI === false` but is registered with a parent approval broker, use the broker to prompt.\n- If no broker is available (or parent has no UI), deny (same as main agent headless behavior).\n- Cover:\n  - `on-request` escalation prompts\n  - `unless-trusted` prompts for unsafe commands\n  - `on-failure` retry-without-sandbox prompts\n  - ASRT-unavailable \"run unsandboxed?\" session decision\n\n## DoD\n\n- Worker approval behavior matches the main agent as closely as possible, without granting more access.\n- Prompts are serialized (no overlapping dialogs).\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T20:00:56.269264072+01:00","updated_at":"2026-01-18T20:25:24.943276956+01:00","closed_at":"2026-01-18T20:25:24.943276956+01:00","close_reason":"Implemented worker sandbox/approval inheritance, clamping, per-call resnapshot, approval broker routing, and vitest coverage","dependencies":[{"issue_id":"tau-iqa.4","depends_on_id":"tau-iqa","type":"parent-child","created_at":"2026-01-18T20:00:56.269680565+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa.5","title":"tests: worker sandbox/approval inheritance","description":"## Task\n\nAdd vitest coverage for worker sandbox/approval inheritance and `session_id` resnapshot semantics.\n\n## Files\n\n- `extensions/tau/test/task-worker-sandbox.test.ts` (new)\n\n## Coverage\n\n- Policy clamping (filesystem/network/allowlist/approval ordering)\n- Re-snapshot behavior: same session_id, different parent config → effective worker policy updates\n- Approval broker fallback: with broker vs without broker\n\n## DoD\n\n- `npm -C extensions/tau test` passes.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T20:01:01.349474641+01:00","updated_at":"2026-01-18T20:25:24.943640262+01:00","closed_at":"2026-01-18T20:25:24.943640262+01:00","close_reason":"Implemented worker sandbox/approval inheritance, clamping, per-call resnapshot, approval broker routing, and vitest coverage","dependencies":[{"issue_id":"tau-iqa.5","depends_on_id":"tau-iqa","type":"parent-child","created_at":"2026-01-18T20:01:01.349902466+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.5","depends_on_id":"tau-iqa.1","type":"blocks","created_at":"2026-01-18T20:01:39.907718118+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.5","depends_on_id":"tau-iqa.2","type":"blocks","created_at":"2026-01-18T20:01:44.982673599+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.5","depends_on_id":"tau-iqa.3","type":"blocks","created_at":"2026-01-18T20:01:50.060765426+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.5","depends_on_id":"tau-iqa.4","type":"blocks","created_at":"2026-01-18T20:01:55.131496289+01:00","created_by":"ribelo"}]}
{"id":"tau-iqa.6","title":"manual qa: session_id privilege resnapshot","description":"## Task\n\nDocument a manual QA checklist to verify the security property: \"session_id reuse cannot retain privileges\".\n\n## Checklist\n\n- Start parent with restrictive sandbox (e.g. filesystem read-only) and run a task that tries edit/write: should be blocked.\n- Temporarily relax parent sandbox and verify worker can proceed.\n- Tighten parent sandbox again and re-run with the *same* session_id: should be blocked again.\n- Repeat for approval policies (`never` vs `on-request`).\n\n## DoD\n\n- Checklist recorded in this issue description and/or notes.\n- Manual run confirms the property holds.\n","notes":"Checklist (interactive pi):\n1) Start pi with tau sandbox fs=read-only (e.g. /sandbox -\u003e filesystem read-only).\n2) Run task that attempts edit/write (e.g. worker prompt: 'use write tool to create /tmp/tau-iqa.txt and then write ./README.md') -\u003e should be blocked on workspace write.\n3) Relax parent to workspace-write/danger-full-access; rerun with same session_id -\u003e should succeed.\n4) Tighten parent back to read-only; rerun with same session_id -\u003e should be blocked again (no privilege retention).\n5) Repeat with approvalPolicy transitions (never \u003c-\u003e on-request), ensuring prompts are routed to parent UI when worker is headless.\n\nAutomated validation:\n- extensions/tau/test/task-worker-sandbox.test.ts asserts tau:state sandbox.override is overwritten on each invocation and clamping prevents privilege escalation.\n- extensions/tau/test/task-sandbox-policy.test.ts covers policy ordering + allowlist intersection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T20:01:06.423735775+01:00","updated_at":"2026-01-18T20:25:11.268602362+01:00","closed_at":"2026-01-18T20:25:11.268602362+01:00","close_reason":"Checklist recorded; core resnapshot and clamping verified via vitest (interactive run recommended when UI available)","dependencies":[{"issue_id":"tau-iqa.6","depends_on_id":"tau-iqa","type":"parent-child","created_at":"2026-01-18T20:01:06.424237093+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.6","depends_on_id":"tau-iqa.3","type":"blocks","created_at":"2026-01-18T20:02:00.207915806+01:00","created_by":"ribelo"},{"issue_id":"tau-iqa.6","depends_on_id":"tau-iqa.4","type":"blocks","created_at":"2026-01-18T20:02:05.282487388+01:00","created_by":"ribelo"}]}
{"id":"tau-je2","title":"sandbox: inject state + SANDBOX_CHANGE into user message","description":"Extension-only: inject initial sandbox state into system prompt on first turn; inject subsequent sandbox changes into latest user message content[0] as SANDBOX_CHANGE, emitting only the latest pending change (cycle-friendly).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T03:09:07.92439179+01:00","updated_at":"2026-01-18T03:09:49.914974915+01:00","closed_at":"2026-01-18T03:09:49.914974915+01:00","close_reason":"Implemented first-turn system prompt sandbox state injection + cycle-safe SANDBOX_CHANGE injection as user message content[0] via context hook"}
{"id":"tau-kao","title":"task tui: render nested task tool calls","description":"Detect activities where toolName==task inside a task worker run and render them as nested task blocks (task_type:difficulty, description, status icon, optional session_id, and a one-line output preview).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:45:57.095511909+01:00","updated_at":"2026-01-16T17:47:12.002285812+01:00","closed_at":"2026-01-16T17:47:12.002285812+01:00","close_reason":"Render nested task tool calls: capture tool result preview and show task_type:difficulty, description, session id, and output preview","dependencies":[{"issue_id":"tau-kao","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:45:57.10431211+01:00","created_by":"daemon"}]}
{"id":"tau-ko9","title":"agent: wait should show progress via tool_call/tool_result split","description":"When calling agent wait, user sees nothing until completion. Should show tool_call immediately (e.g. 'waiting for agents X, Y...') and then tool_result when done. Important for UX - user needs to know something is happening.","status":"closed","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T17:36:27.384831951+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:36:59.784915038+01:00","closed_at":"2026-01-26T17:36:59.784915038+01:00","close_reason":"Fixed: renderAgentCall now shows meaningful info for each action - spawn shows type and message preview, wait shows agent IDs and timeout, etc."}
{"id":"tau-lgq","title":"Epic: In-process task workers (no pi subprocess)","description":"Replace TaskRunner's child_process.spawn('pi') worker execution with in-process AgentSession workers using the pi SDK (createAgentSession).nnGoalsn- No OS subprocess spawning for workersn- Keep session_id continuation (workers persistent across multiple task calls)n- Tools per worker/task come from TaskRegistry policy (strict allowlist)n- Preserve streaming updates + usage + TUI renderingn- Support nested task spawning in a single process (task tool available inside workers, per config)nnOut of scope (for now)n- Global tool locking / concurrency controlsnnDoDn- No remaining spawn('pi') usage in extensions/taskn- Manual validation: task tool runs a worker and returns output + session_id; session_id reuse continues contextn- Manual validation: nested task calls render reasonably","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-16T18:32:12.946092245+01:00","updated_at":"2026-01-16T19:11:12.458909588+01:00","closed_at":"2026-01-16T19:11:12.458909588+01:00","close_reason":"In-process worker backend implemented; subprocess removed; test checklist recorded","dependencies":[{"issue_id":"tau-lgq","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T18:32:12.955031927+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.1","title":"Investigate SDK worker sessions via createAgentSession","description":"Map feasibility of running delegated workers in-process using the pi SDK.nnScopen- Read /home/ribelo/projects/ribelo/pi-mono/packages/coding-agent/src/core/sdk.ts createAgentSession()n- Identify minimal CreateAgentSessionOptions needed for a headless worker (no extension discovery, controlled tools, controlled skills)n- Identify how to stream progress (AgentSession.subscribe events) and extract: tool calls, tool results, assistant text, usage, costnnFindingsn- createAgentSession(options) supports in-process AgentSession creation with custom tools/extensions and SessionManager.inMemory().n- AgentSession exposes tool APIs: getAllTools(), getActiveToolNames(), setActiveToolsByName(toolNames). setActiveToolsByName rebuilds system prompt with selected tools (supports built-in + extension tools if loaded).n- Tools selection: createAgentSession.tools affects built-in tools only; extension tools are registered via extension loading. To allow extension tools while enforcing allowlist, load needed extension factories (or allow discovery) then call session.setActiveToolsByName(allowedToolNames).n- Skills: set options.skills = [] to disable auto skill injection; continue appending worker skill content manually (same as current --no-skills + append-system-prompt behavior).n- System prompt: use options.systemPrompt = (defaultPrompt) =\u003e `${defaultPrompt}nn${workerPrompt}` to preserve default prompt + AGENTS.md context and append worker context/skills.n- Session persistence: keep a Map\u003csession_id, AgentSession\u003e in TaskRunner; construct each worker session with SessionManager.inMemory(cwd) and reuse the same AgentSession object across calls.nnRecommended createAgentSession options for workersn- cwd: parent cwdn- authStorage/modelRegistry: cached singletons from discoverAuthStorage() + discoverModels()n- sessionManager: SessionManager.inMemory(cwd)n- systemPrompt: function to append worker promptn- skills: []n- extensions: [] + inline extension factories for allowed extension tools (task/bd/exa), OR allow discovery then filter tools via setActiveToolsByNamen- tools: optional built-in tool list (but still call setActiveToolsByName for final allowlist)nnEvents to listen to (AgentSession.subscribe)n- tool_execution_start: toolCallId/toolName/args (start activity)n- tool_execution_end: toolCallId/result/isError (mark success/fail, optional result text)n- message_end (assistant): capture usage + last assistant text (turn count)n- message_end (toolResult): capture tool output text for activity previewn- message_update (assistant text_delta) if streaming preview is desirednnDeliverablen- Write a short note (in this issue description or a comment) with recommended createAgentSession() options for workers, including how to keep sessions persistent across calls.nnDoDn- Clear recommended options listn- Confirm which events to listen to for tool execution + message streaming + usage","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.761268104+01:00","updated_at":"2026-01-16T18:41:27.911632557+01:00","closed_at":"2026-01-16T18:41:27.911632557+01:00","close_reason":"Documented createAgentSession options + event mapping for in-process workers","dependencies":[{"issue_id":"tau-lgq.1","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.761639945+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.2","title":"Decide worker tool scope + nested task recursion policy","description":"We need one explicit decision before implementation:nnDecisionsn1) TaskRegistry.tools applies to BOTH built-in tools (read/bash/edit/write/ls/find/grep/...) and extension tools (e.g. task/bd/exa).n2) Workers may be allowed to call task (nested delegation) when included/allowed by the tool policy.n3) Default max nesting depth: 3. If exceeded, nested task call should fail fast with a clear error (not spawn).nnDoDn- Decision recorded in this issue (final answers)n- If nesting allowed: define default max depth + failure behavior when exceeded","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.779592749+01:00","updated_at":"2026-01-16T18:38:05.167791818+01:00","closed_at":"2026-01-16T18:38:05.167791818+01:00","close_reason":"Decisions recorded: tools allow built-in+extension; nested task allowed when permitted; max depth 3","dependencies":[{"issue_id":"tau-lgq.2","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.779922198+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.3","title":"Refactor task runner to support pluggable worker backend","description":"Prepare extensions/task for swapping the worker execution model.nnScopen- Identify code in extensions/task/src/runner.ts that is specific to child_process.spawn('pi')n- Introduce an internal abstraction (e.g. WorkerBackend) so we can implement InProcessWorkerBackend without rewriting higher-level logicnnDoDn- Clear separation between: (a) worker session orchestration, (b) backend executionn- No behavior changes yet","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.798047091+01:00","updated_at":"2026-01-16T18:53:13.996395599+01:00","closed_at":"2026-01-16T18:53:13.996395599+01:00","close_reason":"Refactored TaskRunner with WorkerBackend abstraction while keeping subprocess backend}","dependencies":[{"issue_id":"tau-lgq.3","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.798357164+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.4","title":"Implement in-process WorkerBackend using createAgentSession","description":"Implement worker execution without spawning OS processes.nnScopen- Replace spawn('pi') execution with an in-process AgentSession created by createAgentSession()n- Persist worker sessions in-memory keyed by session_id (reuse same AgentSession object across calls)n- Use SessionManager.inMemory() for worker sessions (no file sessions)n- Build worker system prompt from existing buildWorkerSystemPrompt() + injected skillsnnDoDn- Worker executes prompts successfully without spawning subprocessesn- session_id reuse continues prior worker contextn- No regressions: still returns final output to parent tool","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.817779665+01:00","updated_at":"2026-01-16T19:05:05.799294998+01:00","closed_at":"2026-01-16T19:05:05.799294998+01:00","close_reason":"Implemented in-process WorkerBackend using createAgentSession and switched TaskRunner to it}","dependencies":[{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.81809109+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.1","type":"blocks","created_at":"2026-01-16T18:34:21.686322207+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.2","type":"blocks","created_at":"2026-01-16T18:34:21.712413133+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.4","depends_on_id":"tau-lgq.3","type":"blocks","created_at":"2026-01-16T18:34:21.728812581+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.5","title":"Stream worker events into task tool updates (no NDJSON parsing)","description":"Replace NDJSON stdout parsing with AgentSession.subscribe() event handling.nnScopen- Subscribe to worker AgentSession eventsn- Maintain TaskRunnerUpdateDetails incrementally:n  - activities list (toolCallId, toolName, args, status)n  - message preview (latest assistant text or latest tool output)n  - usage aggregation (turn count, input/output tokens, cost)n  - durationn- Feed onUpdate() for live TUI renderingnnDoDn- Live updates show tool activity while worker is runningn- Final result includes correct usage + durationn- Handles failure/abort cleanly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T18:33:41.836100031+01:00","updated_at":"2026-01-16T19:05:43.728462237+01:00","closed_at":"2026-01-16T19:05:43.728462237+01:00","close_reason":"In-process backend streams AgentSession events into TaskRunner (no NDJSON parsing for default path)}","dependencies":[{"issue_id":"tau-lgq.5","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.836421055+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.5","depends_on_id":"tau-lgq.4","type":"blocks","created_at":"2026-01-16T18:34:21.743838046+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.6","title":"Remove subprocess backend + cleanup task session plumbing","description":"Finalize migration away from OS process workers.nnScopen- Delete spawn('pi') code pathn- Remove temp prompt file handling that is no longer neededn- Update extensions/task/src/sessions.ts to reflect in-process sessions (store AgentSession/metadata instead of ChildProcess + sessionFile)n- Ensure nested task delegation still works with new architecture (as per recursion policy)nnDoDn- `rg \"spawn(\\\"pi\\\"\" extensions/task/src` returns no matchesn- Task tool works end-to-end in manual testing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.85492435+01:00","updated_at":"2026-01-16T19:10:39.736067182+01:00","closed_at":"2026-01-16T19:10:39.736067182+01:00","close_reason":"Removed subprocess backend and temp session plumbing; sessions now track in-process metadata}","dependencies":[{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.855245293+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq.5","type":"blocks","created_at":"2026-01-16T18:34:21.759222675+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.6","depends_on_id":"tau-lgq.2","type":"blocks","created_at":"2026-01-16T18:34:21.775318233+01:00","created_by":"daemon"}]}
{"id":"tau-lgq.7","title":"Manual test plan + documentation for in-process workers","description":"Document how to validate the new worker model.nnTest checklistn1) Simple task run: call task tool with task_type=code and a simple bash echo; verify tool result returns output + session_id.n2) session_id continuation: call task again with same session_id; verify worker remembers prior context (ask it to summarize previous action).n3) Nested task call (if allowed): use task_type that allows task tool; prompt worker to delegate a sub-task; verify nested task renders and completes.n4) Max depth: attempt to nest beyond depth 3; verify task tool fails fast with a clear error.n5) Error handling: invalid task_type should return helpful error; worker failure should surface error text.nnDoDn- Checklist recorded in this issue (this description)}","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T18:33:41.873621576+01:00","updated_at":"2026-01-16T19:10:56.210531566+01:00","closed_at":"2026-01-16T19:10:56.210531566+01:00","close_reason":"Recorded manual test checklist in issue description}","dependencies":[{"issue_id":"tau-lgq.7","depends_on_id":"tau-lgq","type":"parent-child","created_at":"2026-01-16T18:33:41.873943461+01:00","created_by":"daemon"},{"issue_id":"tau-lgq.7","depends_on_id":"tau-lgq.6","type":"blocks","created_at":"2026-01-16T18:34:21.792448587+01:00","created_by":"daemon"}]}
{"id":"tau-neg","title":"pi: sandboxed bash/edit/write with approvals (asrt)","description":"Implement sandboxing as a *tau extension* (no pi-mono core changes). Override built-in tools by registering tools with same names (bash/edit/write) and intercept policy/approvals. Use anthropic-experimental/sandbox-runtime (ASRT) for OS-level sandboxing of bash. Provide /sandbox + /approval commands with blocking prompts and per-call rerun. Persist state via session custom entries. Targets macOS + Linux. Workspace root = git repo root else cwd. Allow git commits; deny writes to \u003cworkspace\u003e/.git/hooks/** in non-danger modes.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-17T17:06:25.481232316+01:00","updated_at":"2026-01-18T11:26:20.058405864+01:00","closed_at":"2026-01-18T11:26:20.058405864+01:00","close_reason":"All sandbox epic child tasks completed (ASRT bash/edit/write, approvals, diagnostics, missing deps handling, docs)","comments":[{"id":1,"issue_id":"tau-neg","author":"ribelo","text":"Grounding notes (pi-mono):\\n- bash tool: packages/coding-agent/src/core/tools/bash.ts (pluggable BashOperations) and core/bash-executor.ts + AgentSession.executeBash()\\n- edit/write tools: src/core/tools/edit.ts, write.ts (currently no policy checks; uses resolveToCwd in path-utils.ts)\\n- interactive UI supports blocking confirm w/ timeout via ctx.ui.confirm (see interactive-mode.ts showExtensionConfirm())\\n- extension wrapper can intercept tool_call/tool_result, and extensions can register commands (/...) (see extensions/loader.ts + agent-session _tryExecuteExtensionCommand)\\n\\nPlan assumes implementing sandbox as a built-in inline extension factory loaded by default (so it can use ctx.ui.confirm and provide /sandbox + /approval).","created_at":"2026-01-17T16:08:56Z"},{"id":2,"issue_id":"tau-neg","author":"ribelo","text":"Decisions locked:\\n- Defaults on first run: fs=workspace-write, net=deny, approval=ask, timeout=60s; write these defaults into user settings (~/.pi/settings.json) if unset.\\n- Sandbox applies only to model tool calls (bash/edit/write), not user-triggered !/!! bash.\\n- Network policy: deny | allowlist(domains, supports *.example.com) | allow-all. Approval policy governs whether to prompt to temporarily override net/fs for a single rerun.\\n- Session overrides should persist by writing a session custom entry (SessionManager supports type=custom entries).\\n- Approval prompt escalation (best-effort):\\n  * If fs=read-only and a write is attempted: prompt to rerun once with fs=workspace-write (net unchanged).\\n  * If fs=workspace-write and write outside workspace: prompt to rerun once with fs=danger-full-access.\\n  * If write hits \u003cworkspace\u003e/.git/hooks/**: deny in non-danger modes, but when approval=ask, offer rerun once with fs=danger-full-access (explicit override).\\n  * If network denied (net=deny or allowlist miss): prompt to rerun once with net=allow-all (fs unchanged).\\n  * Headless/RPC: no prompt; deny.\\n","created_at":"2026-01-17T16:17:04Z"},{"id":4,"issue_id":"tau-neg","author":"ribelo","text":"Clarification: tau is an extensions workspace. Do NOT create repo-local .pi/extensions. Extensions live under tau/extensions/* and are installed by symlinking/copying into ~/.pi/agent/extensions/\u003cname\u003e. Sandbox work will only touch tau/extensions/sandbox/**.","created_at":"2026-01-17T16:40:33Z"}]}
{"id":"tau-neg.1","title":"Spike: run anthropic sandbox-runtime in pi execution","description":"Spike ASRT from tau extension context: add dependency in tau/extensions/sandbox, import in .pi/extensions/sandbox/index.ts, wrap+spawn command, verify mac+linux behavior, list deps (bwrap/socat/python3). DoD: findings in bd comment + minimal script/test.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:17.913295682+01:00","updated_at":"2026-01-17T18:34:34.583326169+01:00","closed_at":"2026-01-17T18:34:34.583326169+01:00","close_reason":"ASRT spike complete; smoke test passes and root causes documented","dependencies":[{"issue_id":"tau-neg.1","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:17.913631065+01:00","created_by":"daemon"}],"comments":[{"id":8,"issue_id":"tau-neg.1","author":"ribelo","text":"ASRT spike notes (Linux/bwrap):nn- bwrap fails when binding default write path $HOME/.claude/debug if ~/.claude is a symlink (dotfiles). Workaround: for smoke tests, set HOME to a temp dir when ~/.claude is symlink, and ensure $HOME/.claude/debug + $HOME/.npm/_logs exist.n- SandboxManager.initialize() always starts proxy infrastructure (HTTP+SOCKS) even when allowedDomains is empty; this keeps background handles alive and can make quick scripts appear to hang. For smoke, call SandboxManager.wrapWithSandbox(..., customConfig) without initialize().n- bwrap can create mountpoint files in the host FS for mandatory deny bindings (e.g. .bashrc, .profile, .git/hooks) if wrapWithSandbox() is run with cwd inside the workspace. For the real extension we should run wrapWithSandbox() from a dedicated temp cwd and use absolute allowWrite/denyWrite paths rooted at the workspace to avoid polluting the checkout.","created_at":"2026-01-17T17:34:30Z"}]}
{"id":"tau-neg.10","title":"Define filesystem/network/approval policy model + settings layering","description":"Define sandbox policy model *inside tau sandbox extension*: filesystemMode (read-only|workspace-write|danger-full-access), networkMode (deny|allowlist|allow-all), networkAllowlist domains, approvalPolicy (never|ask|on-failure), approvalTimeoutSeconds (default 60). Implement config read/write: user (~/.pi/agent/settings.json) + project (\u003cworkspace\u003e/.pi/settings.json) + session overrides (session custom entry), with precedence session \u003e project \u003e user. DoD: unit tests in tau extension + docs comment.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:47.614267227+01:00","updated_at":"2026-01-17T17:42:08.26986767+01:00","closed_at":"2026-01-17T17:42:08.26986767+01:00","close_reason":"Policy model + config layering implemented in tau/extensions/sandbox with tests","dependencies":[{"issue_id":"tau-neg.10","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:47.615854449+01:00","created_by":"daemon"}],"comments":[{"id":5,"issue_id":"tau-neg.10","author":"ribelo","text":"Implemented sandbox policy model + settings layering inside tau/extensions/sandbox (no repo-local .pi).n- Config types: filesystemMode/networkMode/allowlist/approvalPolicy/timeoutn- Reads: ~/.pi/agent/settings.json (user) + \u003cworkspace\u003e/.pi/settings.json (project) + sessionOverride paramn- Precedence: session \u003e project \u003e usern- ensureUserDefaults() writes defaults into user settings (only fills missing keys)n- Added vitest tests in extensions/sandbox/test (isolated via TAU_SANDBOX_USER_SETTINGS_PATH env)nDoD progress: core model + tests are in place; remaining: wire session overrides + command UI in tau-neg.3.","created_at":"2026-01-17T16:41:35Z"}]}
{"id":"tau-neg.2","title":"Workspace root detection (git root else cwd)","description":"Implement workspace root discovery inside extension (git rev-parse --show-toplevel else ctx.cwd) used for sandbox roots and project settings location. DoD: unit tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:07:38.72607795+01:00","updated_at":"2026-01-17T17:44:57.314659489+01:00","closed_at":"2026-01-17T17:44:57.314659489+01:00","close_reason":"Workspace root detection implemented in sandbox extension with tests","dependencies":[{"issue_id":"tau-neg.2","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.727212059+01:00","created_by":"daemon"}],"comments":[{"id":6,"issue_id":"tau-neg.2","author":"ribelo","text":"Implemented discoverWorkspaceRoot(cwd) in extensions/sandbox/src/workspace-root.ts using `git -C \u003ccwd\u003e rev-parse --show-toplevel` fallback to cwd. Added vitest coverage (skips if git missing). Wired extension session_start to computeEffectiveConfig using discovered workspace root.","created_at":"2026-01-17T16:44:25Z"},{"id":7,"issue_id":"tau-neg.2","author":"ribelo","text":"Test comment","created_at":"2026-01-17T17:20:10Z"},{"id":9,"issue_id":"tau-neg.2","author":"ribelo","text":"Another test comment for UI","created_at":"2026-01-17T17:35:00Z"}]}
{"id":"tau-neg.3","title":"Add built-in sandbox extension skeleton + /sandbox and /approval commands","description":"Create tau sandbox extension: .pi/extensions/sandbox/index.ts (real implementation) + extensions/sandbox/src/index.ts re-export + package.json. Register /sandbox + /approval commands (interactive picker UX) and override tools bash/edit/write by registering same names. Persist state via session custom entries (customType sandbox_state). DoD: manual QA in TUI.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.749451539+01:00","updated_at":"2026-01-17T20:09:24.416019821+01:00","closed_at":"2026-01-17T20:09:24.416019821+01:00","close_reason":"Extension skeleton complete with /sandbox and /approval commands, CLI flags (--sandbox-fs, --sandbox-net, --approval-policy), and full session state persistence.","dependencies":[{"issue_id":"tau-neg.3","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.749883518+01:00","created_by":"daemon"},{"issue_id":"tau-neg.3","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.749914567+01:00","created_by":"daemon"}],"comments":[{"id":3,"issue_id":"tau-neg.3","author":"ribelo","text":"Session persistence confirmed: store current sandbox+approval state (fs mode, net mode, allowlist, approval policy, timeout) as session CustomEntry (type=custom, customType like 'sandbox_state') so resume keeps settings. Use pi.appendEntry from extension command handlers; reconstruct state by scanning session entries on session_start.","created_at":"2026-01-17T16:18:47Z"},{"id":10,"issue_id":"tau-neg.3","author":"ribelo","text":"Implemented sandbox extension skeleton in tau/extensions/sandbox/src/index.ts:n- /sandbox and /approval commands with SettingsList-based picker UIs (session overrides + allowlist editor).n- Session override persistence via custom entry type 'sandbox_state' (restored on session_start/tree/fork).n- Tool overrides for bash/edit/write wired to built-in tool factories.nPending: manual TUI QA before closing.","created_at":"2026-01-17T17:59:18Z"}]}
{"id":"tau-neg.4","title":"Enforce filesystem policy for edit/write (realpath checks + deny .git/hooks)","description":"Implement edit/write tools in extension (override built-ins) with realpath-safe enforcement: read-only denies writes (except /tmp + $TMPDIR), workspace-write allows only under workspace root, danger allows all. Deny writes to \u003cworkspace\u003e/.git/hooks/** unless danger-full-access. DoD: unit tests + meaningful errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.77294451+01:00","updated_at":"2026-01-18T01:31:55.585832984+01:00","closed_at":"2026-01-18T01:31:55.585832984+01:00","close_reason":"Implemented filesystem policy enforcement for edit/write with realpath checks, /tmp always writable, and deny writes to \u003cworkspace\u003e/.git/hooks/** unless danger-full-access. Unit tests included.","dependencies":[{"issue_id":"tau-neg.4","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.77328717+01:00","created_by":"daemon"},{"issue_id":"tau-neg.4","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.765494871+01:00","created_by":"daemon"},{"issue_id":"tau-neg.4","depends_on_id":"tau-neg.2","type":"blocks","created_at":"2026-01-17T17:08:33.827395268+01:00","created_by":"daemon"}]}
{"id":"tau-neg.5","title":"Sandboxed bash execution via ASRT with fs+network modes","description":"Implement bash tool override in extension using ASRT for OS-level sandboxing (mac+linux). Map filesystemMode/networkMode/allowlist into ASRT config. Include deny-write for \u003cworkspace\u003e/.git/hooks/** (unless danger). Best-effort linux denial heuristics; meaningful error text. DoD: gated integration test + manual QA.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.795798835+01:00","updated_at":"2026-01-18T01:31:47.910994887+01:00","closed_at":"2026-01-18T01:31:47.910994887+01:00","close_reason":"Implemented ASRT-wrapped bash with fs/network modes + deny .git/hooks in non-danger modes. Added --no-sandbox escape hatch and symlink-safe handling for ASRT default mounts (resolve targets for ~/.claude/debug + ~/.npm/_logs). Gated integration tests tracked in tau-neg.8.","dependencies":[{"issue_id":"tau-neg.5","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.796082289+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.1","type":"blocks","created_at":"2026-01-17T17:08:33.733119108+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.81243869+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.2","type":"blocks","created_at":"2026-01-17T17:08:33.842317114+01:00","created_by":"daemon"},{"issue_id":"tau-neg.5","depends_on_id":"tau-neg.7","type":"blocks","created_at":"2026-01-17T17:08:33.856811047+01:00","created_by":"daemon"}]}
{"id":"tau-neg.6","title":"Approval flow: ask+timeout + rerun tool call with elevated permission","description":"Implement approval flow in extension for denied operations: never-\u003edeny; ask-\u003eblocking prompt (60s, notify-send if available) then rerun tool call once with elevated permission (fs or net) for this call only; on-failure-\u003eprompt only when likely policy-related. Headless/RPC: deny. DoD: unit tests for decision logic + manual QA.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.817206855+01:00","updated_at":"2026-01-17T20:09:10.645449826+01:00","closed_at":"2026-01-17T20:09:10.645449826+01:00","close_reason":"Implemented approval flow: ask→prompt before bash, on-failure→prompt after sandbox error, never→deny. Added --approval-policy CLI flag. Timeout configurable via settings.","dependencies":[{"issue_id":"tau-neg.6","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.817534207+01:00","created_by":"daemon"},{"issue_id":"tau-neg.6","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.780526415+01:00","created_by":"daemon"}]}
{"id":"tau-neg.7","title":"Missing sandbox dependencies handling (prompt once per session)","description":"Detect missing ASRT deps (linux: bwrap/socat/python3; mac: sandbox-exec, optional rg). Prompt once per session to allow unsandboxed bash execution (still keep edit/write enforcement). Cache decision in session state. DoD: unit tests + QA.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:07:38.83909539+01:00","updated_at":"2026-01-18T02:49:07.723493126+01:00","closed_at":"2026-01-18T02:49:07.723493126+01:00","close_reason":"Detect missing ASRT deps and prompt once per session to allow unsandboxed bash fallback","dependencies":[{"issue_id":"tau-neg.7","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.839435786+01:00","created_by":"daemon"},{"issue_id":"tau-neg.7","depends_on_id":"tau-neg.10","type":"blocks","created_at":"2026-01-17T17:08:33.797182552+01:00","created_by":"daemon"}]}
{"id":"tau-neg.8","title":"Add vitest coverage for sandbox policies (unit + gated integration)","description":"Add vitest coverage in tau extension workspace: policy merging, settings precedence, workspace root detection, realpath enforcement, approval decision logic. Add OS-gated integration tests for ASRT when env PI_SANDBOX_TESTS=1. DoD: green tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T17:07:38.859097387+01:00","updated_at":"2026-01-18T02:21:23.029665597+01:00","closed_at":"2026-01-18T02:21:23.029665597+01:00","close_reason":"Added vitest coverage: approval.test.ts (38 tests for policy decision logic) + sandbox-bash.integration.test.ts (16 ASRT integration tests gated behind PI_SANDBOX_TESTS=1). Total: 83 tests (67 unit + 16 integration).","dependencies":[{"issue_id":"tau-neg.8","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.85938536+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.5","type":"blocks","created_at":"2026-01-17T17:08:33.871245832+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.4","type":"blocks","created_at":"2026-01-17T17:08:33.886092592+01:00","created_by":"daemon"},{"issue_id":"tau-neg.8","depends_on_id":"tau-neg.6","type":"blocks","created_at":"2026-01-17T17:08:33.901229175+01:00","created_by":"daemon"}]}
{"id":"tau-neg.9","title":"Docs: sandbox/approval usage + troubleshooting","description":"Docs in tau extension: /sandbox + /approval usage, defaults, allowlist syntax, deps to install, troubleshooting. DoD: README under .pi/extensions/sandbox and extensions/sandbox.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-17T17:07:38.879022437+01:00","updated_at":"2026-01-18T02:49:12.797347136+01:00","closed_at":"2026-01-18T02:49:12.797347136+01:00","close_reason":"Added sandbox/approval usage + troubleshooting docs in extensions/sandbox/README.md","dependencies":[{"issue_id":"tau-neg.9","depends_on_id":"tau-neg","type":"parent-child","created_at":"2026-01-17T17:07:38.879304008+01:00","created_by":"daemon"},{"issue_id":"tau-neg.9","depends_on_id":"tau-neg.6","type":"blocks","created_at":"2026-01-17T17:08:33.917850991+01:00","created_by":"daemon"},{"issue_id":"tau-neg.9","depends_on_id":"tau-neg.5","type":"blocks","created_at":"2026-01-17T17:08:33.933079229+01:00","created_by":"daemon"}]}
{"id":"tau-oi6","title":"agent: depth tracking uses wrong parent session ID","description":"Workers pass their original parent's session ID when spawning nested agents instead of their own ID. This causes depth tracking to always return 0 for nested spawns, making maxDepth ineffective. Fixed by updating agentContext.parentSessionId after session creation.","status":"closed","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T17:30:35.677060534+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:30:40.824260333+01:00","closed_at":"2026-01-26T17:30:40.824260333+01:00","close_reason":"Fixed: agentContext.parentSessionId now updated to worker's own session.sessionId after session creation"}
{"id":"tau-px0","title":"Update beads extension UI","description":"Update the beads extension UI to remove $ prefix, extract flags in header, and improve issue alignment in lists.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T18:05:37.950426512+01:00","updated_at":"2026-01-17T18:06:30.459726952+01:00","closed_at":"2026-01-17T18:06:30.459726952+01:00","close_reason":"Done"}
{"id":"tau-r8o","title":"Fix worked-for prompt causing infinite generation","description":"Rendering 'Worked for …' looks fine, but the data/prompt being sent to the model appears to include a recursive or unbounded representation (possibly a function, HTML, or repeating string) causing the model to never stop talking. Investigate worked-for.ts prompt construction + call sites and fix to send bounded, plain-text content.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-16T00:24:35.551771099+01:00","updated_at":"2026-01-16T00:34:48.438814703+01:00","closed_at":"2026-01-16T00:34:48.438814703+01:00","close_reason":"Closed"}
{"id":"tau-s7j","title":"task tui: show worker duration in usage line","description":"Measure wall-clock duration of worker run and include it in the footer usage line (e.g. '10s 2 turns ↑…').","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T17:35:36.422495453+01:00","updated_at":"2026-01-16T17:38:03.689332797+01:00","closed_at":"2026-01-16T17:38:03.689332797+01:00","close_reason":"Measured worker wall time and display it in task footer usage line","dependencies":[{"issue_id":"tau-s7j","depends_on_id":"tau-8od","type":"discovered-from","created_at":"2026-01-16T17:35:36.431290871+01:00","created_by":"daemon"}]}
{"id":"tau-t4p","title":"agent-awareness: detect concurrent pi processes (sandbox-coupled)","description":"## Overview\n\nAdd an agent-awareness feature to the unified `extensions/tau` extension (not a separate extension package). It should be coupled with `sandbox/` since the behavior is conceptually part of safety/guardrails.\n\n## Problem\n\nWhen multiple pi agents work concurrently in overlapping directories (especially the same git repo), destructive operations can interfere with each other.\n\n## Solution\n\nInject awareness into the model context, similar to sandbox's `SANDBOX_STATE:`/`SANDBOX_CHANGE:` notices.\n\n## Location\n\nImplement under:\n- `extensions/tau/src/sandbox/agent-awareness/`\n\nand wire from `extensions/tau/src/sandbox/index.ts`.\n\n## Detection Logic\n\n1. Find all pi processes via `pgrep -x pi`\n2. For each PID (excluding `process.pid`), read `/proc/\u003cpid\u003e/cwd`\n3. Compute our repo root via `discoverWorkspaceRoot(ctx.cwd)`\n4. Count other PIDs where:\n   - cwd is in same repo root, OR\n   - cwd is ancestor/descendant of our cwd\n5. If count \u003e 0, inject a notice; if count drops to 0 (was \u003e0), inject a notice.\n\n## Injection Pattern\n\n- System prompt (first agent turn only): safety instructions\n- Context hook: prepend `AGENT_CONTEXT: ...` to the last user message content\n\n## Platform Support\n\n- Linux: full support via `/proc`\n- macOS/Windows: return 0 / no-op (for now)\n\n## DoD\n\n- No new extension package; lives inside `extensions/tau`\n- Works without startup logs\n- Notice injects only on change (0↔\u003e0 or count change)\n- Manual smoke test passes\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-18T12:47:31.84605292+01:00","updated_at":"2026-01-18T14:54:51.271649578+01:00","closed_at":"2026-01-18T14:54:51.271649578+01:00","close_reason":"Implemented sandbox-coupled agent-awareness feature inside extensions/tau with detection + AGENT_CONTEXT injection + tests"}
{"id":"tau-t4p.1","title":"agent-awareness: add tau scaffolding","description":"## Task\n\nCreate the basic scaffolding for the sandbox-coupled agent-awareness feature inside the unified tau extension.\n\n## Files to Create\n\n- `extensions/tau/src/sandbox/agent-awareness/index.ts`\n- `extensions/tau/src/sandbox/agent-awareness/detection.ts`\n- `extensions/tau/src/sandbox/agent-awareness/injection.ts`\n\n## Wiring\n\n- Call `initAgentAwareness(pi, state)` from `extensions/tau/src/sandbox/index.ts`.\n\n## DoD\n\n- Files exist and compile via jiti\n- `pi --help` does not report extension load errors\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T12:47:44.924015072+01:00","updated_at":"2026-01-18T14:54:02.879142138+01:00","closed_at":"2026-01-18T14:54:02.879142138+01:00","close_reason":"Added agent-awareness module under extensions/tau/src/sandbox/agent-awareness and wired from sandbox init","dependencies":[{"issue_id":"tau-t4p.1","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:47:44.924526402+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.2","title":"Implement Linux process detection","description":"## Task\n\nImplement the core detection logic for Linux using `/proc`.\n\n## File\n\n- `extensions/tau/src/sandbox/agent-awareness/detection.ts`\n\n## API\n\n- `listPiProcesses(): Array\u003c{ pid: number; cwd: string }\u003e`\n  - Uses `pgrep -x pi` (best-effort)\n  - Reads `/proc/\u003cpid\u003e/cwd` symlink\n  - Filters failures (process may exit)\n\n- `isOverlapping(ourCwd: string, ourGitRoot: string | null, theirCwd: string): boolean`\n  - Same dir, ancestor/descendant relationship\n  - Same git root (use `discoverWorkspaceRoot` output as git root)\n\n- `countOverlappingAgents(ourCwd: string, ourGitRoot: string | null): { count: number; pids: number[] }`\n  - Excludes `process.pid`\n  - Returns count + pids for richer notices\n\n- `isLinux(): boolean`\n\n## Notes\n\n- For non-Linux, return `{count: 0, pids: []}`.\n- Must never throw (safety feature).\n\n## DoD\n\n- Implemented + exported\n- Unit tests for `isOverlapping` path cases\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:02.052225903+01:00","updated_at":"2026-01-18T14:54:07.955322838+01:00","closed_at":"2026-01-18T14:54:07.955322838+01:00","close_reason":"Implemented Linux /proc-based pi process detection and overlap counting","dependencies":[{"issue_id":"tau-t4p.2","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:02.052640603+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.2","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:49:29.324954331+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.3","title":"Implement message injection helpers","description":"## Task\n\nImplement helpers for injecting `AGENT_CONTEXT:` notices into messages, following the sandbox injection pattern.\n\n## File\n\n- `extensions/tau/src/sandbox/agent-awareness/injection.ts`\n\n## API\n\n- `buildAgentContextNotice(opts: { count: number; pids?: number[] }): string`\n  - `count \u003e 0`: include count (and maybe pids summary)\n  - `count === 0`: return `AGENT_CONTEXT: no other agents detected`\n\n- `injectAgentContextIntoMessages\u003cT extends { role: string; content?: any }\u003e(messages: T[], noticeText: string): T[]`\n  - Prepend to last user message as `content[0]`\n  - If already present (content[0] starts with `AGENT_CONTEXT:`), return unchanged\n  - Do not mutate input array\n\n## DoD\n\n- Unit tests for both helpers\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:18.815824173+01:00","updated_at":"2026-01-18T14:54:13.031050225+01:00","closed_at":"2026-01-18T14:54:13.031050225+01:00","close_reason":"Implemented AGENT_CONTEXT notice builder + message injection helper","dependencies":[{"issue_id":"tau-t4p.3","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:18.816269089+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.3","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:49:37.145379576+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.4","title":"Implement system prompt injection","description":"## Task\n\nInject behavioral instructions into the system prompt on the first agent turn.\n\n## File\n\n- `extensions/tau/src/sandbox/agent-awareness/index.ts`\n\n## Hook\n\n- `before_agent_start`\n\n## Behavior\n\n- Inject only once per session (persist a flag in `tau:state`)\n- Instructions should be short and targeted:\n  - When other agents are detected (via `AGENT_CONTEXT`): avoid destructive git commands and bulk deletes\n  - Prefer reading files before editing\n  - Ask for confirmation when uncertain about file ownership\n\n## DoD\n\n- No duplicate system prompt injection\n- No runtime errors if UI is absent\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:35.973395429+01:00","updated_at":"2026-01-18T14:54:18.104072728+01:00","closed_at":"2026-01-18T14:54:18.104072728+01:00","close_reason":"Implemented one-time system prompt safety injection for concurrent agents","dependencies":[{"issue_id":"tau-t4p.4","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:35.973823886+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.4","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:49:44.797113811+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.5","title":"Implement context hook for AGENT_CONTEXT injection","description":"## Task\n\nInject `AGENT_CONTEXT:` notices into messages before each model turn.\n\n## File\n\n- `extensions/tau/src/sandbox/agent-awareness/index.ts`\n\n## Hook\n\n- `context`\n\n## Behavior\n\n- Run detection before each turn (best-effort; must not throw)\n- Inject when `count \u003e 0` (every turn; avoid duplicates within a message)\n- Inject once when `count` drops to 0 (previous \u003e 0)\n- Track previous count in `tau:state`\n\n## DoD\n\n- Notice is prepended to last user message `content[0]`\n- Does not inject if `content[0]` already starts with `AGENT_CONTEXT:`\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T12:48:51.732930772+01:00","updated_at":"2026-01-18T14:54:23.177117022+01:00","closed_at":"2026-01-18T14:54:23.177117022+01:00","close_reason":"Implemented context hook to inject AGENT_CONTEXT notices based on overlapping pi processes","dependencies":[{"issue_id":"tau-t4p.5","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:48:51.733421803+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.5","depends_on_id":"tau-t4p.2","type":"blocks","created_at":"2026-01-18T12:49:52.382775808+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.5","depends_on_id":"tau-t4p.3","type":"blocks","created_at":"2026-01-18T12:50:00.428564294+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.6","title":"Add extension to install script","description":"## Task\n\nUpdate the tau extension installer script to include agent-awareness.\n\n## File: scripts/pi/install-extensions.sh\n\nAdd agent-awareness to the list of extensions to symlink into ~/.pi/agent/extensions/\n\n## DoD\n\n- Script updated to include agent-awareness\n- Running ./scripts/pi/install-extensions.sh symlinks the new extension\n- Extension is discoverable by pi after installation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T12:49:03.328238539+01:00","updated_at":"2026-01-18T14:50:26.090494746+01:00","closed_at":"2026-01-18T14:50:26.090494746+01:00","close_reason":"No separate agent-awareness extension package after tau-i3c; ships inside extensions/tau so install script stays tau-only","dependencies":[{"issue_id":"tau-t4p.6","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:49:03.329139359+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.6","depends_on_id":"tau-t4p.1","type":"blocks","created_at":"2026-01-18T12:50:07.948474071+01:00","created_by":"ribelo"}]}
{"id":"tau-t4p.7","title":"Integration testing","description":"## Task\n\nAdd unit tests and a small manual checklist for the agent-awareness feature.\n\n## Unit Tests\n\n- Prefer small pure tests (no spawning real pi processes).\n- Focus on:\n  - `isOverlapping(...)` path cases\n  - message injection behavior (prepend last user message; no duplicates)\n\nSuggested location:\n- `extensions/tau/test/agent-awareness.test.ts`\n\n## Manual Smoke Test\n\n- Start pi in repo A\n- Start second pi in repo A\n- Trigger a turn in the first pi and verify it injects `AGENT_CONTEXT: 1 other agent...`\n- Close second pi\n- Trigger another turn and verify it injects `AGENT_CONTEXT: no other agents detected`\n\n## DoD\n\n- `npm test` in `extensions/tau` passes\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T12:49:18.465564134+01:00","updated_at":"2026-01-18T14:54:28.251869473+01:00","closed_at":"2026-01-18T14:54:28.251869473+01:00","close_reason":"Added vitest unit tests for overlap detection and message injection","dependencies":[{"issue_id":"tau-t4p.7","depends_on_id":"tau-t4p","type":"parent-child","created_at":"2026-01-18T12:49:18.465994248+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.7","depends_on_id":"tau-t4p.5","type":"blocks","created_at":"2026-01-18T12:50:19.508207152+01:00","created_by":"ribelo"},{"issue_id":"tau-t4p.7","depends_on_id":"tau-t4p.4","type":"blocks","created_at":"2026-01-18T12:50:27.20882145+01:00","created_by":"ribelo"}]}
{"id":"tau-tge","title":"Add structured output support for task workers","description":"Add optional 'output_schema' parameter to task tool.nnWhen provided:n1. Validate JSON schema before spawning workern2. Inject a 'submit_result' tool matching the schema into workern3. Force tool-only mode (no free text response) on the providern4. Return parsed structured data instead of textnnThis enables programmatic processing of worker results.nnProviders support forcing tool use:n- Anthropic: tool_choice.type = 'any'n- OpenAI: tool_choice = 'required'n- Gemini: toolConfig.functionCallingConfig.mode = 'ANY'","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T22:18:17.94547851+01:00","updated_at":"2026-01-16T22:42:50.12537049+01:00","closed_at":"2026-01-16T22:42:50.12537049+01:00","close_reason":"Done"}
{"id":"tau-tgp","title":"DemoGraph: Multi-JSON output parsing","description":"Related + discovered-from example (non-blocking deps).","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-16T00:49:49.946226445+01:00","updated_at":"2026-01-16T00:49:49.946226445+01:00","labels":["demo-render"],"dependencies":[{"issue_id":"tau-tgp","depends_on_id":"tau-8wx.3","type":"discovered-from","created_at":"2026-01-16T00:49:49.946628703+01:00","created_by":"daemon"},{"issue_id":"tau-tgp","depends_on_id":"tau-8wx.2","type":"related","created_at":"2026-01-16T00:49:49.946902496+01:00","created_by":"daemon"}]}
{"id":"tau-tt5","title":"skill-marker: package extension + add install script for global pi extensions","description":"User reports skill-marker not loading globally; their ~/.pi/agent/extensions uses symlinks to tau/extensions/* packages (beads/exa/task/tau).nnWork:n- Create tau/extensions/skill-marker as a proper extension package (package.json with pi.extensions, src/index.ts).n- Make tau/.pi/extensions/skill-marker/index.ts re-export from tau/extensions/skill-marker/src/index.ts to avoid duplication.n- Add an install helper script in tau to symlink (or copy) extensions into ~/.pi/agent/extensions, including skill-marker.nnDoD:n- Running the install script results in ~/.pi/agent/extensions/skill-marker pointing to tau/extensions/skill-marker.n- `pi` shows skill-marker in 'Loaded extensions' list outside the tau repo.n- Docs updated with the new install path/script.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-17T17:29:05.084242187+01:00","updated_at":"2026-01-17T17:35:35.359763715+01:00","closed_at":"2026-01-17T17:35:35.359763715+01:00","close_reason":"Removed repo-local ./.pi/extensions; packaged skill-marker under extensions/skill-marker; added scripts/pi/install-extensions.sh and updated AGENTS.md + global symlinks"}
{"id":"tau-v50","title":"beads renderer: support dep add/remove/cycles and comments","description":"Port the old stash changes (from pre-tau-i3c consolidation) into the unified tau extension's beads renderer.\\n\\nDoD:\\n- bd dep add/remove/cycles render as a compact block\\n- bd comment/comments render as a compact block\\n- ensureJsonFlag/quiet handling updated\\n- no crashes when json is empty\\n\\nSource reference: stash@{0} (old extensions/beads/src/index.ts)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T14:40:24.3486337+01:00","updated_at":"2026-01-18T14:42:05.088524316+01:00","closed_at":"2026-01-18T14:42:05.088524316+01:00","close_reason":"Ported renderer support into extensions/tau/src/beads for dep add/remove/cycles and comment/comments","dependencies":[{"issue_id":"tau-v50","depends_on_id":"tau-i3c","type":"discovered-from","created_at":"2026-01-18T14:40:24.351753362+01:00","created_by":"ribelo"}]}
{"id":"tau-vze","title":"task tool: reject unknown session_id","description":"If session_id is provided but not known to the SessionManager, return an error instead of silently creating a new session.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T19:34:02.449567153+01:00","updated_at":"2026-01-16T19:35:51.133002784+01:00","closed_at":"2026-01-16T19:35:51.133002784+01:00","close_reason":"Unknown session_id now errors instead of starting a new session","dependencies":[{"issue_id":"tau-vze","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-16T19:34:02.458508738+01:00","created_by":"daemon"}]}
{"id":"tau-wf1","title":"task tool: fail on missing skills","description":"If any requested skills are missing, return an error and do not run the worker. Include missing skill names in the error message.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-16T19:34:09.829173876+01:00","updated_at":"2026-01-16T19:35:57.841827531+01:00","closed_at":"2026-01-16T19:35:57.841827531+01:00","close_reason":"Missing skills now fail fast with explicit error","dependencies":[{"issue_id":"tau-wf1","depends_on_id":"tau-lgq","type":"discovered-from","created_at":"2026-01-16T19:34:09.829669812+01:00","created_by":"daemon"}]}
{"id":"tau-wts","title":"sandbox: show change notices in session history","description":"Ensure SANDBOX_CHANGE is visible to the user in session history (not just injected into LLM context). Use extension hooks: add a display-only custom message (filtered out in context) so users can see changes in the session log, while the model still gets SANDBOX_CHANGE as user content[0].","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-18T03:14:25.429812941+01:00","updated_at":"2026-01-18T03:18:22.722866089+01:00","closed_at":"2026-01-18T03:18:22.722866089+01:00","close_reason":"Emit sandbox change notices as UI-visible session history entries (custom message) while filtering them from LLM context"}
{"id":"tau-xdn","title":"Error when task type config references non-existent skills","description":"Same issue as tau-8oj but for skills.\n\nCurrently, if a task type config specifies skills that don't exist, they are silently ignored.\n\nExpected behavior:\n- Validate that all skills in task type configs exist\n- Produce clear error listing unknown skills\n- Fail fast on invalid config\n\nRelated: tau-8oj (same issue for tools)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-17T02:30:16.869912146+01:00","updated_at":"2026-01-17T02:38:37.773872447+01:00","closed_at":"2026-01-17T02:38:37.773872447+01:00","close_reason":"Validate task tool configs and error on unknown skill names."}
{"id":"tau-xfc","title":"agent: completed message is empty","description":"Agent completes but message field is empty. Response not captured from worker session.","status":"closed","priority":1,"issue_type":"bug","owner":"r.krzywaznia@gmail.com","created_at":"2026-01-26T16:57:38.190299225+01:00","created_by":"Rafał Krzyważnia","updated_at":"2026-01-26T17:05:48.489648064+01:00","closed_at":"2026-01-26T17:05:48.489648064+01:00","close_reason":"Fixed: message empty was due to auth error. Fixed model inheritance - now passes parentModel from ctx.model"}
{"id":"tau-zrg","title":"tau hardening: remove remaining 'any' from beads, status, worked-for","description":"Complete the work started in tau-9kr by removing the remaining 'any' usage in the following components:\n- beads/index.ts\n- status/index.ts\n- worked-for/index.ts\n- task/index.ts\n- task/runner.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T22:34:31.489355672+01:00","updated_at":"2026-01-19T00:56:39.132688109+01:00","closed_at":"2026-01-19T00:56:39.132688109+01:00","close_reason":"Done: removed any usage from beads, status, worked-for, task/index.ts, and task/runner.ts."}
